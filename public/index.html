<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C4 - Gest√£o para Empreendedoras</title>
    <!-- 
        Coment√°rio: Favicon e meta tags adicionais podem ser inseridos aqui.
        Exemplo: <link rel="icon" href="favicon.ico" type="image/x-icon">
    -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- Chart.js CDN -->

    <!-- 
        Coment√°rio: Links para arquivos CSS Globais (base, layout)
        Futuramente, estes estilos inline ser√£o movidos para arquivos CSS externos.
        Exemplo: <link rel="stylesheet" href="css/base.css">
        Exemplo: <link rel="stylesheet" href="css/layout.css">
    -->
    <style>
        /* Estilos b√°sicos para visualiza√ß√£o inicial e mobile-first */
        body { 
            font-family: 'Poppins', sans-serif; /* Tipografia sugerida */
            margin: 0; 
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: #fdf2f8; /* Um rosa bem clarinho para o fundo, derivado de #db1472 */
            position: relative;
            overflow-x: hidden;
        }

        /* Cabe√ßalho */
        .app-header { 
            background-color: #db1472; /* Rosa Principal da paleta */
            background-image: linear-gradient(to right, #db1472, #ec4899); 
            color: white; 
            padding: 0.8rem 1rem; 
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        }
        .app-header-title {
            margin: 0;
            font-size: 1.6rem; 
            font-weight: 700; 
        }
        .menu-toggle {
            background: none;
            border: none;
            color: white;
            font-size: 1.8rem; 
            cursor: pointer;
            padding: 0.5rem;
            display: flex; 
            align-items: center;
            justify-content: center;
        }
        .menu-toggle svg {
            width: 30px; 
            height: 30px;
        }

        /* Navega√ß√£o Lateral (Sidebar) */
        .sidebar-nav {
            height: 100%;
            width: 0; 
            position: fixed;
            z-index: 1001; 
            top: 0;
            left: 0;
            background-color: #db1472; 
            background-image: linear-gradient(to bottom, #db1472, #c01062); 
            overflow-x: hidden;
            transition: 0.3s ease-in-out; 
            padding-top: 20px; 
            box-shadow: 4px 0 8px rgba(0,0,0,0.25);
            display: flex;
            flex-direction: column;
        }
        .sidebar-nav.open {
            width: 260px; 
        }
        .sidebar-nav-header { 
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px; 
            border-bottom: 1px solid #c01062; 
            margin-bottom: 10px;
        }
        .sidebar-nav-header .sidebar-title {
            color: #ffffff;
            font-size: 1.8em;
            font-weight: 700;
            margin:0;
        }
        .sidebar-nav .close-btn { 
            font-size: 2.2rem; 
            font-weight: 700;
            color: #fce7f3; 
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px; 
        }
        .sidebar-nav .close-btn:hover {
            color: #f8b81f; 
        }
        .sidebar-nav-links {
            flex-grow: 1;
            overflow-y: auto; 
        }

        .sidebar-nav a {
            padding: 14px 18px 14px 25px; 
            text-decoration: none;
            font-size: 1.15rem; 
            font-weight: 500; 
            color: #fce7f3; 
            display: flex; 
            align-items: center; 
            transition: 0.2s ease-in-out;
            border-bottom: 1px solid #c01062; 
        }
        .sidebar-nav a svg { 
            margin-right: 12px; 
            width: 20px;
            height: 20px;
            vertical-align: middle; 
            fill: none; 
            stroke: currentColor; 
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        .sidebar-nav-links a:last-child { 
            border-bottom: none; 
        }
        .sidebar-nav a:hover,
        .sidebar-nav a.active {
            color: #db1472; 
            background-color: #f8b81f; 
            font-weight: 600;
        }
        .sidebar-nav a:hover svg,
        .sidebar-nav a.active svg {
            stroke: #db1472; 
        }


        /* Conte√∫do Principal */
        main { 
            flex-grow: 1; 
            padding: 1.8rem 1.2rem; 
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            box-sizing: border-box;
            transition: margin-left 0.3s ease-in-out; 
        }
        body.sidebar-open main {
             /* Mant√©m sem margin-left para sobreposi√ß√£o em mobile */
        }

        .page-content { }
        .page-title {
            color: #db1472; 
            border-bottom: 4px solid #f8b81f; 
            padding-bottom: 0.8rem;
            margin-top: 0;
            margin-bottom: 1.8rem; 
            font-size: 2rem; 
            font-weight: 600; 
        }
        .sub-page-title { 
            color: #c01062; 
            font-size: 1.6rem;
            font-weight: 600;
            margin-top: 0;
            margin-bottom: 1.2rem;
        }

        /* Rodap√© */
        footer {
            background-color: #f8f0f4; 
            color: #575355; 
            text-align: center;
            padding: 1.5rem;
            font-size: 0.9rem;
            border-top: 1px solid #e7d8de; 
        }

        /* Estilos para esconder/mostrar p√°ginas */
        .page-content:not(.active) {
            display: none;
        }

        /* Overlay */
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(50,10,30,0.5); 
            z-index: 1000; 
            transition: opacity 0.3s ease-in-out;
        }
        .overlay.active {
            display: block;
        }

        /* Estilos para Cards Dashboard */
        .cards-container { 
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
            gap: 1.2rem; 
            margin-bottom: 2.5rem;
        }
        .card { 
            background-color: rgba(219, 20, 114, 0.8); 
            border-radius: 10px; 
            padding: 1.8rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); 
            transition: transform 0.25s ease-in-out, box-shadow 0.25s ease-in-out, background-color 0.25s ease-in-out; 
            color: #ffffff; 
        }
        .card:hover {
            transform: translateY(-6px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15); 
            background-color: rgba(219, 20, 114, 0.9); 
        }
        .card-title {
            font-size: 1.25rem; 
            font-weight: 600; 
            color: #fdf2f8; 
            margin-top: 0;
            margin-bottom: 0.75rem;
        }
        .card-value {
            font-size: 2rem; 
            font-weight: 700; 
            color: #ffffff; 
            margin-bottom: 1.2rem;
        }
        .card-description {
            font-size: 0.95rem;
            color: #fce7f3; 
        }
        .quick-actions {
            display: flex;
            gap: 0.9rem;
            margin-top: 1.8rem;
            flex-wrap: wrap; 
        }
        .btn, 
        .btn-action {
            background-color: #f8b81f; 
            color: #5c3c00; 
            border: none;
            padding: 0.7rem 1.2rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem; 
            font-weight: 600; 
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-decoration: none; 
            display: inline-flex; 
            align-items: center;
            justify-content: center;
        }
        .btn:hover,
        .btn-action:hover {
            background-color: #faca50; 
            transform: translateY(-2px);
        }
        .btn:active,
        .btn-action:active {
            transform: translateY(0px);
        }
        .btn-primary { 
            background-color: #db1472;
            color: white;
        }
        .btn-primary:hover {
            background-color: #c01062;
        }
        .btn-secondary { 
            background-color: #e2e8f0; 
            color: #475569; 
        }
        .btn-secondary:hover {
            background-color: #cbd5e1; 
        }
        .btn-danger { 
            background-color: #ef4444; 
            color: white;
        }
        .btn-danger:hover {
            background-color: #dc2626; 
        }
        .btn-sm { 
            padding: 0.4rem 0.8rem;
            font-size: 0.85rem;
        }


        /* Placeholder para Gr√°fico */
        .chart-container {
            background-color: #ffffff;
            border-radius: 10px;
            padding: 1.8rem;
            box-shadow: 0 5px 15px rgba(219, 20, 114, 0.1); 
            min-height: 280px; 
            display: flex;
            align-items: center;
            justify-content: center;
            color: #9ca3af; 
        }
        .chart-container p {
            font-size: 1.1rem;
            font-weight: 500;
        }

        /* Estilos para Formul√°rios (Gen√©rico) */
        .form-group {
            margin-bottom: 1.2rem;
        }
        .form-group label {
            display: block;
            font-weight: 500;
            color: #4b5563; 
            margin-bottom: 0.4rem;
        }
        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group input[type="email"],
        .form-group input[type="password"],
        .form-group input[type="date"], 
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db; 
            border-radius: 6px;
            box-sizing: border-box; 
            font-size: 1rem;
            color: #374151; 
        }
        .form-group input[type="file"] {
            padding: 0.5rem; 
        }
        .form-group input[type="checkbox"] { 
            margin-right: 0.5rem;
            vertical-align: middle;
        }
        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        .form-group .readonly-field { 
            background-color: #f3f4f6; 
            color: #4b5563;
            border: 1px solid #e5e7eb;
            cursor: default;
        }
        .form-group .calculated-field { 
            font-weight: bold;
            color: #db1472; 
            padding-top: 0.5rem;
        }

        .form-actions {
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end; 
            margin-top: 1.5rem;
        }
        .image-preview {
            max-width: 150px; 
            max-height: 150px;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
            margin-top: 0.5rem;
            display: none; 
            object-fit: cover;
        }

        /* Estilos para Tabelas Gen√©ricas (Produtos, Vendas, Despesas) */
        .data-table { 
            width: 100%;
            border-collapse: collapse;
        }
        .data-table th,
        .data-table td {
            padding: 0.9rem 1rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0; 
            color: #374151;
            vertical-align: middle;
        }
        .data-table th {
            background-color: #f9fafb; 
            font-weight: 600;
            color: #4b5563;
            white-space: nowrap; 
        }
        .data-table .actions-cell button {
            margin-right: 0.5rem;
        }
        .data-table .actions-cell button:last-child {
            margin-right: 0;
        }
        .data-table .status-badge { 
            padding: 0.25rem 0.6rem;
            border-radius: 12px; 
            font-size: 0.8rem;
            font-weight: 500;
            text-transform: capitalize;
        }
        .status-pago { background-color: #dcfce7; color: #166534; } 
        .status-pendente { background-color: #ffedd5; color: #9a3412; } 
        .status-cancelado { background-color: #fee2e2; color: #991b1b; } 


        /* Estilo para o container do formul√°rio */
        .form-container { 
            background-color: #ffffff;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-top: 1.5rem;
        }
         #product-details-container { 
            background-color: #ffffff;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-top: 1.5rem;
            display: none; 
        }
        .costs-display-section {
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: #fdf2f8; 
            border-radius: 6px;
            border: 1px solid #fbcfe8; 
        }
        .costs-display-section h4 {
            margin-top: 0;
            margin-bottom: 0.75rem;
            color: #9d174d; 
        }
        .costs-display-section p {
            margin-bottom: 0.5rem;
            color: #500724; 
        }
        .costs-display-section p strong {
            color: #c01062; 
        }

        /* P√°gina de Vendas Espec√≠fico */
        #form-nova-venda-container .sale-items-list {
            margin-top: 1rem;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            min-height: 50px; 
        }
        #form-nova-venda-container .sale-items-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e2e8f0;
        }
        #form-nova-venda-container .sale-items-list li:last-child {
            border-bottom: none;
        }
        #form-nova-venda-container .sale-item-details {
            flex-grow: 1;
        }
        #form-nova-venda-container .sale-item-details strong {
            color: #db1472;
        }
        #form-nova-venda-container .sale-item-actions button {
            background: none;
            border: none;
            color: #ef4444; 
            cursor: pointer;
            padding: 0.25rem;
        }
        #form-nova-venda-container .sale-item-actions button:hover {
            color: #b91c1c;
        }
        #sale-summary {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 2px dashed #fbcfe8;
        }
        #sale-summary p {
            display: flex;
            justify-content: space-between;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: #500724;
        }
        #sale-summary p.total {
            font-size: 1.4rem;
            font-weight: 700;
            color: #db1472;
        }
        .filters-container {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        .filters-container .form-group {
            margin-bottom: 0; 
            flex-grow: 1;
            min-width: 150px; 
        }
        .summary-section { 
            margin-top: 2rem;
            padding: 1.5rem;
            background-color: #fff1f2; 
            border-radius: 8px;
            border: 1px solid #ffe4e6;
        }
        .summary-section h4 {
            margin-top: 0;
            color: #9d174d;
        }

        /* P√°gina de Despesas Espec√≠fico */
        .despesas-cards-container {
            display: grid;
            grid-template-columns: 1fr; 
            gap: 1.5rem;
        }
        @media (min-width: 768px) { 
            .despesas-cards-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        .card-despesa {
            background-color: #fff1f2; 
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.07);
        }
        .card-despesa-title {
            color: #db1472;
            font-size: 1.5rem;
            margin-top: 0;
            margin-bottom: 0.75rem;
            border-bottom: 2px solid #f8b81f;
            padding-bottom: 0.5rem;
        }
        .informativo {
            font-size: 0.9rem;
            color: #6b7280;
            margin-bottom: 1.5rem;
            background-color: #fdf2f8;
            padding: 0.75rem;
            border-radius: 4px;
            border-left: 3px solid #f8b81f;
        }
        .card-despesa .form-group { 
             margin-bottom: 1rem;
        }
        .card-despesa .form-actions {
             justify-content: flex-start; 
             margin-top: 1rem;
        }
        .custos-lista {
            list-style: none;
            padding: 0;
            margin-top: 1rem;
            max-height: 200px; 
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
        }
        .custos-lista li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.95rem;
        }
        .custos-lista li:last-child {
            border-bottom: none;
        }
        .custos-lista li .cost-details {
            flex-grow: 1;
        }
        .custos-lista li .cost-name {
            font-weight: 500;
            color: #374151;
        }
        .custos-lista li .cost-value {
            color: #166534; 
            font-weight: 500;
        }
        .custos-lista li .cost-date {
            font-size: 0.8rem;
            color: #6b7280;
            margin-left: 0.5rem;
        }
        .custos-lista li .remove-cost-btn {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            padding: 0.25rem;
            margin-left: 1rem;
        }
        .custos-lista li .remove-cost-btn:hover {
            color: #b91c1c;
        }
        .custo-unitario-display {
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: #f8f0f4; 
            border-radius: 6px;
            border-top: 2px solid #f8b81f;
        }
        .custo-unitario-display p {
            margin-bottom: 0.6rem;
            font-size: 1rem;
            color: #500724;
        }
        .custo-unitario-display p:last-child {
            margin-bottom: 0;
        }
        .custo-unitario-display strong {
            color: #db1472;
            font-size: 1.1rem;
        }
        #total-produtos-estoque-simulado { 
            padding: 0.3rem 0.5rem;
            font-size: 0.9rem;
            border-radius: 4px;
            border: 1px solid #fbcfe8;
        }

        /* --- NOVOS ESTILOS PARA PRODUTOS E VENDAS EM CARDS --- */
        .item-cards-container { 
            display: grid;
            grid-template-columns: 1fr; 
            gap: 1.5rem; 
            margin-top: 1.5rem;
        }
        @media (min-width: 640px) { 
            .item-cards-container { 
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .product-card, .sale-card { 
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            padding: 1.2rem;
            display: flex;
            flex-direction: column;
            border-left: 5px solid #f8b81f; 
        }
        .product-card:hover, .sale-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .product-card-image {
            width: 100%;
            max-height: 180px;
            object-fit: cover;
            border-radius: 6px;
            margin-bottom: 1rem;
        }
        .product-card h4, .sale-card h4 {
            font-size: 1.2rem;
            color: #db1472;
            margin-top: 0;
            margin-bottom: 0.5rem;
        }
        .product-card p, .sale-card p {
            font-size: 0.9rem;
            color: #4b5563;
            margin-bottom: 0.3rem;
            line-height: 1.4;
        }
        .product-card p strong, .sale-card p strong {
            color: #374151;
        }
        .product-card .actions-cell, .sale-card .actions-cell { 
            margin-top: auto; 
            padding-top: 0.75rem;
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }
         .sale-card .status-badge { 
            display: inline-block; 
            margin-top: 0.5rem;
        }
        /* FIM NOVOS ESTILOS */


        /* P√°gina Liberdade Financeira */
        .dividas-list-container {
            margin-top: 1.5rem;
            display: grid;
            grid-template-columns: 1fr; 
            gap: 1rem;
        }
         @media (min-width: 768px) { 
            .dividas-list-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .divida-card {
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            color: #374151; 
        }
        .prioridade-baixa-bg { background-color: #d1fae5; border-left: 5px solid #10b981;} 
        .prioridade-media-bg { background-color: #fef9c3; border-left: 5px solid #f59e0b;} 
        .prioridade-alta-bg { background-color: #fee2e2; border-left: 5px solid #ef4444;}  

        .divida-card h4 {
            margin-top: 0;
            margin-bottom: 0.5rem;
            color: #db1472;
        }
        .divida-card p {
            margin-bottom: 0.4rem;
            font-size: 0.95rem;
        }
        .divida-card .divida-actions {
            margin-top: 1rem;
            text-align: right;
        }
        .frase-apoio {
            text-align: center;
            font-size: 1.1rem;
            font-weight: 500;
            color: #c01062;
            padding: 1.5rem;
            background-color: #fdf2f8;
            border-radius: 8px;
            margin-top: 2rem;
            border: 1px dashed #fbcfe8;
        }
        #planejamento-quitacao-divida-page .form-container,
        #planejamento-quitacao-divida-page .summary-section { 
            margin-bottom: 1.5rem;
        }
        @media (min-width: 992px) { 
            #planejamento-quitacao-divida-page .planejamento-layout-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 1.5rem;
                align-items: flex-start;
            }
        }
        .progress-bar-container {
            width: 100%;
            background-color: #e2e8f0;
            border-radius: 6px;
            height: 25px;
            margin: 1rem 0;
            overflow: hidden; 
        }
        .progress-bar-fill {
            width: 0%; 
            height: 100%;
            background-color: #f8b81f; 
            border-radius: 6px 0 0 6px; 
            transition: width 0.5s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #5c3c00;
            font-size: 0.85rem;
            font-weight: 600;
        }

        /* Lucro Certo Page Specific Styles */
        #lucro-certo-page .form-group {
            margin-bottom: 0.8rem; 
        }
        #lucro-certo-page .form-group label {
            margin-bottom: 0.2rem;
            font-size: 0.9rem;
        }
        #lucro-certo-page .form-group input,
        #lucro-certo-page .form-group select {
            padding: 0.6rem;
            font-size: 0.95rem;
        }
        .lucro-certo-main-content {
            display: grid;
            grid-template-columns: 1fr; 
            gap: 1.5rem;
        }
        @media(min-width: 768px){ 
             .lucro-certo-main-content {
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            }
        }
        .lucro-card {
            background-color: #ffffff;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
        }
        .lucro-card h3 {
            color: #c01062; 
            font-size: 1.3rem;
            margin-top: 0;
            margin-bottom: 1rem;
            border-bottom: 1px solid #fbcfe8;
            padding-bottom: 0.5rem;
        }
        .lucro-info p {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.6rem;
            font-size: 1rem;
        }
        .lucro-info p strong {
            color: #db1472;
        }
        .lucro-info .destaque-lucro {
            font-size: 1.3rem;
            font-weight: 700;
            color: #16a34a; 
        }
         .lucro-info .destaque-preco {
            font-size: 1.3rem;
            font-weight: 700;
            color: #db1472; 
        }
        .lucro-certo-alert {
            padding: 0.75rem 1rem;
            margin-top: 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        .alert-warning { 
            background-color: #fffbeb;
            color: #b45309;
            border: 1px solid #fde68a;
        }
         .alert-info { 
            background-color: #eff6ff;
            color: #1d4ed8;
            border: 1px solid #bfdbfe;
        }
        #lucro-produto-chart-container {
            max-width: 280px; 
            margin: 1rem auto;
        }

        /* P√°gina Calculadoras Hub */
        .calculators-grid-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 2 colunas no mobile */
            gap: 16px; /* Espa√ßamento lateral e entre cards */
            padding: 0 16px; /* Margens laterais */
        }
        @media (min-width: 992px) { /* 3 colunas para desktop */
            .calculators-grid-container {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        .calculator-card {
            background-color: #ffffff;
            border-radius: 10px;
            padding: 1.5rem 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            border: 1px solid #fbcfe8; /* Borda rosa clara */
            display: flex; /* Para alinhar conte√∫do verticalmente */
            flex-direction: column;
            justify-content: center;
            min-height: 150px; /* Altura m√©dia */
        }
        .calculator-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(219, 20, 114, 0.15); /* Sombra rosa no hover */
        }
        .calculator-card svg {
            width: 48px;
            height: 48px;
            margin-bottom: 0.75rem;
            color: #db1472; /* √çcone rosa */
            align-self: center; /* Centraliza SVG no flex container */
        }
        .calculator-card h4 {
            font-size: 1.1rem;
            color: #500724; /* Rosa escuro */
            margin: 0;
            font-weight: 600;
        }
        .calculator-page .form-container { /* Estilo espec√≠fico para containers de formul√°rio dentro das calculadoras */
            max-width: 600px; /* Limita a largura para melhor leitura */
            margin-left: auto;
            margin-right: auto;
        }
        .calculator-page .btn-voltar-calculadoras {
            display: inline-flex; /* Para o √≠cone alinhar com o texto */
            align-items: center;
        }


    </style>
    <!-- 
        Coment√°rio: Links para Google Fonts (Exemplo: Poppins)
    -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

</head>
<body>
    <div id="app-overlay" class="overlay"></div>

    <aside id="sidebar-nav" class="sidebar-nav">
        <div class="sidebar-nav-header">
            <h2 class="sidebar-title">C4</h2>
            <button class="close-btn" id="close-sidebar-btn" aria-label="Fechar menu">&times;</button>
        </div>
        <div class="sidebar-nav-links">
            <!-- Coment√°rio: Itens de navega√ß√£o da sidebar -->
            <a href="#dashboard" class="sidebar-nav-item active" data-page="dashboard-page">
                <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                Dashboard
            </a>
            <a href="#produtos" class="sidebar-nav-item" data-page="produtos-page">
                <svg viewBox="0 0 24 24"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>
                Produtos
            </a>
            <a href="#vendas" class="sidebar-nav-item" data-page="vendas-page">
                <svg viewBox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
                Vendas
            </a>
            <a href="#despesas" class="sidebar-nav-item" data-page="despesas-page">
                <svg viewBox="0 0 24 24"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg>
                Despesas
            </a>
            <a href="#liberdade-financeira" class="sidebar-nav-item" data-page="liberdade-financeira-page">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>
                Liberdade Financeira
            </a>
            <a href="#lucro-certo" class="sidebar-nav-item" data-page="lucro-certo-page">
                <svg viewBox="0 0 24 24"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path><path d="M22 12A10 10 0 0 0 12 2v10z"></path></svg>
                Lucro Certo
            </a>
            <a href="#calculadoras" class="sidebar-nav-item" data-page="calculadoras-page"> <!-- NOVO ITEM DE MENU -->
                <svg viewBox="0 0 24 24"><rect x="4" y="2" width="16" height="20" rx="2" ry="2"></rect><line x1="8" y1="6" x2="16" y2="6"></line><line x1="8" y1="10" x2="16" y2="10"></line><line x1="8" y1="14" x2="16" y2="14"></line><line x1="8" y1="18" x2="16" y2="18"></line></svg>
                Calculadoras
            </a>
            <a href="#metas" class="sidebar-nav-item" data-page="metas-page">
                <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>
                Metas
            </a>
            <a href="#relatorios" class="sidebar-nav-item" data-page="relatorios-page">
                <svg viewBox="0 0 24 24"><line x1="12" y1="20" x2="12" y2="10"></line><line x1="18" y1="20" x2="18" y2="4"></line><line x1="6" y1="20" x2="6" y2="16"></line></svg>
                Relat√≥rios
            </a>
            <a href="#c4-ia" class="sidebar-nav-item" data-page="c4-ia-page">
                <svg viewBox="0 0 24 24"><path d="M12 2a10 10 0 0 0-10 10c0 6 8 10 10 10s10-4 10-10A10 10 0 0 0 12 2z"></path><path d="M12 10a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"></path><path d="M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"></path><path d="M12 18a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"></path></svg>
                C4 IA
            </a>
            <a href="#perfil" class="sidebar-nav-item" data-page="perfil-page"> 
                <svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                Perfil
            </a>
        </div>
    </aside>

    <header class="app-header header-gradient">
        <button class="menu-toggle" id="menu-toggle-btn" aria-label="Abrir menu">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path>
            </svg>
        </button>
        <h1 class="app-header-title">C4</h1> 
        <div><!-- Espa√ßo para √≠cone de perfil/notifica√ß√µes no futuro --></div>
    </header>

    <main id="app-content">
        <!-- Etapa 2: Dashboard -->
        <section id="dashboard-page" class="page-content active">
            <h2 class="page-title">Dashboard</h2>
            
            <div class="cards-container" id="dashboard-cards-summary">
                <div class="card">
                    <h3 class="card-title">Resumo do Dia</h3>
                    <p class="card-value">R$ 1.250,75</p>
                    <p class="card-description">Total de vendas hoje</p>
                </div>
                <div class="card">
                    <h3 class="card-title">Meta Mensal</h3>
                    <p class="card-value">65%</p>
                    <p class="card-description">Progresso: R$ 6.500 / R$ 10.000</p>
                </div>
                <div class="card">
                    <h3 class="card-title">Lucro L√≠quido (M√™s)</h3>
                    <p class="card-value">R$ 2.800,00</p>
                    <p class="card-description">Ap√≥s todas as despesas</p>
                </div>
            </div>

            <div class="quick-actions" id="dashboard-quick-actions">
                <button class="btn-action" data-target-page="vendas-page">Nova Venda</button>
                <button class="btn-action" data-target-page="produtos-page">Novo Produto</button>
                <button class="btn-action" data-target-page="calculadoras-page">Calculadoras</button>
            </div>

            <h3 class="page-title" style="margin-top: 2.5rem; font-size: 1.6rem; border-bottom-color: #db1472;">Acompanhamento de Metas</h3>
            <div class="chart-container" id="dashboard-goals-chart">
                <p>Gr√°fico de Metas aparecer√° aqui.</p>
            </div>
        </section>

        <!-- Etapa 3: Produtos -->
        <section id="produtos-page" class="page-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
                <h2 class="page-title" style="margin-bottom: 0;">Produtos</h2>
                <button class="btn btn-primary" id="btn-show-add-product-form">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                    Adicionar Produto
                </button>
            </div>

            <div id="form-cadastro-produto-container" class="form-container" style="display: none;">
                <h3 style="color: #db1472; font-weight: 600; margin-top:0; margin-bottom: 1.5rem;">Cadastrar Novo Produto</h3>
                <form id="form-cadastro-produto">
                    <div class="form-group">
                        <label for="produto-nome">Nome do Produto</label>
                        <input type="text" id="produto-nome" name="produto-nome" required>
                    </div>
                    <div class="form-group">
                        <label for="produto-categoria">Categoria</label>
                        <select id="produto-categoria" name="produto-categoria">
                            <option value="">Selecione uma categoria</option>
                            <option value="bolsas">Bolsas</option>
                            <option value="carteiras">Carteiras</option>
                            <option value="acessorios">Acess√≥rios</option>
                            <option value="vestuario">Vestu√°rio</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="produto-descricao">Descri√ß√£o</label>
                        <textarea id="produto-descricao" name="produto-descricao"></textarea>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div class="form-group">
                            <label for="produto-valor-custo">Valor de Custo (Compra) (R$)</label>
                            <input type="number" id="produto-valor-custo" name="produto-valor-custo" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="produto-estoque">Quantidade em Estoque</label>
                            <input type="number" id="produto-estoque" name="produto-estoque" step="1" min="0" required>
                        </div>
                    </div>
                    <div class="costs-display-section">
                        <h4>Custos Detalhados por Unidade:</h4>
                        <p>Custo Fixo Unit√°rio (Supabase): <strong id="display-custo-fixo">R$ 0.00</strong></p>
                        <p>Custo Vari√°vel Unit√°rio (Supabase): <strong id="display-custo-variavel">R$ 0.00</strong></p>
                        <p>Custo de Frete por Unidade (Supabase): <strong id="display-custo-frete">R$ 0.00</strong></p>
                        <hr style="border: none; border-top: 1px dashed #fbcfe8; margin: 0.75rem 0;">
                        <p style="font-size: 1.1rem;">Custo Total por Unidade (Calculado): <strong id="display-custo-total-unidade" style="font-size: 1.2rem;">R$ 0.00</strong></p>
                    </div>
                    <div class="form-group" style="margin-top: 1.5rem;">
                        <label for="produto-imagem">Imagem do Produto</label>
                        <input type="file" id="produto-imagem" name="produto-imagem" accept="image/*">
                        <img id="produto-imagem-preview" class="image-preview" src="#" alt="Pr√©-visualiza√ß√£o da imagem">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="btn-cancel-add-product">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar Produto</button>
                    </div>
                </form>
            </div>

            <h3 style="color: #db1472; font-weight: 500; margin-top: 2rem;">Lista de Produtos Cadastrados</h3>
            <div class="item-cards-container" id="product-cards-list">
                <!-- Cards de Produto s√£o inseridos aqui pelo JS -->
            </div>
            <p id="no-products-message" style="text-align: center; color: #6b7280; padding: 1rem; display: none;">Nenhum produto cadastrado ainda.</p>
            
            <div id="product-details-container" class="form-container" style="display:none;">
                <h3 style="color: #db1472; font-weight: 600;">Detalhes do Produto</h3>
                <div id="product-details-content"><p>Selecione um produto para ver os detalhes.</p></div>
                 <div class="form-actions" style="justify-content: flex-start; margin-top:1rem;">
                    <button type="button" class="btn btn-secondary" id="btn-close-product-details">Fechar Detalhes</button>
                </div>
            </div>
        </section>

        <!-- Etapa 4: Vendas -->
        <section id="vendas-page" class="page-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
                <h2 class="page-title" style="margin-bottom: 0;">Vendas</h2>
                <button class="btn btn-primary" id="btn-show-nova-venda-form">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                    Nova Venda
                </button>
            </div>
            <div id="form-nova-venda-container" class="form-container" style="display: none;">
                <h3 style="color: #db1472; font-weight: 600; margin-top:0; margin-bottom: 1.5rem;">Registar Nova Venda</h3>
                <form id="form-nova-venda">
                    <div class="form-group">
                        <label for="venda-cliente">Cliente (Opcional)</label>
                        <input type="text" id="venda-cliente" name="venda-cliente" placeholder="Nome do cliente">
                    </div>
                    <fieldset style="border: 1px solid #e2e8f0; border-radius: 6px; padding: 1rem; margin-bottom: 1.5rem;">
                        <legend style="color: #4b5563; font-weight:500; padding: 0 0.5rem;">Adicionar Produtos</legend>
                        <div style="display: flex; gap: 1rem; align-items: flex-end; margin-bottom:1rem;">
                            <div class="form-group" style="flex-grow:3; margin-bottom:0;">
                                <label for="venda-produto-select">Produto</label>
                                <select id="venda-produto-select" name="venda-produto-select">
                                    <option value="">Selecione um produto</option>
                                    <!-- Populado por JS -->
                                </select>
                            </div>
                            <div class="form-group" style="flex-grow:1; margin-bottom:0;">
                                <label for="venda-produto-qtd">Qtd.</label>
                                <input type="number" id="venda-produto-qtd" name="venda-produto-qtd" min="1" value="1" style="width: 70px;">
                            </div>
                            <button type="button" class="btn btn-secondary" id="btn-add-produto-venda" style="padding: 0.7rem;">Adicionar</button>
                        </div>
                        <h4 style="color:#500724; font-weight:500; margin-top:1.5rem; margin-bottom:0.5rem;">Itens da Venda:</h4>
                        <ul id="venda-itens-lista" class="sale-items-list" style="list-style: none; padding:0;">
                             <p id="venda-sem-itens" style="text-align: center; color: #6b7280; padding: 1rem 0;">Nenhum item adicionado √† venda.</p>
                        </ul>
                    </fieldset>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div class="form-group">
                            <label for="venda-desconto">Desconto (%)</label>
                            <input type="number" id="venda-desconto" name="venda-desconto" min="0" max="100" value="0">
                        </div>
                        <div class="form-group">
                            <label for="venda-forma-pagamento">Forma de Pagamento</label>
                            <select id="venda-forma-pagamento" name="venda-forma-pagamento" required>
                                <option value="dinheiro">Dinheiro</option><option value="cartao_debito">Cart√£o de D√©bito</option>
                                <option value="cartao_credito">Cart√£o de Cr√©dito</option><option value="pix">PIX</option>
                                <option value="boleto">Boleto</option>
                            </select>
                        </div>
                    </div>
                    <div id="sale-summary">
                        <p>Subtotal: <span id="venda-subtotal">R$ 0,00</span></p>
                        <p>Desconto (<span id="venda-desconto-perc">0</span>%): <span id="venda-valor-desconto">R$ 0,00</span></p>
                        <p class="total">Total a Pagar: <span id="venda-total-pagar">R$ 0,00</span></p>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="btn-cancel-nova-venda">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Finalizar Venda</button>
                    </div>
                </form>
            </div>
            <h3 style="color: #db1472; font-weight: 500; margin-top: 2rem;">Hist√≥rico de Vendas</h3>
            <div class="filters-container">
                 <div class="form-group">
                    <label for="filtro-venda-data">Data</label>
                    <input type="date" id="filtro-venda-data" name="filtro-venda-data">
                </div>
                <div class="form-group">
                    <label for="filtro-venda-cliente">Cliente</label>
                    <input type="text" id="filtro-venda-cliente" name="filtro-venda-cliente" placeholder="Nome do cliente">
                </div>
                <div class="form-group">
                    <label for="filtro-venda-status">Status</label>
                     <select id="filtro-venda-status" name="filtro-venda-status">
                        <option value="">Todos</option><option value="pago">Pago</option>
                        <option value="pendente">Pendente</option><option value="cancelado">Cancelado</option>
                    </select>
                </div>
                <button type="button" class="btn btn-secondary" id="btn-aplicar-filtros-venda" style="align-self: flex-end; padding: 0.7rem;">Aplicar Filtros</button>
            </div>
            <div class="item-cards-container" id="sales-history-cards-list">
                <!-- Cards de Hist√≥rico de Vendas s√£o inseridos aqui pelo JS -->
            </div>
             <p id="no-vendas-message" style="text-align: center; color: #6b7280; padding: 1rem; display: none;">Nenhuma venda registada ainda.</p>
        </section>
        
        <!-- Etapa 5: Despesas -->
        <section id="despesas-page" class="page-content">
            <h2 class="page-title">Despesas</h2>
            <div class="despesas-cards-container">
                <div class="card-despesa" id="card-custos-fixos">
                    <h3 class="card-despesa-title">üßæ Custos Fixos</h3>
                    <p class="informativo">Custos fixos s√£o aqueles que voc√™ paga todos os meses, independentemente de vender ou n√£o. Ex: aluguel, contador, internet, etc.</p>
                    <form id="form-add-custo-fixo">
                        <div class="form-group">
                            <label for="custo-fixo-nome">Nome do Custo Fixo</label>
                            <input type="text" id="custo-fixo-nome" placeholder="Ex: Aluguel do Ateli√™" required>
                        </div>
                        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label for="custo-fixo-valor">Valor Mensal (R$)</label>
                                <input type="number" id="custo-fixo-valor" step="0.01" min="0" placeholder="Ex: 800,00" required>
                            </div>
                            <div class="form-group">
                                <label for="custo-fixo-vencimento">Vencimento</label>
                                <input type="date" id="custo-fixo-vencimento">
                            </div>
                        </div>
                        <div class="form-actions" style="justify-content: flex-start;">
                            <button type="submit" class="btn btn-primary btn-sm">Adicionar Custo Fixo</button>
                        </div>
                    </form>
                    <h4 style="margin-top:1.5rem; color:#500724;">Custos Fixos Cadastrados:</h4>
                    <ul id="lista-custos-fixos" class="custos-lista">
                        <p id="sem-custos-fixos" style="text-align:center; padding:1rem; color:#6b7280;">Nenhum custo fixo adicionado.</p>
                    </ul>
                    <div class="custo-unitario-display">
                        <p>Total Custos Fixos Mensais: <strong id="total-custos-fixos-mensais">R$ 0,00</strong></p>
                        <div class="form-group" style="margin-bottom:0.5rem;">
                            <label for="total-produtos-estoque-simulado" style="font-size:0.9rem; display:inline-block; margin-right:0.5rem;">Total Produtos em Estoque (Simulado):</label>
                            <input type="number" id="total-produtos-estoque-simulado" value="1" min="1" style="width: 80px;">
                        </div>
                        <p><strong>Custo Fixo Unit√°rio:</strong> <strong id="custo-fixo-unitario-display">R$ 0,00</strong></p>
                    </div>
                </div>
                <div class="card-despesa" id="card-custos-variaveis">
                    <h3 class="card-despesa-title">‚öôÔ∏è Custos Vari√°veis</h3>
                    <p class="informativo">Custos vari√°veis s√£o aqueles que voc√™ s√≥ tem quando realiza uma venda. Ex: embalagem, comiss√£o, taxas, etc.</p>
                     <form id="form-add-custo-variavel">
                        <div class="form-group">
                            <label for="custo-variavel-nome">Nome do Custo Vari√°vel</label>
                            <input type="text" id="custo-variavel-nome" placeholder="Ex: Embalagem por produto" required>
                        </div>
                        <div class="form-group">
                            <label for="custo-variavel-valor-unitario">Valor Unit√°rio (R$)</label>
                            <input type="number" id="custo-variavel-valor-unitario" step="0.01" min="0" placeholder="Ex: 2,50" required>
                        </div>
                        <div class="form-actions" style="justify-content: flex-start;">
                            <button type="submit" class="btn btn-primary btn-sm">Adicionar Custo Vari√°vel</button>
                        </div>
                    </form>
                    <h4 style="margin-top:1.5rem; color:#500724;">Custos Vari√°veis Cadastrados:</h4>
                    <ul id="lista-custos-variaveis" class="custos-lista">
                         <p id="sem-custos-variaveis" style="text-align:center; padding:1rem; color:#6b7280;">Nenhum custo vari√°vel adicionado.</p>
                    </ul>
                    <div class="custo-unitario-display">
                        <p><strong>Custo Vari√°vel Unit√°rio Total:</strong> <strong id="custo-variavel-unitario-total-display">R$ 0,00</strong></p>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- M√ìDULO LIBERDADE FINANCEIRA -->
        <section id="liberdade-financeira-page" class="page-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
                <h2 class="page-title" style="margin-bottom: 0;">Liberdade Financeira</h2>
                <button class="btn btn-primary" id="btn-show-add-divida-form">
                     <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                    Adicionar D√≠vida
                </button>
            </div>

            <!-- Container do Formul√°rio de Nova D√≠vida (inicialmente oculto) -->
            <div id="form-add-divida-container" class="form-container" style="display: none;">
                <h3 style="color: #db1472; font-weight: 600; margin-top:0; margin-bottom: 1.5rem;">Cadastrar Nova D√≠vida</h3>
                <form id="form-add-divida">
                    <div class="form-group">
                        <label for="divida-nome">Nome da D√≠vida</label>
                        <input type="text" id="divida-nome" name="divida-nome" placeholder="Ex: Cart√£o de Cr√©dito Loja X" required>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div class="form-group">
                            <label for="divida-valor-total">Valor Total da D√≠vida (R$)</label>
                            <input type="number" id="divida-valor-total" name="divida-valor-total" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="divida-tipo">Tipo de D√≠vida</label>
                            <select id="divida-tipo" name="divida-tipo" required>
                                <option value="">Selecione o tipo</option>
                                <option value="emprestimo">Empr√©stimo Pessoal</option>
                                <option value="cartao">Cart√£o de Cr√©dito</option>
                                <option value="boleto">Boleto/Carn√™</option>
                                <option value="financiamento_veiculo">Financiamento de Ve√≠culo</option>
                                <option value="financiamento_imovel">Financiamento de Im√≥vel</option>
                                <option value="outros">Outros</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <input type="checkbox" id="divida-e-parcelada" name="divida-e-parcelada" style="margin-right: 5px;">
                        <label for="divida-e-parcelada" style="font-weight:normal; display:inline;">Esta d√≠vida √© parcelada?</label>
                    </div>
                    <div id="divida-parcelas-detalhes" style="display: none; background-color: #fdf2f8; padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
                         <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                            <div class="form-group">
                                <label for="divida-num-parcelas">N√∫mero de Parcelas</label>
                                <input type="number" id="divida-num-parcelas" name="divida-num-parcelas" min="1">
                            </div>
                            <div class="form-group">
                                <label for="divida-valor-parcela">Valor de Cada Parcela (R$)</label>
                                <input type="number" id="divida-valor-parcela" name="divida-valor-parcela" step="0.01" min="0">
                            </div>
                        </div>
                    </div>
                     <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div class="form-group">
                            <label for="divida-data-vencimento">Data de Vencimento (Pr√≥xima/√önica)</label>
                            <input type="date" id="divida-data-vencimento" name="divida-data-vencimento" required>
                        </div>
                        <div class="form-group">
                            <label for="divida-prioridade">Grau de Prioridade</label>
                            <select id="divida-prioridade" name="divida-prioridade" required>
                                <option value="baixa">Baixa</option>
                                <option value="media" selected>M√©dia</option>
                                <option value="alta">Alta</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="divida-observacoes">Observa√ß√µes</label>
                        <textarea id="divida-observacoes" name="divida-observacoes" placeholder="Ex: Juros altos, tentar renegociar..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="btn-cancel-add-divida">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar D√≠vida</button>
                    </div>
                </form>
            </div>

            <!-- Lista de D√≠vidas -->
            <h3 style="color: #db1472; font-weight: 500; margin-top: 2rem;">Minhas D√≠vidas</h3>
            <div class="filters-container" style="margin-bottom: 1rem;">
                <label for="ordenar-dividas" style="align-self:center; margin-right:0.5rem; font-weight:500; color:#4b5563;">Ordenar por:</label>
                <select id="ordenar-dividas" class="form-group" style="padding:0.5rem; min-width: 180px;">
                    <option value="prioridade">Prioridade (Alta > Baixa)</option>
                    <option value="vencimento">Data de Vencimento (Mais pr√≥xima)</option>
                    <option value="valor_restante_desc">Valor Restante (Maior > Menor)</option>
                    <option value="valor_restante_asc">Valor Restante (Menor > Maior)</option>
                </select>
            </div>
            <div id="lista-dividas-container" class="dividas-list-container">
                 <p id="sem-dividas-message" style="text-align: center; color: #6b7280; padding: 1rem;">Nenhuma d√≠vida cadastrada ainda. Respire fundo, voc√™ est√° no caminho certo!</p>
            </div>
            
            <div class="frase-apoio" style="margin-top:2rem;">
                <p id="frase-apoio-liberdade">Voc√™ est√° a <strong id="passos-liberdade">X</strong> passos da sua liberdade financeira!</p>
            </div>
        </section>

        <!-- Nova P√°gina/Sec√ß√£o: Planejamento de Quita√ß√£o de D√≠vida -->
        <section id="planejamento-quitacao-divida-page" class="page-content">
            <button class="btn btn-secondary btn-voltar-calculadoras" id="btn-voltar-para-dividas" style="margin-bottom: 1.5rem;"> <!-- ID corrigido -->
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                Voltar para Minhas D√≠vidas
            </button>
            <h2 class="page-title" id="titulo-planejamento-divida">Planejar Quita√ß√£o: <span style="color:#c01062;">Nome da D√≠vida</span></h2>
            <div class="planejamento-layout-grid">
                <div class="form-container">
                    <h3 class="sub-page-title">üí∞ Defina sua Estrat√©gia</h3>
                    <p>D√≠vida Selecionada: <strong id="planejamento-nome-divida-display">N/A</strong></p>
                    <p>Valor Total: <strong id="planejamento-valor-total-display">R$ 0,00</strong></p>
                    <div class="form-group">
                        <label for="planejamento-poupanca">Quanto voc√™ pode poupar?</label>
                        <input type="number" id="planejamento-poupanca" step="0.01" min="0.01" value="50">
                    </div>
                    <div class="form-group">
                        <label for="planejamento-periodo">Com qual frequ√™ncia?</label>
                        <select id="planejamento-periodo">
                            <option value="dia">por Dia</option><option value="semana">por Semana</option>
                            <option value="quinzena" selected>por Quinzena</option><option value="mes">por M√™s</option>
                        </select>
                    </div>
                     <div class="form-group">
                        <label for="planejamento-valor-ja-pago">Valor j√° pago/dispon√≠vel para esta d√≠vida (R$):</label>
                        <input type="number" id="planejamento-valor-ja-pago" step="0.01" min="0" value="0">
                    </div>
                    <div class="form-actions" style="justify-content: flex-start;">
                        <button class="btn btn-primary" id="btn-calcular-quitacao">Calcular Tempo de Quita√ß√£o</button>
                    </div>
                    <p id="resultado-calculo-quitacao" style="font-weight:600; color:#166534; margin-top:1rem;"></p>
                </div>
                <div class="form-container" style="background-color: #fdf2f8;">
                    <h3 class="sub-page-title">üéØ Sua Meta de Quita√ß√£o</h3>
                    <p>D√≠vida: <strong id="meta-nome-divida-display">N/A</strong></p>
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill" id="quitacao-progress-bar" style="width: 0%;">0%</div>
                    </div>
                    <p>Total da D√≠vida: <strong id="meta-total-divida-display">R$ 0,00</strong></p>
                    <p>Valor J√° Pago/Guardado: <strong id="meta-valor-pago-display">R$ 0,00</strong></p>
                    <p>Falta para Quitar: <strong id="meta-falta-quitar-display">R$ 0,00</strong></p>
                    <div class="form-actions" style="justify-content: center;">
                         <button class="btn btn-primary" id="btn-criar-meta-quitacao-real">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:8px;"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg>
                            Criar Meta no App
                        </button>
                    </div>
                </div>
            </div>
             <div class="planejamento-layout-grid" style="margin-top:1.5rem;">
                 <div class="summary-section" id="sugestoes-vendas-quitacao">
                    <h3 class="sub-page-title">üí° Ideias para Acelerar</h3>
                    <p>Voc√™ precisaria vender aproximadamente:</p>
                    <ul id="lista-sugestoes-vendas-quitacao" style="list-style-type: disclosure-closed; padding-left: 20px;">
                        <li><em>(Sugest√µes de vendas aparecer√£o aqui)</em></li>
                    </ul>
                </div>
                <div class="summary-section" id="sugestoes-economia-quitacao">
                    <h3 class="sub-page-title">üí∞ Dica de Economia</h3>
                     <p id="dica-economia-quitacao"><em>(Dica de economia aparecer√° aqui)</em></p>
                </div>
            </div>
        </section>

        <!-- Etapa 6: Lucro Certo -->
        <section id="lucro-certo-page" class="page-content">
            <h2 class="page-title">üéØ Lucro Certo</h2>
            <div class="form-group">
                <label for="lucro-produto-select">Selecione um Produto para An√°lise:</label>
                <select id="lucro-produto-select">
                    <option value="">-- Escolha um Produto --</option>
                    <!-- Produtos ser√£o populados por JS -->
                </select>
            </div>

            <div id="lucro-certo-content" style="display:none;"> 
                <div class="lucro-certo-main-content">
                    <div class="lucro-card" id="analise-produto-lucro">
                        <h3>An√°lise do Produto: <span id="lucro-nome-produto-display" style="color:#db1472;"></span></h3>
                        <div class="lucro-info">
                            <p>Custo Total Unit√°rio: <strong id="lucro-custo-total-display">R$ 0,00</strong></p>
                            <div class="form-group">
                                <label for="lucro-margem-desejada">Margem de Lucro Desejada (%):</label>
                                <input type="number" id="lucro-margem-desejada" value="50" min="0"> 
                            </div>
                            <p>Pre√ßo de Venda Sugerido: <strong class="destaque-preco" id="lucro-preco-venda-sugerido">R$ 0,00</strong></p>
                            <p>Lucro L√≠quido por Unidade: <strong class="destaque-lucro" id="lucro-liquido-unidade">R$ 0,00</strong></p>
                        </div>
                        <div id="lucro-produto-chart-container">
                             <canvas id="lucro-produto-chart"></canvas>
                        </div>
                         <div id="alerta-margem-baixa" class="lucro-certo-alert alert-warning" style="display:none;">
                            <strong>Aten√ß√£o!</strong> Sua margem de lucro est√° abaixo de 30%. Considere revisar seus custos ou pre√ßo de venda.
                        </div>
                    </div>

                    <div class="lucro-card" id="projecoes-metas-lucro">
                        <h3>Proje√ß√µes e Metas</h3>
                        <div class="form-group">
                            <label for="lucro-qtd-vender-mes">Se eu vender <input type="number" id="lucro-qtd-vender-mes" value="10" min="1" style="width:70px; padding:0.3rem; text-align:center;"> unidades/m√™s:</label>
                            <p>Lucro Mensal Projetado: <strong class="destaque-lucro" id="lucro-mensal-projetado">R$ 0,00</strong></p>
                        </div>
                        <hr style="margin: 1.5rem 0; border-color: #fbcfe8;">
                        <div class="form-group">
                             <label for="lucro-desejado-mensal">Para lucrar R$ <input type="number" id="lucro-desejado-mensal" value="1000" min="1" step="50" style="width:100px; padding:0.3rem; text-align:center;"> por m√™s:</label>
                            <p>Voc√™ precisa vender: <strong id="lucro-meta-vendas-unidades" style="color:#c01062;">0 unidades</strong></p>
                        </div>
                    </div>
                </div>

                 <div class="lucro-card" id="alertas-recomendacoes-lucro" style="margin-top:1.5rem;">
                    <h3>üí° Alertas e Recomenda√ß√µes</h3>
                    <div id="custo-oculto-alerta" class="lucro-certo-alert alert-info" style="display: none;">
                        <strong>Lembrete:</strong> J√° contabilizou todos os custos vari√°veis como taxas de cart√£o, comiss√µes ou pequenos brindes?
                    </div>
                     <div id="sugestao-preco-ideal" class="lucro-certo-alert alert-info" style="display:none;">
                        <p><strong>Sugest√£o de Pre√ßo Ideal:</strong> Com base nos seus custos e uma margem X, seu pre√ßo poderia ser Y.</p>
                    </div>
                     <div id="sugestao-ajuste-custo" class="lucro-certo-alert alert-info" style="display:none;">
                        <p><strong>Ajuste de Custos:</strong> Para aumentar seu lucro, tente negociar com fornecedores ou otimizar o uso de materiais.</p>
                    </div>
                </div>
            </div>
            <p id="lucro-certo-selecione-produto-msg" style="text-align:center; color:#6b7280; padding:1rem;">Selecione um produto acima para ver a an√°lise de lucro.</p>

        </section>

        <!-- Etapa 6: Calculadoras (HUB) -->
        <section id="calculadoras-page" class="page-content">
            <h2 class="page-title">Calculadoras</h2>
            <p style="text-align: center; margin-bottom: 2rem; color: #500724;">Selecione uma calculadora abaixo para come√ßar!</p>

            <div class="calculators-grid-container">
                <div class="calculator-card" data-target-calculator="calc-lucro-ideal-page">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"></path><circle cx="12" cy="12" r="3"></circle></svg> 
                    <h4>Lucro Ideal</h4>
                </div>
                <div class="calculator-card" data-target-calculator="calc-frete-unitario-page">
                     <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2.5 17a2.5 2.5 0 100-5 2.5 2.5 0 000 5zM16 6a3 3 0 100-6 3 3 0 000 6zM21 14H3M7 14V4M18 14h1a2 2 0 002-2V7a2 2 0 00-2-2h-1"></path><path d="M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2"></path><path d="M16 6h2"></path><path d="M14 14h4"></path></svg>
                    <h4>Frete Unit√°rio</h4>
                </div>
                <div class="calculator-card" data-target-calculator="calc-meta-vendas-page">
                     <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg> 
                    <h4>Meta de Vendas</h4>
                </div>
                <div class="calculator-card" data-target-calculator="calc-reinvestimento-page">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path><path d="M12 18V6"></path><path d="M15 9l-3-3-3 3"></path><path d="M9 15l3 3 3-3"></path></svg> 
                    <h4>Reinvestimento Inteligente</h4>
                </div>
                <div class="calculator-card" data-target-calculator="calc-precificacao-manual-page">
                     <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 3l5 5-14 14-5-5 14-14zm-5 5l-1.5-1.5M18 13l-1.5-1.5"></path><path d="M13 7.5l1.5 1.5"></path><path d="M3 21l8-8"></path></svg> 
                    <h4>Precifica√ß√£o Manual</h4>
                </div>
            </div>
        </section>

        <!-- P√°gina: Calculadora de Lucro Ideal -->
        <section id="calc-lucro-ideal-page" class="page-content calculator-page">
            <button class="btn btn-secondary btn-voltar-calculadoras" style="margin-bottom: 1.5rem;">
                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                Voltar para Calculadoras
            </button>
            <h2 class="page-title">Calculadora de Lucro Ideal</h2>
            <div class="form-container">
                <div class="form-group">
                    <label for="calc-lucro-ideal-produto-select">Selecione o Produto:</label>
                    <select id="calc-lucro-ideal-produto-select">
                        <option value="">-- Escolha um Produto --</option>
                        <!-- Populado por JS -->
                    </select>
                </div>
                <div id="calc-lucro-ideal-produto-detalhes" style="display:none;">
                    <p><strong>Custo de Compra:</strong> <span id="calc-lucro-ideal-custo-compra">R$ 0,00</span></p>
                    <p><strong>Custo Fixo Unit√°rio:</strong> <span id="calc-lucro-ideal-custo-fixo">R$ 0,00</span></p>
                    <p><strong>Custo Vari√°vel Unit√°rio:</strong> <span id="calc-lucro-ideal-custo-variavel">R$ 0,00</span></p>
                    <p><strong>Custo Frete Unit√°rio (Estimado):</strong> <span id="calc-lucro-ideal-custo-frete">R$ 0,00</span></p>
                    <p style="font-weight:bold; color:#c01062;">Custo Total do Produto: <strong id="calc-lucro-ideal-custo-total-produto">R$ 0,00</strong></p>
                    <hr style="margin: 1rem 0;">
                    <div class="form-group">
                        <label for="calc-lucro-ideal-margem-desejada">Margem de Lucro Desejada (%):</label>
                        <input type="number" id="calc-lucro-ideal-margem-desejada" value="50" min="0">
                    </div>
                    <div class="form-actions" style="justify-content: flex-start; margin-bottom:1rem;">
                        <button class="btn btn-primary" id="btn-calcular-lucro-ideal">Calcular Lucro Ideal</button>
                    </div>
                    <p style="font-size: 1.1rem;">Pre√ßo de Venda Ideal: <strong class="destaque-preco" id="calc-lucro-ideal-preco-ideal">R$ 0,00</strong></p>
                    <p style="font-size: 1.1rem;">Lucro L√≠quido por Unidade: <strong class="destaque-lucro" id="calc-lucro-ideal-liquido-unidade">R$ 0,00</strong></p>
                    <div class="form-actions">
                        <button class="btn btn-primary btn-sm" id="btn-salvar-preco-produto-lucro-ideal">Salvar Pre√ßo no Produto (Simula√ß√£o)</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- P√°gina: Calculadora de Frete Unit√°rio -->
        <section id="calc-frete-unitario-page" class="page-content calculator-page">
             <button class="btn btn-secondary btn-voltar-calculadoras" style="margin-bottom: 1.5rem;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                Voltar para Calculadoras
            </button>
            <h2 class="page-title">Calculadora de Frete Unit√°rio</h2>
            <div class="form-container">
                <div class="form-group">
                    <label for="calc-frete-total">Valor Total do Frete (R$):</label>
                    <input type="number" id="calc-frete-total" step="0.01" min="0" placeholder="Ex: 50,00">
                </div>
                <div class="form-group">
                    <label for="calc-frete-num-produtos">N√∫mero de Produtos no Pedido:</label>
                    <input type="number" id="calc-frete-num-produtos" min="1" placeholder="Ex: 10">
                </div>
                <div class="form-actions" style="justify-content: flex-start;">
                     <button class="btn btn-primary" id="btn-calcular-frete-unitario">Calcular Frete Unit√°rio</button>
                </div>
                <p style="font-size: 1.1rem; margin-top:1rem;">Custo de Frete por Unidade: <strong class="destaque-preco" id="calc-frete-resultado">R$ 0,00</strong></p>
                <div class="form-actions" style="margin-top:0.5rem;">
                    <button class="btn btn-secondary btn-sm" id="btn-salvar-frete-custo-variavel">Adicionar como Custo Vari√°vel (Simula√ß√£o)</button>
                </div>
            </div>
        </section>

        <!-- P√°gina: Calculadora de Meta de Vendas -->
        <section id="calc-meta-vendas-page" class="page-content calculator-page">
            <button class="btn btn-secondary btn-voltar-calculadoras" style="margin-bottom: 1.5rem;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                Voltar para Calculadoras
            </button>
            <h2 class="page-title">Calculadora de Meta de Vendas</h2>
             <div class="form-container">
                <div class="form-group">
                    <label for="calc-meta-lucro-desejado">Meta de Lucro Mensal Desejada (R$):</label>
                    <input type="number" id="calc-meta-lucro-desejado" step="50" min="0" placeholder="Ex: 1500,00">
                </div>
                <div class="form-group">
                    <label for="calc-meta-produto-chave">Produto Principal para Meta:</label>
                    <select id="calc-meta-produto-chave">
                        <option value="">-- Escolha um Produto Chave --</option>
                        <!-- Populado por JS -->
                    </select>
                </div>
                 <div class="form-actions" style="justify-content: flex-start; margin-bottom: 1rem;">
                     <button class="btn btn-primary" id="btn-calcular-meta-vendas">Calcular Meta de Vendas</button>
                </div>
                <p>Lucro por Unidade do Produto Selecionado: <strong id="calc-meta-lucro-unidade-produto">R$ 0,00</strong></p>
                <hr style="margin: 1rem 0;">
                <p style="font-size: 1.2rem;">Unidades a Vender para Atingir a Meta: <strong class="destaque-lucro" id="calc-meta-unidades-vender">0 unidades</strong></p>
                
                <div class="summary-section" style="margin-top: 1.5rem;">
                    <h4>Sugest√µes de Mix de Produtos:</h4>
                    <p><em>(Esta se√ß√£o mostrar√° combina√ß√µes de produtos para atingir a meta - funcionalidade futura)</em></p>
                    <ul>
                        <li>Vender X unidades do Produto A + Y unidades do Produto B</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- P√°gina: Calculadora de Reinvestimento Inteligente -->
        <section id="calc-reinvestimento-page" class="page-content calculator-page">
            <button class="btn btn-secondary btn-voltar-calculadoras" style="margin-bottom: 1.5rem;">
                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                Voltar para Calculadoras
            </button>
            <h2 class="page-title">Calculadora de Reinvestimento Inteligente</h2>
            <div class="form-container">
                <div class="form-group">
                    <label for="calc-reinvest-lucro-disponivel">Lucro Dispon√≠vel para Reinvestimento (R$):</label>
                    <input type="number" id="calc-reinvest-lucro-disponivel" step="0.01" min="0" placeholder="Ex: 500,00">
                </div>
                <h4 style="color:#c01062; margin-top:1.5rem;">Distribui√ß√£o Sugerida (Padr√£o 50/30/20):</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom:1rem;">
                    <div class="form-group">
                        <label for="calc-reinvest-perc-negocio">% Reinvestir no Neg√≥cio:</label>
                        <input type="number" id="calc-reinvest-perc-negocio" value="50" min="0" max="100">
                    </div>
                    <div class="form-group">
                        <label for="calc-reinvest-perc-reserva">% Reserva Pessoal/Emerg√™ncia:</label>
                        <input type="number" id="calc-reinvest-perc-reserva" value="30" min="0" max="100">
                    </div>
                    <div class="form-group">
                        <label for="calc-reinvest-perc-dividas">% Quita√ß√£o de D√≠vidas:</label>
                        <input type="number" id="calc-reinvest-perc-dividas" value="20" min="0" max="100">
                    </div>
                </div>
                 <p id="calc-reinvest-soma-perc-aviso" style="color: #ef4444; font-size:0.85rem; display:none;">A soma dos percentuais deve ser 100%.</p>

                <div class="form-actions" style="justify-content: flex-start;">
                     <button class="btn btn-primary" id="btn-calcular-reinvestimento">Calcular Distribui√ß√£o</button>
                </div>

                <div id="calc-reinvest-resultados" style="margin-top:1.5rem; padding-top:1rem; border-top: 1px solid #fbcfe8;">
                    <p>Valor para Reinvestir: <strong style="color:#166534;" id="calc-reinvest-valor-negocio">R$ 0,00</strong></p>
                    <p>Valor para Reserva: <strong style="color:#1d4ed8;" id="calc-reinvest-valor-reserva">R$ 0,00</strong></p>
                    <p>Valor para D√≠vidas: <strong style="color:#9a3412;" id="calc-reinvest-valor-dividas">R$ 0,00</strong></p>
                </div>
            </div>
        </section>

        <!-- P√°gina: Calculadora de Precifica√ß√£o Manual -->
        <section id="calc-precificacao-manual-page" class="page-content calculator-page">
            <button class="btn btn-secondary btn-voltar-calculadoras" style="margin-bottom: 1.5rem;">
                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                Voltar para Calculadoras
            </button>
            <h2 class="page-title">Calculadora de Precifica√ß√£o Manual</h2>
            <div class="form-container">
                <div class="form-group">
                    <label for="calc-manual-custo-produto">Custo do Produto (Compra) (R$):</label>
                    <input type="number" id="calc-manual-custo-produto" step="0.01" min="0" placeholder="Ex: 25,00">
                </div>
                 <div class="form-group">
                    <label for="calc-manual-custos-variaveis">Custos Vari√°veis por Unidade (Embalagem, Taxas, etc.) (R$):</label>
                    <input type="number" id="calc-manual-custos-variaveis" step="0.01" min="0" placeholder="Ex: 3,50">
                </div>
                 <div class="form-group">
                    <label for="calc-manual-custos-fixos-rateio">Rateio de Custos Fixos por Unidade (R$):</label>
                    <input type="number" id="calc-manual-custos-fixos-rateio" step="0.01" min="0" placeholder="Ex: 2,00 (Custo Fixo Unit√°rio da p√°g. Despesas)">
                </div>
                 <div class="form-group">
                    <label for="calc-manual-margem-lucro">Margem de Lucro Desejada (%):</label>
                    <input type="number" id="calc-manual-margem-lucro" min="0" placeholder="Ex: 100">
                </div>
                 <div class="form-actions" style="justify-content: flex-start;">
                     <button class="btn btn-primary" id="btn-calcular-preco-manual">Calcular Pre√ßo</button>
                </div>
                 <div style="margin-top:1.5rem; padding-top:1rem; border-top: 1px solid #fbcfe8;">
                    <p style="font-size: 1.1rem;">Custo Total por Unidade: <strong id="calc-manual-custo-total-display">R$ 0,00</strong></p>
                    <p style="font-size: 1.1rem;">Pre√ßo de Venda Calculado: <strong class="destaque-preco" id="calc-manual-preco-venda-display">R$ 0,00</strong></p>
                    <p style="font-size: 1.1rem;">Lucro L√≠quido por Unidade: <strong class="destaque-lucro" id="calc-manual-lucro-liquido-display">R$ 0,00</strong></p>
                </div>
            </div>
        </section>


        <section id="metas-page" class="page-content">
            <h2 class="page-title">Defini√ß√£o de Metas</h2>
            <p>Aqui voc√™ poder√° definir suas metas financeiras, de vendas e de crescimento. Acompanhe seu progresso e ajuste suas estrat√©gias para alcan√ßar seus sonhos!</p>
             <div class="form-container">
                <p><em>Em breve: Formul√°rios para criar metas SMART, visualiza√ß√£o de progresso com barras e gr√°ficos, hist√≥rico de metas alcan√ßadas.</em></p>
            </div>
        </section>
        <section id="relatorios-page" class="page-content">
            <h2 class="page-title">Relat√≥rios Detalhados</h2>
            <p>Acesse relat√≥rios completos sobre suas vendas, lucratividade, despesas e desempenho geral. Informa√ß√£o clara para decis√µes inteligentes!</p>
            <div class="form-container">
                <p><em>Em breve: Filtros avan√ßados, gr√°ficos interativos de vendas por per√≠odo, produto mais vendido, despesas por categoria, DRE simplificada, etc.</em></p>
            </div>
        </section>
        <section id="c4-ia-page" class="page-content">
            <h2 class="page-title">C4 IA - Sua Assistente Virtual</h2>
            <p>Converse com a C4 IA para tirar d√∫vidas, receber sugest√µes personalizadas, alertas importantes e insights para otimizar seu neg√≥cio.</p>
            <div class="form-container">
                <p><em>Em breve: Interface de chat, exemplos de perguntas, hist√≥rico de conversas e integra√ß√£o com as funcionalidades do app para sugest√µes contextuais.</em></p>
            </div>
        </section>
        <section id="perfil-page" class="page-content"> 
            <h2 class="page-title">Meu Perfil e Configura√ß√µes</h2>
            <p>Gerencie seus dados pessoais, informa√ß√µes da sua empresa, prefer√™ncias de notifica√ß√£o e outras configura√ß√µes do C4 App.</p>
             <div class="form-container">
                <p><em>Em breve: Campos para nome, e-mail, dados da empresa (CNPJ, nome fantasia), configura√ß√µes de moeda, tema, notifica√ß√µes, etc.</em></p>
            </div>
        </section>
    </main>

    <footer class="app-footer">
        <p>&copy; <span id="current-year"></span> C4. Todos os direitos reservados.</p>
    </footer>

    <script defer>
        document.addEventListener('DOMContentLoaded', () => {
            const menuToggleBtn = document.getElementById('menu-toggle-btn');
            const closeSidebarBtn = document.getElementById('close-sidebar-btn');
            const sidebarNav = document.getElementById('sidebar-nav');
            const appOverlay = document.getElementById('app-overlay');
            const body = document.body;

            const sidebarNavItems = document.querySelectorAll('.sidebar-nav-item');
            const pageContents = document.querySelectorAll('.page-content');
            const currentYearSpan = document.getElementById('current-year');

            // --- Seletores Globais de Formul√°rios (para reset ao mudar de p√°gina) ---
            const formCadastroProdutoContainer = document.getElementById('form-cadastro-produto-container');
            const formCadastroProduto = document.getElementById('form-cadastro-produto');
            const produtoImagemPreview = document.getElementById('produto-imagem-preview');
            const productDetailsContainer = document.getElementById('product-details-container');
            const btnShowAddProductForm = document.getElementById('btn-show-add-product-form');
            
            const formNovaVendaContainer = document.getElementById('form-nova-venda-container');
            const formNovaVenda = document.getElementById('form-nova-venda');
            const vendaItensLista = document.getElementById('venda-itens-lista');
            const btnShowNovaVendaForm = document.getElementById('btn-show-nova-venda-form');
            let itensVenda = []; 

            // Seletores da P√°gina de Despesas (nova estrutura)
            const formAddCustoFixo = document.getElementById('form-add-custo-fixo');
            const listaCustosFixosEl = document.getElementById('lista-custos-fixos');
            const totalCustosFixosMensaisEl = document.getElementById('total-custos-fixos-mensais');
            const totalProdutosEstoqueSimuladoInput = document.getElementById('total-produtos-estoque-simulado');
            const custoFixoUnitarioDisplayEl = document.getElementById('custo-fixo-unitario-display');
            let custosFixos = [];

            const formAddCustoVariavel = document.getElementById('form-add-custo-variavel');
            const listaCustosVariaveisEl = document.getElementById('lista-custos-variaveis');
            const custoVariavelUnitarioTotalDisplayEl = document.getElementById('custo-variavel-unitario-total-display');
            let custosVariaveis = [];

            // Seletores da P√°gina Liberdade Financeira
            const btnShowAddDividaForm = document.getElementById('btn-show-add-divida-form');
            const formAddDividaContainer = document.getElementById('form-add-divida-container');
            const formAddDivida = document.getElementById('form-add-divida');
            const dividaEParceladaCheckbox = document.getElementById('divida-e-parcelada');
            const dividaParcelasDetalhesDiv = document.getElementById('divida-parcelas-detalhes');
            const listaDividasContainerEl = document.getElementById('lista-dividas-container');
            let dividasCadastradas = []; 
            const planejamentoQuitacaoDividaPage = document.getElementById('planejamento-quitacao-divida-page');
            const btnVoltarParaDividas = document.getElementById('btn-voltar-para-dividas');
            let dividaAtualParaPlanejamento = null; 

            const btnCriarMetaQuitacaoReal = document.getElementById('btn-criar-meta-quitacao-real');

            // Seletores da P√°gina Lucro Certo
            const lucroProdutoSelect = document.getElementById('lucro-produto-select');
            const lucroCertoContentEl = document.getElementById('lucro-certo-content');
            const lucroNomeProdutoDisplayEl = document.getElementById('lucro-nome-produto-display');
            const lucroCustoTotalDisplayEl = document.getElementById('lucro-custo-total-display');
            const lucroMargemDesejadaInput = document.getElementById('lucro-margem-desejada');
            const lucroPrecoVendaSugeridoEl = document.getElementById('lucro-preco-venda-sugerido');
            const lucroLiquidoUnidadeEl = document.getElementById('lucro-liquido-unidade');
            const lucroProdutoChartCanvas = document.getElementById('lucro-produto-chart');
            let lucroProdutoChartInstance = null;
            const alertaMargemBaixaEl = document.getElementById('alerta-margem-baixa');
            const lucroQtdVenderMesInput = document.getElementById('lucro-qtd-vender-mes');
            const lucroMensalProjetadoEl = document.getElementById('lucro-mensal-projetado');
            const lucroDesejadoMensalInput = document.getElementById('lucro-desejado-mensal');
            const lucroMetaVendasUnidadesEl = document.getElementById('lucro-meta-vendas-unidades');
            const lucroCertoSelecioneProdutoMsg = document.getElementById('lucro-certo-selecione-produto-msg');

            // Seletores das Calculadoras Individuais
            const calcLucroIdealPage = document.getElementById('calc-lucro-ideal-page');
            const calcFreteUnitarioPage = document.getElementById('calc-frete-unitario-page');
            const calcMetaVendasPage = document.getElementById('calc-meta-vendas-page');
            const calcReinvestimentoPage = document.getElementById('calc-reinvestimento-page');
            const calcPrecificacaoManualPage = document.getElementById('calc-precificacao-manual-page');

             // Seletores para os dropdowns das calculadoras
            const calcLucroIdealProdutoSelect = document.getElementById('calc-lucro-ideal-produto-select');
            const calcMetaVendasProdutoSelect = document.getElementById('calc-meta-produto-chave');


            let produtosCadastrados = [ 
                { id: 'prod1', nome: 'Bolsa Elegance Rosa', categoria: 'Bolsas', valorCustoCompra: 45.00, estoque: 15, imagem: 'https://placehold.co/300x180/f8b81f/db1472?text=Bolsa+C4' },
                { id: 'prod2', nome: 'Carteira Glamour Dourada', categoria: 'Carteiras', valorCustoCompra: 25.50, estoque: 22, imagem: 'https://placehold.co/300x180/db1472/f8b81f?text=Carteira+C4' },
                { id: 'prod3', nome: 'Cinto Fivela Dourada', categoria: 'Acessorios', valorCustoCompra: 15.00, estoque: 10, imagem: 'https://placehold.co/300x180/f8b81f/db1472?text=Cinto+C4' }
            ];


            if (currentYearSpan) {
                currentYearSpan.textContent = new Date().getFullYear();
            }

            function openSidebar() {
                sidebarNav.classList.add('open');
                appOverlay.classList.add('active');
                body.classList.add('sidebar-open');
            }

            function closeSidebar() {
                sidebarNav.classList.remove('open');
                appOverlay.classList.remove('active');
                body.classList.remove('sidebar-open');
            }

            if (menuToggleBtn) menuToggleBtn.addEventListener('click', openSidebar);
            if (closeSidebarBtn) closeSidebarBtn.addEventListener('click', closeSidebar);
            if (appOverlay) appOverlay.addEventListener('click', closeSidebar); 
            
            function setActivePage(pageId, data) { 
                pageContents.forEach(page => page.classList.remove('active'));
                sidebarNavItems.forEach(nav => nav.classList.remove('active'));

                const targetPage = document.getElementById(pageId);
                const targetNavItem = document.querySelector(`.sidebar-nav-item[data-page="${pageId}"]`);

                if (targetPage) {
                    targetPage.classList.add('active');
                    if (pageId === 'planejamento-quitacao-divida-page' && data) {
                        preencherPaginaPlanejamentoQuitacao(data);
                    } else if (pageId === 'lucro-certo-page') {
                        if(typeof popularProdutosSelectLucroCerto === "function") popularProdutosSelectLucroCerto();
                        if(lucroCertoContentEl) lucroCertoContentEl.style.display = 'none';
                        if(lucroCertoSelecioneProdutoMsg) lucroCertoSelecioneProdutoMsg.style.display = 'block';
                    } else if (pageId.startsWith('calc-')) { 
                        if(pageId === 'calc-lucro-ideal-page' && typeof popularProdutosSelectCalcLucroIdeal === "function") popularProdutosSelectCalcLucroIdeal();
                        if(pageId === 'calc-meta-vendas-page' && typeof popularProdutosSelectCalcMetaVendas === "function") popularProdutosSelectCalcMetaVendas();
                    }


                } else {
                    console.warn(`P√°gina com id '${pageId}' n√£o encontrada. Redirecionando para Dashboard.`);
                    const dashboardPage = document.getElementById('dashboard-page');
                    const dashboardNavItem = document.querySelector(`.sidebar-nav-item[data-page="dashboard-page"]`);
                    if (dashboardPage) dashboardPage.classList.add('active');
                    if (dashboardNavItem) dashboardNavItem.classList.add('active');
                }
                if (targetNavItem) targetNavItem.classList.add('active');
                
                if (pageId !== 'produtos-page') {
                    if (formCadastroProdutoContainer) formCadastroProdutoContainer.style.display = 'none';
                    if (formCadastroProduto) formCadastroProduto.reset();
                    if (produtoImagemPreview) produtoImagemPreview.style.display = 'none';
                    if (btnShowAddProductForm) btnShowAddProductForm.style.display = 'inline-flex';
                    if (productDetailsContainer) productDetailsContainer.style.display = 'none';
                } else {
                    if(typeof exibirProdutosEmCards === 'function') exibirProdutosEmCards(); 
                }

                if (pageId !== 'vendas-page') {
                    if (formNovaVendaContainer) formNovaVendaContainer.style.display = 'none';
                    if (formNovaVenda) formNovaVenda.reset();
                    if (vendaItensLista) vendaItensLista.innerHTML = '<p id="venda-sem-itens" style="text-align: center; color: #6b7280; padding: 1rem 0;">Nenhum item adicionado √† venda.</p>';
                    itensVenda = [];
                    if (typeof atualizarResumoVenda === "function") atualizarResumoVenda();
                    if (btnShowNovaVendaForm) btnShowNovaVendaForm.style.display = 'inline-flex';
                } else {
                     if(typeof exibirVendasEmCards === 'function') exibirVendasEmCards(); 
                     if(typeof popularProdutosSelectVenda === 'function') popularProdutosSelectVenda();
                }

                if (pageId !== 'despesas-page') { 
                    if(formAddCustoFixo) formAddCustoFixo.reset();
                    if(formAddCustoVariavel) formAddCustoVariavel.reset();
                     // Limpar listas visuais
                    if(listaCustosFixosEl) listaCustosFixosEl.innerHTML = '<p id="sem-custos-fixos" style="text-align:center; padding:1rem; color:#6b7280;">Nenhum custo fixo adicionado.</p>';
                    if(listaCustosVariaveisEl) listaCustosVariaveisEl.innerHTML = '<p id="sem-custos-variaveis" style="text-align:center; padding:1rem; color:#6b7280;">Nenhum custo vari√°vel adicionado.</p>';
                    if(totalCustosFixosMensaisEl) totalCustosFixosMensaisEl.textContent = 'R$ 0,00';
                    if(custoFixoUnitarioDisplayEl) custoFixoUnitarioDisplayEl.textContent = 'R$ 0,00';
                    if(custoVariavelUnitarioTotalDisplayEl) custoVariavelUnitarioTotalDisplayEl.textContent = 'R$ 0,00';

                } else { 
                     if(typeof exibirCustosFixos === "function") exibirCustosFixos();
                     if(typeof exibirCustosVariaveis === "function") exibirCustosVariaveis();
                }
                 if (pageId !== 'liberdade-financeira-page' && pageId !== 'planejamento-quitacao-divida-page') {
                    if(formAddDividaContainer) formAddDividaContainer.style.display = 'none';
                    if(formAddDivida) formAddDivida.reset();
                    if(dividaParcelasDetalhesDiv) dividaParcelasDetalhesDiv.style.display = 'none';
                    if(btnShowAddDividaForm) btnShowAddDividaForm.style.display = 'inline-flex';
                }
                 if (pageId === 'liberdade-financeira-page') { 
                    if(planejamentoQuitacaoDividaPage) planejamentoQuitacaoDividaPage.classList.remove('active'); 
                    if(typeof exibirDividas === "function") exibirDividas();
                }
                if (pageId !== 'calculadoras-page' && !pageId.startsWith('calc-')) { 
                    if(typeof resetFormsCalculadoras === "function") resetFormsCalculadoras();
                } else if (pageId === 'calculadoras-page'){ 
                     if(typeof resetFormsCalculadoras === "function") resetFormsCalculadoras();
                }
            }

            sidebarNavItems.forEach(item => {
                item.addEventListener('click', () => {
                    setActivePage(item.dataset.page);
                    closeSidebar(); 
                });
            });
            
            const quickActionButtons = document.querySelectorAll('.btn-action[data-target-page]'); 
            quickActionButtons.forEach(button => {
                button.addEventListener('click', () => setActivePage(button.dataset.targetPage));
            });
            
            // --- L√≥gica da P√°gina de Produtos ---
            const btnCancelAddProduct = document.getElementById('btn-cancel-add-product');
            const produtoImagemInput = document.getElementById('produto-imagem');
            const btnCloseProductDetails = document.getElementById('btn-close-product-details');
            const produtoValorCustoInput = document.getElementById('produto-valor-custo');
            const displayCustoFixo = document.getElementById('display-custo-fixo');
            const displayCustoVariavel = document.getElementById('display-custo-variavel');
            const displayCustoFrete = document.getElementById('display-custo-frete');
            const displayCustoTotalUnidade = document.getElementById('display-custo-total-unidade');
            const productCardsListEl = document.getElementById('product-cards-list');
            const noProductsMessageEl = document.getElementById('no-products-message');


            function exibirProdutosEmCards() {
                if (!productCardsListEl) return;
                productCardsListEl.innerHTML = '';
                if (produtosCadastrados.length === 0) {
                    if (noProductsMessageEl) noProductsMessageEl.style.display = 'block';
                    return;
                }
                if (noProductsMessageEl) noProductsMessageEl.style.display = 'none';

                produtosCadastrados.forEach(produto => {
                    const custoFixoUnitarioAtual = parseFloat(custoFixoUnitarioDisplayEl?.textContent.replace('R$ ', '').replace(',', '.')) || 0;
                    const custoVariavelUnitarioAtual = parseFloat(custoVariavelUnitarioTotalDisplayEl?.textContent.replace('R$ ', '').replace(',', '.')) || 0;
                    const custoFreteSimuladoProduto = 0.80; 
                    
                    const custoTotalUnitario = (produto.valorCustoCompra || 0) + 
                                            custoFixoUnitarioAtual +
                                            custoVariavelUnitarioAtual +
                                            custoFreteSimuladoProduto;


                    const cardDiv = document.createElement('div');
                    cardDiv.classList.add('product-card');
                    cardDiv.innerHTML = `
                        <img src="${produto.imagem || 'https://placehold.co/300x180/f8b81f/db1472?text=C4'}" alt="${produto.nome}" class="product-card-image">
                        <h4>${produto.nome}</h4>
                        <p><strong>Categoria:</strong> ${produto.categoria || 'N/A'}</p>
                        <p><strong>Custo (Compra):</strong> R$ ${parseFloat(produto.valorCustoCompra || 0).toFixed(2)}</p>
                        <p><strong>Estoque:</strong> ${produto.estoque || 0} unidades</p>
                        <p><strong>Custo Total Unit.:</strong> R$ ${custoTotalUnitario.toFixed(2)}</p>
                        <div class="actions-cell">
                            <button class="btn btn-sm btn-secondary" title="Editar" data-product-id="${produto.id}"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg></button>
                            <button class="btn btn-sm btn-primary" title="Ver Detalhes" data-product-id="${produto.id}"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg></button>
                        </div>
                    `;
                    productCardsListEl.appendChild(cardDiv);
                });
            }


            function simularCalculoCustoTotal() {
                if (!produtoValorCustoInput && !displayCustoTotalUnidade) return; 
                const valorCustoCompra = parseFloat(produtoValorCustoInput?.value) || 0;
                const custoFixoSimulado = parseFloat(custoFixoUnitarioDisplayEl?.textContent.replace('R$ ', '').replace(',', '.')) || 0; 
                const custoVariavelSimulado = parseFloat(custoVariavelUnitarioTotalDisplayEl?.textContent.replace('R$ ', '').replace(',', '.')) || 0; 
                const custoFreteSimulado = 0.80; 
                
                if(displayCustoFixo) displayCustoFixo.textContent = `R$ ${custoFixoSimulado.toFixed(2)}`; 
                if(displayCustoVariavel) displayCustoVariavel.textContent = `R$ ${custoVariavelSimulado.toFixed(2)}`; 
                if(displayCustoFrete) displayCustoFrete.textContent = `R$ ${custoFreteSimulado.toFixed(2)}`;
                
                const custoTotal = valorCustoCompra + custoFixoSimulado + custoVariavelSimulado + custoFreteSimulado;
                if(displayCustoTotalUnidade) displayCustoTotalUnidade.textContent = `R$ ${custoTotal.toFixed(2)}`;
            }
            if(produtoValorCustoInput) produtoValorCustoInput.addEventListener('input', simularCalculoCustoTotal);
            if (btnShowAddProductForm && formCadastroProdutoContainer) {
                btnShowAddProductForm.addEventListener('click', () => {
                    formCadastroProdutoContainer.style.display = 'block';
                    btnShowAddProductForm.style.display = 'none'; 
                    if(productDetailsContainer) productDetailsContainer.style.display = 'none'; 
                    if(formCadastroProduto) formCadastroProduto.reset(); 
                    if(produtoImagemPreview) produtoImagemPreview.style.display = 'none';
                    simularCalculoCustoTotal(); 
                });
            }
            if (btnCancelAddProduct && formCadastroProdutoContainer && btnShowAddProductForm) {
                btnCancelAddProduct.addEventListener('click', () => {
                    formCadastroProdutoContainer.style.display = 'none';
                    if(formCadastroProduto) formCadastroProduto.reset(); 
                    if(produtoImagemPreview) produtoImagemPreview.style.display = 'none'; 
                    btnShowAddProductForm.style.display = 'inline-flex'; 
                });
            }
            if (formCadastroProduto) {
                formCadastroProduto.addEventListener('submit', event => {
                    event.preventDefault();
                    const nomeProdutoEl = document.getElementById('produto-nome');
                    const novoProduto = {
                        id: `prod${Date.now()}`,
                        nome: nomeProdutoEl ? nomeProdutoEl.value : 'Novo Produto',
                        categoria: document.getElementById('produto-categoria').value,
                        valorCustoCompra: parseFloat(document.getElementById('produto-valor-custo').value) || 0,
                        estoque: parseInt(document.getElementById('produto-estoque').value) || 0,
                        imagem: produtoImagemPreview.src === '#' ? 'https://placehold.co/300x180/f8b81f/db1472?text=C4' : produtoImagemPreview.src
                    };
                    produtosCadastrados.push(novoProduto);
                    exibirProdutosEmCards(); 
                    if(typeof popularProdutosSelectLucroCerto === "function") popularProdutosSelectLucroCerto(); 
                    if(typeof popularProdutosSelectVenda === "function") popularProdutosSelectVenda(); 
                    if(typeof popularProdutosSelectCalcLucroIdeal === "function") popularProdutosSelectCalcLucroIdeal();
                    if(typeof popularProdutosSelectCalcMetaVendas === "function") popularProdutosSelectCalcMetaVendas();
                    alert(`Produto "${novoProduto.nome}" salvo! (Simula√ß√£o)`); 
                    formCadastroProduto.reset();
                    if(produtoImagemPreview) produtoImagemPreview.style.display = 'none';
                    formCadastroProdutoContainer.style.display = 'none';
                    if(btnShowAddProductForm) btnShowAddProductForm.style.display = 'inline-flex';
                });
            }
            if (produtoImagemInput && produtoImagemPreview) {
                produtoImagemInput.addEventListener('change', function() {
                    if (this.files && this.files[0]) {
                        const reader = new FileReader();
                        reader.onload = e => {
                            produtoImagemPreview.src = e.target.result;
                            produtoImagemPreview.style.display = 'block';
                        }
                        reader.readAsDataURL(this.files[0]);
                    } else {
                        produtoImagemPreview.style.display = 'none';
                        produtoImagemPreview.src = '#';
                    }
                });
            }
            if(productCardsListEl){ 
                productCardsListEl.addEventListener('click', (event) => {
                    const targetButton = event.target.closest('button');
                    if (targetButton && targetButton.title === "Ver Detalhes") {
                         if (productDetailsContainer) {
                            const card = targetButton.closest('.product-card');
                            const productName = card.querySelector('h4').textContent;
                            const categoryP = Array.from(card.querySelectorAll('p')).find(p => p.textContent.includes('Categoria:'));
                            const productCategory = categoryP ? categoryP.textContent.replace('Categoria:', '').trim() : 'N/A';
                            const costP = Array.from(card.querySelectorAll('p')).find(p => p.textContent.includes('Custo (Compra):'));
                            const productCost = costP ? costP.textContent.replace('Custo (Compra):', '').trim() : 'N/A';
                            const stockP = Array.from(card.querySelectorAll('p')).find(p => p.textContent.includes('Estoque:'));
                            const productStock = stockP ? stockP.textContent.replace('Estoque:', '').trim() : 'N/A';
                            const totalCostP = Array.from(card.querySelectorAll('p')).find(p => p.textContent.includes('Custo Total Unit.:'));
                            const productTotalCost = totalCostP ? totalCostP.textContent.replace('Custo Total Unit.:', '').trim() : 'N/A';
                            const productImageSrc = card.querySelector('.product-card-image')?.src || 'https://placehold.co/120x120/f8b81f/db1472?text=C4';
                            
                            const productDetailsContentEl = document.getElementById('product-details-content');
                            if(productDetailsContentEl) {
                                productDetailsContentEl.innerHTML = `
                                    <div style="display:flex; gap: 1.5rem; flex-wrap:wrap;">
                                        <img src="${productImageSrc}" alt="${productName}" style="width:120px; height:120px; border-radius:8px; object-fit:cover;">
                                        <div>
                                            <p><strong>Nome:</strong> ${productName}</p>
                                            <p><strong>Categoria:</strong> ${productCategory}</p>
                                            <p><strong>Valor de Custo (Compra):</strong> ${productCost}</p>
                                            <p><strong>Estoque:</strong> ${productStock}</p>
                                            <p><strong>Custo Total Unit√°rio:</strong> ${productTotalCost}</p>
                                        </div>
                                    </div>
                                    <hr style="margin: 1rem 0;">
                                    <p><em>Se√ß√£o de Hist√≥rico e outras informa√ß√µes do produto apareceriam aqui.</em></p>
                                `;
                            }
                            productDetailsContainer.style.display = 'block';
                            if (formCadastroProdutoContainer) formCadastroProdutoContainer.style.display = 'none';
                            if (btnShowAddProductForm) btnShowAddProductForm.style.display = 'inline-flex';
                        }
                    }
                });
            }

            if(btnCloseProductDetails && productDetailsContainer) {
                btnCloseProductDetails.addEventListener('click', () => productDetailsContainer.style.display = 'none');
            }
            
            // --- L√≥gica da P√°gina de Vendas ---
            const btnCancelNovaVenda = document.getElementById('btn-cancel-nova-venda');
            const vendaProdutoSelect = document.getElementById('venda-produto-select');
            const vendaProdutoQtdInput = document.getElementById('venda-produto-qtd');
            const btnAddProdutoVenda = document.getElementById('btn-add-produto-venda');
            const vendaDescontoInput = document.getElementById('venda-desconto');
            const vendaSubtotalEl = document.getElementById('venda-subtotal');
            const vendaDescontoPercEl = document.getElementById('venda-desconto-perc');
            const vendaValorDescontoEl = document.getElementById('venda-valor-desconto');
            const vendaTotalPagarEl = document.getElementById('venda-total-pagar');
            const salesHistoryCardsListEl = document.getElementById('sales-history-cards-list');
            const noVendasMessageEl = document.getElementById('no-vendas-message');
            let vendasRegistradas = [ 
                { id: 'VEN-001', data: '2025-06-04', cliente: 'Maria Silva', itensVendidos: [{nome:'Bolsa Elegance Rosa', qtd: 2, preco: 109.45}], total: 218.90, status: 'pago' },
                { id: 'VEN-002', data: '2025-06-03', cliente: 'Joana Santos', itensVendidos: [{nome:'Cinto Fivela Dourada', qtd: 1, preco: 49.50}], total: 49.50, status: 'pendente' }
            ];


            function popularProdutosSelectVenda() {
                if (!vendaProdutoSelect) return;
                vendaProdutoSelect.innerHTML = '<option value="">Selecione um produto</option>'; 
                produtosCadastrados.forEach(produto => {
                    const option = document.createElement('option');
                    option.value = produto.id;
                    
                    const custoFixoUnitario = parseFloat(custoFixoUnitarioDisplayEl?.textContent.replace('R$ ', '').replace(',', '.')) || 0;
                    const custoVariavelUnitario = parseFloat(custoVariavelUnitarioTotalDisplayEl?.textContent.replace('R$ ', '').replace(',', '.')) || 0;
                    const custoFrete = 0.80; 
                    const custoTotalProduto = produto.valorCustoCompra + custoFixoUnitario + custoVariavelUnitario + custoFrete;
                    const precoVendaSimulado = custoTotalProduto / (1 - 0.50); // Simula margem de 50%

                    option.textContent = `${produto.nome} (Est: ${produto.estoque}) - R$ ${precoVendaSimulado.toFixed(2)}`;
                    option.dataset.price = precoVendaSimulado.toFixed(2); 
                    option.dataset.stock = produto.estoque;
                    vendaProdutoSelect.appendChild(option);
                });
            }


            function exibirVendasEmCards() {
                if (!salesHistoryCardsListEl) return;
                salesHistoryCardsListEl.innerHTML = '';
                if (vendasRegistradas.length === 0) {
                    if (noVendasMessageEl) noVendasMessageEl.style.display = 'block';
                    return;
                }
                if (noVendasMessageEl) noVendasMessageEl.style.display = 'none';

                vendasRegistradas.forEach(venda => {
                    const cardDiv = document.createElement('div');
                    cardDiv.classList.add('sale-card');
                    cardDiv.innerHTML = `
                        <h4>Venda ID: ${venda.id}</h4>
                        <p><strong>Data:</strong> ${new Date(venda.data + 'T00:00:00').toLocaleDateString('pt-BR')}</p>
                        <p><strong>Cliente:</strong> ${venda.cliente || 'N√£o informado'}</p>
                        <p><strong>Itens:</strong> ${venda.itensVendidos.reduce((sum, item) => sum + item.qtd, 0)}</p>
                        <p><strong>Total:</strong> R$ ${venda.total.toFixed(2)}</p>
                        <p><strong>Status:</strong> <span class="status-badge status-${venda.status}">${venda.status}</span></p>
                        <div class="actions-cell">
                            <button class="btn btn-sm btn-secondary" title="Ver Detalhes"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg></button>
                        </div>
                    `;
                    salesHistoryCardsListEl.appendChild(cardDiv);
                });
            }


            function exibirItensVenda() { 
                if(!vendaItensLista) return;
                vendaItensLista.innerHTML = ''; 
                if (itensVenda.length === 0) {
                    vendaItensLista.innerHTML = '<p id="venda-sem-itens" style="text-align: center; color: #6b7280; padding: 1rem 0;">Nenhum item adicionado √† venda.</p>';
                } else {
                    itensVenda.forEach((item, index) => {
                        const li = document.createElement('li');
                        li.innerHTML = `
                            <div class="sale-item-details">
                                <strong>${item.nome}</strong> (${item.qtd} x R$ ${item.preco.toFixed(2)})
                            </div>
                            <span>R$ ${item.subtotal.toFixed(2)}</span>
                            <button type="button" class="sale-item-remove" data-index="${index}" title="Remover item">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                            </button>
                        `;
                        vendaItensLista.appendChild(li);
                    });
                }
                atualizarResumoVenda();
            }
            function atualizarResumoVenda() { 
                if(!vendaDescontoInput || !vendaSubtotalEl || !vendaDescontoPercEl || !vendaValorDescontoEl || !vendaTotalPagarEl) return;
                let subtotal = 0;
                itensVenda.forEach(item => subtotal += item.subtotal);
                const descontoPerc = parseFloat(vendaDescontoInput.value) || 0;
                const valorDesconto = (subtotal * descontoPerc) / 100;
                const totalPagar = subtotal - valorDesconto;
                vendaSubtotalEl.textContent = `R$ ${subtotal.toFixed(2)}`;
                vendaDescontoPercEl.textContent = descontoPerc;
                vendaValorDescontoEl.textContent = `R$ ${valorDesconto.toFixed(2)}`;
                vendaTotalPagarEl.textContent = `R$ ${totalPagar.toFixed(2)}`;
            }
            if (btnShowNovaVendaForm && formNovaVendaContainer) {
                btnShowNovaVendaForm.addEventListener('click', () => {
                    formNovaVendaContainer.style.display = 'block';
                    btnShowNovaVendaForm.style.display = 'none';
                    if(formNovaVenda) formNovaVenda.reset(); 
                    itensVenda = []; 
                    exibirItensVenda(); 
                    atualizarResumoVenda(); 
                    popularProdutosSelectVenda(); 
                });
            }
            if (btnCancelNovaVenda && formNovaVendaContainer && btnShowNovaVendaForm) {
                btnCancelNovaVenda.addEventListener('click', () => {
                    formNovaVendaContainer.style.display = 'none';
                    if(formNovaVenda) formNovaVenda.reset();
                    itensVenda = [];
                    exibirItensVenda();
                    btnShowNovaVendaForm.style.display = 'inline-flex';
                });
            }
            if (btnAddProdutoVenda && vendaProdutoSelect && vendaProdutoQtdInput) {
                btnAddProdutoVenda.addEventListener('click', () => { 
                    const selectedOption = vendaProdutoSelect.options[vendaProdutoSelect.selectedIndex];
                    const produtoId = selectedOption.value;
                    if (!produtoId) { alert('Selecione um produto.'); return; }
                    const produtoNome = selectedOption.text.split(' (Est:')[0]; 
                    const produtoPreco = parseFloat(selectedOption.dataset.price);
                    const quantidade = parseInt(vendaProdutoQtdInput.value);
                    if (isNaN(quantidade) || quantidade <= 0) { alert('Insira uma quantidade v√°lida.'); return; }
                    
                    const itemExistente = itensVenda.find(item => item.id === produtoId);
                    if (itemExistente) {
                        itemExistente.qtd += quantidade;
                        itemExistente.subtotal = itemExistente.qtd * itemExistente.preco;
                    } else {
                        itensVenda.push({ id: produtoId, nome: produtoNome, qtd: quantidade, preco: produtoPreco, subtotal: quantidade * produtoPreco });
                    }
                    exibirItensVenda();
                    vendaProdutoQtdInput.value = 1; 
                    vendaProdutoSelect.value = ""; 
                });
            }
            if(vendaItensLista) {
                vendaItensLista.addEventListener('click', event => { 
                    if (event.target.closest('.sale-item-remove')) {
                        const itemIndex = parseInt(event.target.closest('.sale-item-remove').dataset.index);
                        itensVenda.splice(itemIndex, 1); 
                        exibirItensVenda(); 
                    }
                });
            }
            if (vendaDescontoInput) vendaDescontoInput.addEventListener('input', atualizarResumoVenda);
            if (formNovaVenda) {
                formNovaVenda.addEventListener('submit', event => { 
                    event.preventDefault();
                    if (itensVenda.length === 0) { alert('Adicione produtos √† venda.'); return; }
                    const clienteEl = document.getElementById('venda-cliente');
                    alert(`Venda para ${clienteEl ? clienteEl.value || 'N√£o informado' : 'N√£o informado'} finalizada! Total: ${vendaTotalPagarEl ? vendaTotalPagarEl.textContent : 'R$0,00'}. (Simula√ß√£o)`);
                    formNovaVenda.reset();
                    itensVenda = [];
                    exibirItensVenda();
                    if(formNovaVendaContainer) formNovaVendaContainer.style.display = 'none';
                    if(btnShowNovaVendaForm) btnShowNovaVendaForm.style.display = 'inline-flex';
                });
            }

            // --- L√≥gica Espec√≠fica da P√°gina de Despesas (Nova Estrutura) ---
            function calcularCustosFixos() {
                if(!totalCustosFixosMensaisEl || !totalProdutosEstoqueSimuladoInput || !custoFixoUnitarioDisplayEl) return;
                let totalFixos = 0;
                custosFixos.forEach(custo => totalFixos += custo.valor);
                totalCustosFixosMensaisEl.textContent = `R$ ${totalFixos.toFixed(2)}`;

                const totalProdutosEstoque = parseInt(totalProdutosEstoqueSimuladoInput.value) || 1; 
                const custoUnitarioFixo = totalProdutosEstoque > 0 ? totalFixos / totalProdutosEstoque : 0;
                custoFixoUnitarioDisplayEl.textContent = `R$ ${custoUnitarioFixo.toFixed(2)}`;
                if(typeof simularCalculoCustoTotal === "function") simularCalculoCustoTotal(); 
            }

            function exibirCustosFixos() {
                if (!listaCustosFixosEl) return;
                listaCustosFixosEl.innerHTML = '';
                const semCustosFixosMsg = document.getElementById('sem-custos-fixos');

                if (custosFixos.length === 0) {
                    if(semCustosFixosMsg) semCustosFixosMsg.style.display = 'block';
                } else {
                    if(semCustosFixosMsg) semCustosFixosMsg.style.display = 'none';
                    custosFixos.forEach((custo, index) => {
                        const li = document.createElement('li');
                        li.innerHTML = `
                            <div class="cost-details">
                                <span class="cost-name">${custo.nome}</span> - 
                                <span class="cost-value">R$ ${custo.valor.toFixed(2)}</span>
                                ${custo.vencimento ? `<span class="cost-date">(Vence: ${new Date(custo.vencimento + 'T00:00:00').toLocaleDateString('pt-BR')})</span>` : ''}
                            </div>
                            <button type="button" class="remove-cost-btn" data-index="${index}" data-type="fixo" title="Remover Custo Fixo">&times;</button>
                        `;
                        listaCustosFixosEl.appendChild(li);
                    });
                }
                calcularCustosFixos();
            }

            if (formAddCustoFixo) {
                formAddCustoFixo.addEventListener('submit', (event) => {
                    event.preventDefault();
                    const nomeInput = document.getElementById('custo-fixo-nome');
                    const valorInput = document.getElementById('custo-fixo-valor');
                    const vencimentoInput = document.getElementById('custo-fixo-vencimento');

                    const nome = nomeInput.value.trim();
                    const valor = parseFloat(valorInput.value);
                    const vencimento = vencimentoInput.value;

                    if (nome && !isNaN(valor) && valor > 0) {
                        custosFixos.push({ nome, valor, vencimento });
                        exibirCustosFixos();
                        formAddCustoFixo.reset();
                    } else {
                        alert('Por favor, preencha o nome e um valor v√°lido para o custo fixo.');
                    }
                });
            }
            
            if(totalProdutosEstoqueSimuladoInput) {
                totalProdutosEstoqueSimuladoInput.addEventListener('input', calcularCustosFixos);
            }


            function calcularCustosVariaveis() {
                 if(!custoVariavelUnitarioTotalDisplayEl) return;
                let totalVariaveisUnitario = 0;
                custosVariaveis.forEach(custo => totalVariaveisUnitario += custo.valorUnitario);
                custoVariavelUnitarioTotalDisplayEl.textContent = `R$ ${totalVariaveisUnitario.toFixed(2)}`;
                if(typeof simularCalculoCustoTotal === "function") simularCalculoCustoTotal(); 
            }

            function exibirCustosVariaveis() {
                if (!listaCustosVariaveisEl) return;
                listaCustosVariaveisEl.innerHTML = '';
                 const semCustosVariaveisMsg = document.getElementById('sem-custos-variaveis');

                if (custosVariaveis.length === 0) {
                    if(semCustosVariaveisMsg) semCustosVariaveisMsg.style.display = 'block';
                } else {
                    if(semCustosVariaveisMsg) semCustosVariaveisMsg.style.display = 'none';
                    custosVariaveis.forEach((custo, index) => {
                        const li = document.createElement('li');
                        li.innerHTML = `
                            <div class="cost-details">
                                <span class="cost-name">${custo.nome}</span> - 
                                <span class="cost-value">R$ ${custo.valorUnitario.toFixed(2)}</span>
                            </div>
                            <button type="button" class="remove-cost-btn" data-index="${index}" data-type="variavel" title="Remover Custo Vari√°vel">&times;</button>
                        `;
                        listaCustosVariaveisEl.appendChild(li);
                    });
                }
                calcularCustosVariaveis();
            }

            if (formAddCustoVariavel) {
                formAddCustoVariavel.addEventListener('submit', (event) => {
                    event.preventDefault();
                    const nomeInput = document.getElementById('custo-variavel-nome');
                    const valorUnitarioInput = document.getElementById('custo-variavel-valor-unitario');
                    
                    const nome = nomeInput.value.trim();
                    const valorUnitario = parseFloat(valorUnitarioInput.value);

                    if (nome && !isNaN(valorUnitario) && valorUnitario > 0) {
                        custosVariaveis.push({ nome, valorUnitario });
                        exibirCustosVariaveis();
                        formAddCustoVariavel.reset();
                    } else {
                        alert('Por favor, preencha o nome e um valor unit√°rio v√°lido para o custo vari√°vel.');
                    }
                });
            }

            const despesasPageEl = document.getElementById('despesas-page');
            if(despesasPageEl){
                despesasPageEl.addEventListener('click', (event) => {
                    const target = event.target.closest('.remove-cost-btn');
                    if (target) {
                        const index = parseInt(target.dataset.index);
                        const type = target.dataset.type;
                        if (type === 'fixo' && index >= 0 && index < custosFixos.length) {
                            custosFixos.splice(index, 1);
                            exibirCustosFixos();
                        } else if (type === 'variavel' && index >= 0 && index < custosVariaveis.length) {
                            custosVariaveis.splice(index, 1);
                            exibirCustosVariaveis();
                        }
                    }
                });
            }

            // --- In√≠cio L√≥gica da P√°gina Liberdade Financeira ---
            if(btnShowAddDividaForm && formAddDividaContainer){
                btnShowAddDividaForm.addEventListener('click', () => {
                    formAddDividaContainer.style.display = 'block';
                    btnShowAddDividaForm.style.display = 'none';
                    if(formAddDivida) formAddDivida.reset();
                    if(dividaParcelasDetalhesDiv) dividaParcelasDetalhesDiv.style.display = 'none';
                    if(planejamentoQuitacaoDividaPage) planejamentoQuitacaoDividaPage.classList.remove('active'); 
                });
            }

            const btnCancelAddDivida = document.getElementById('btn-cancel-add-divida');
            if(btnCancelAddDivida && formAddDividaContainer && btnShowAddDividaForm){
                btnCancelAddDivida.addEventListener('click', () => {
                    formAddDividaContainer.style.display = 'none';
                    if(formAddDivida) formAddDivida.reset();
                    if(dividaParcelasDetalhesDiv) dividaParcelasDetalhesDiv.style.display = 'none';
                    btnShowAddDividaForm.style.display = 'inline-flex';
                });
            }

            if(dividaEParceladaCheckbox && dividaParcelasDetalhesDiv){
                dividaEParceladaCheckbox.addEventListener('change', function() {
                    dividaParcelasDetalhesDiv.style.display = this.checked ? 'block' : 'none';
                });
            }
            
            function exibirDividas() {
                if (!listaDividasContainerEl) return;
                listaDividasContainerEl.innerHTML = ''; 
                const semDividasMsg = document.getElementById('sem-dividas-message');

                let dividasParaExibir = [...dividasCadastradas]; 

                if (dividasParaExibir.length === 0) {
                     if(semDividasMsg) semDividasMsg.style.display = 'none'; 
                    dividasParaExibir = [ 
                        { id: 'exemplo1', nome: 'Cart√£o Loja X', valorTotal: 1200, tipo: 'cartao', eParcelada: true, numParcelas: 8, valorParcela: 150, dataVencimento: '2025-07-10', prioridade: 'alta', observacoes: 'Juros altos, focar nesta!', parcelasRestantes: 5 },
                        { id: 'exemplo2', nome: 'Empr√©stimo Banco Y', valorTotal: 5000, tipo: 'emprestimo', eParcelada: true, numParcelas: 24, valorParcela: 280, dataVencimento: '2025-07-20', prioridade: 'media', observacoes: '', parcelasRestantes: 10 }
                    ];
                } else {
                     if(semDividasMsg) semDividasMsg.style.display = 'none';
                }
                 if (dividasParaExibir.length === 0 && semDividasMsg){ 
                    semDividasMsg.style.display = 'block';
                    return;
                }


                dividasParaExibir.forEach((divida, index) => {
                    const divCard = document.createElement('div');
                    if (divida.prioridade === 'baixa') divCard.classList.add('prioridade-baixa-bg');
                    else if (divida.prioridade === 'media') divCard.classList.add('prioridade-media-bg');
                    else if (divida.prioridade === 'alta') divCard.classList.add('prioridade-alta-bg');
                    divCard.classList.add('divida-card'); 
                    
                    let statusDivida = divida.eParcelada ? 'Parcelada' : '√önica';
                    let valorExibido = `R$ ${parseFloat(divida.valorTotal).toFixed(2)}`;
                     if (divida.eParcelada && divida.parcelasRestantes && divida.valorParcela) { 
                         valorExibido = `R$ ${parseFloat(divida.valorParcela).toFixed(2)} (Restam ${divida.parcelasRestantes}/${divida.numParcelas})`;
                    } else if (divida.eParcelada && divida.valorParcela) {
                         valorExibido = `Parcela: R$ ${parseFloat(divida.valorParcela).toFixed(2)} (Total: R$ ${parseFloat(divida.valorTotal).toFixed(2)})`;
                    }


                    divCard.innerHTML = `
                        <h4>${divida.nome}</h4>
                        <p><strong>Valor:</strong> ${valorExibido}</p>
                        <p><strong>Status:</strong> ${statusDivida}</p>
                        <p><strong>Prioridade:</strong> <span style="text-transform:capitalize;">${divida.prioridade}</span></p>
                        <div class="divida-actions">
                            <button class="btn btn-sm btn-secondary btn-edit-divida" data-id="${divida.id}">Editar</button>
                            <button class="btn btn-sm btn-primary btn-planejar-quitacao" data-id="${divida.id}">Planejar Quita√ß√£o</button>
                        </div>
                    `;
                    listaDividasContainerEl.appendChild(divCard);
                });
            }


            if(formAddDivida){
                formAddDivida.addEventListener('submit', (event) => {
                    event.preventDefault();
                    const novaDivida = {
                        id: `divida-${Date.now()}`, 
                        nome: document.getElementById('divida-nome').value,
                        valorTotal: parseFloat(document.getElementById('divida-valor-total').value),
                        tipo: document.getElementById('divida-tipo').value,
                        eParcelada: dividaEParceladaCheckbox.checked,
                        numParcelas: dividaEParceladaCheckbox.checked ? parseInt(document.getElementById('divida-num-parcelas').value) : null,
                        valorParcela: dividaEParceladaCheckbox.checked ? parseFloat(document.getElementById('divida-valor-parcela').value) : null,
                        dataVencimento: document.getElementById('divida-data-vencimento').value,
                        prioridade: document.getElementById('divida-prioridade').value,
                        observacoes: document.getElementById('divida-observacoes').value,
                        parcelasRestantes: dividaEParceladaCheckbox.checked ? parseInt(document.getElementById('divida-num-parcelas').value) : 1 // Simula√ß√£o
                    };
                    dividasCadastradas.push(novaDivida);
                    exibirDividas(); 
                    alert(`D√≠vida "${novaDivida.nome}" salva com sucesso!`);
                    formAddDivida.reset();
                    if(dividaParcelasDetalhesDiv) dividaParcelasDetalhesDiv.style.display = 'none';
                    if(formAddDividaContainer) formAddDividaContainer.style.display = 'none';
                    if(btnShowAddDividaForm) btnShowAddDividaForm.style.display = 'inline-flex';
                });
            }
            
            if(listaDividasContainerEl) {
                listaDividasContainerEl.addEventListener('click', (event) => {
                    if (event.target.classList.contains('btn-planejar-quitacao')) {
                        const dividaId = event.target.dataset.id;
                        let dividaSelecionada = dividasCadastradas.find(d => d.id === dividaId);
                        
                        if(!dividaSelecionada) { 
                             if(dividaId === 'exemplo1') {
                                dividaSelecionada = { id: 'exemplo1', nome: 'Cart√£o Loja X', valorTotal: 1200, eParcelada: true, numParcelas: 8, valorParcela: 150, parcelasRestantes: 5 };
                            } else if (dividaId === 'exemplo2') {
                                dividaSelecionada = { id: 'exemplo2', nome: 'Empr√©stimo Banco Y', valorTotal: 5000, eParcelada: true, numParcelas: 24, valorParcela: 280, parcelasRestantes: 10 };
                            }
                        }
                        
                        if (dividaSelecionada) {
                            dividaAtualParaPlanejamento = dividaSelecionada; 
                            setActivePage('planejamento-quitacao-divida-page', dividaSelecionada);
                        }
                    }
                });
            }
            
            function preencherPaginaPlanejamentoQuitacao(divida) {
                if (!planejamentoQuitacaoDividaPage) return;
                document.getElementById('titulo-planejamento-divida').querySelector('span').textContent = divida.nome;
                document.getElementById('planejamento-nome-divida-display').textContent = divida.nome;
                document.getElementById('planejamento-valor-total-display').textContent = `R$ ${parseFloat(divida.valorTotal).toFixed(2)}`;
                
                document.getElementById('meta-nome-divida-display').textContent = divida.nome;
                document.getElementById('meta-total-divida-display').textContent = `R$ ${parseFloat(divida.valorTotal).toFixed(2)}`;

                document.getElementById('planejamento-poupanca').value = 50;
                document.getElementById('planejamento-periodo').value = 'quinzena';
                document.getElementById('planejamento-valor-ja-pago').value = 0;
                document.getElementById('resultado-calculo-quitacao').textContent = '';
                
                const progressBar = document.getElementById('quitacao-progress-bar');
                progressBar.style.width = '0%';
                progressBar.textContent = '0%';
                document.getElementById('meta-valor-pago-display').textContent = `R$ 0,00`;
                document.getElementById('meta-falta-quitar-display').textContent = `R$ ${parseFloat(divida.valorTotal).toFixed(2)}`;

                const sugestoesVendasUl = document.getElementById('lista-sugestoes-vendas-quitacao');
                if (sugestoesVendasUl) {
                    sugestoesVendasUl.innerHTML = `<li>Vender ${Math.ceil(divida.valorTotal / 25)} unidades do Produto "Exemplo" (Lucro Estimado: R$ 25,00)</li>`; 
                }
                const dicaEconomiaEl = document.getElementById('dica-economia-quitacao');
                if(dicaEconomiaEl) dicaEconomiaEl.textContent = "Avalie pequenas despesas di√°rias. Um caf√© a menos por dia pode somar uma boa economia no final do m√™s!";
            }

            const btnCalcularQuitacao = document.getElementById('btn-calcular-quitacao');
            if(btnCalcularQuitacao){
                btnCalcularQuitacao.addEventListener('click', () => {
                    if(!dividaAtualParaPlanejamento) return;

                    const valorPoupanca = parseFloat(document.getElementById('planejamento-poupanca').value) || 0;
                    const periodo = document.getElementById('planejamento-periodo').value;
                    const valorJaPago = parseFloat(document.getElementById('planejamento-valor-ja-pago').value) || 0;
                    const valorRestante = dividaAtualParaPlanejamento.valorTotal - valorJaPago;
                    const resultadoEl = document.getElementById('resultado-calculo-quitacao');
                    const progressBar = document.getElementById('quitacao-progress-bar');
                    
                    document.getElementById('meta-valor-pago-display').textContent = `R$ ${valorJaPago.toFixed(2)}`;
                    document.getElementById('meta-falta-quitar-display').textContent = `R$ ${valorRestante.toFixed(2)}`;

                    let progresso = 0;
                    if (dividaAtualParaPlanejamento.valorTotal > 0) {
                        progresso = (valorJaPago / dividaAtualParaPlanejamento.valorTotal) * 100;
                    }
                    progressBar.style.width = `${Math.min(progresso, 100)}%`;
                    progressBar.textContent = `${Math.min(progresso, 100).toFixed(0)}%`;


                    if (valorPoupanca <= 0) {
                        resultadoEl.textContent = "Por favor, insira um valor v√°lido para poupan√ßa.";
                        resultadoEl.style.color = "#ef4444"; 
                        return;
                    }
                    if (valorRestante <= 0) {
                        resultadoEl.textContent = "üéâ Parab√©ns! Esta d√≠vida j√° est√° quitada ou n√£o h√° valor restante!";
                        resultadoEl.style.color = "#16a34a"; 
                        return;
                    }

                    let periodosNecessarios;
                    let unidadeTempo = "";

                    switch(periodo) {
                        case 'dia':
                            periodosNecessarios = Math.ceil(valorRestante / valorPoupanca);
                            unidadeTempo = periodosNecessarios === 1 ? "dia" : "dias";
                            break;
                        case 'semana':
                            periodosNecessarios = Math.ceil(valorRestante / valorPoupanca);
                            unidadeTempo = periodosNecessarios === 1 ? "semana" : "semanas";
                            break;
                        case 'quinzena':
                            periodosNecessarios = Math.ceil(valorRestante / valorPoupanca);
                            unidadeTempo = periodosNecessarios === 1 ? "quinzena" : "quinzenas";
                            break;
                        case 'mes':
                            periodosNecessarios = Math.ceil(valorRestante / valorPoupanca);
                            unidadeTempo = periodosNecessarios === 1 ? "m√™s" : "meses";
                            break;
                    }
                    resultadoEl.textContent = `Com R$ ${valorPoupanca.toFixed(2)} por ${periodo.replace('a', '')}, voc√™ quitar√° em ${periodosNecessarios} ${unidadeTempo}.`;
                    resultadoEl.style.color = "#166534"; 
                });
            }
            
            const valorJaPagoInput = document.getElementById('planejamento-valor-ja-pago');
            if(valorJaPagoInput) {
                valorJaPagoInput.addEventListener('input', () => {
                     if(!dividaAtualParaPlanejamento) return;
                    const valorJaPago = parseFloat(valorJaPagoInput.value) || 0;
                    const valorRestante = dividaAtualParaPlanejamento.valorTotal - valorJaPago;
                    const progressBar = document.getElementById('quitacao-progress-bar');

                    document.getElementById('meta-valor-pago-display').textContent = `R$ ${valorJaPago.toFixed(2)}`;
                    document.getElementById('meta-falta-quitar-display').textContent = `R$ ${valorRestante.toFixed(2)}`;
                    
                    let progresso = 0;
                    if (dividaAtualParaPlanejamento.valorTotal > 0) {
                        progresso = (valorJaPago / dividaAtualParaPlanejamento.valorTotal) * 100;
                    }
                    progressBar.style.width = `${Math.min(progresso, 100)}%`;
                    progressBar.textContent = `${Math.min(progresso, 100).toFixed(0)}%`;

                    const resultadoEl = document.getElementById('resultado-calculo-quitacao');
                    if(resultadoEl) resultadoEl.textContent = '';
                });
            }


            if(btnCriarMetaQuitacaoReal) { 
                btnCriarMetaQuitacaoReal.addEventListener('click', () => {
                    if(!dividaAtualParaPlanejamento) {
                        alert("Nenhuma d√≠vida selecionada para criar meta.");
                        return;
                    }
                    const nomeDivida = dividaAtualParaPlanejamento.nome;
                    const valorPoupanca = document.getElementById('planejamento-poupanca').value;
                    const periodo = document.getElementById('planejamento-periodo').value;
                    const resultado = document.getElementById('resultado-calculo-quitacao').textContent;
                    
                    alert(`Meta de quita√ß√£o para "${nomeDivida}" com R$${valorPoupanca} por ${periodo.replace('a','')} criada!\n${resultado}\n(Funcionalidade de integra√ß√£o com Metas e Dashboard a ser implementada)`);
                    console.log("Criar Meta de Quita√ß√£o:", {
                        divida: nomeDivida,
                        valorPoupanca: valorPoupanca,
                        periodo: periodo,
                        simulacao: resultado
                    });
                });
            }

            if(btnVoltarParaDividas) {
                btnVoltarParaDividas.addEventListener('click', () => {
                    setActivePage('liberdade-financeira-page');
                });
            }


            // --- In√≠cio L√≥gica da P√°gina Lucro Certo ---
            let produtoSelecionadoLucroCerto = null; 

            function popularProdutosSelectLucroCerto() {
                if (!lucroProdutoSelect) return;
                lucroProdutoSelect.innerHTML = '<option value="">-- Escolha um Produto --</option>';
                produtosCadastrados.forEach(produto => { 
                    const option = document.createElement('option');
                    option.value = produto.id;
                    option.textContent = produto.nome;
                    lucroProdutoSelect.appendChild(option);
                });
            }

            function calcularLucroProduto() {
                if (!produtoSelecionadoLucroCerto || !lucroMargemDesejadaInput || !lucroCustoTotalDisplayEl || !lucroPrecoVendaSugeridoEl || !lucroLiquidoUnidadeEl) return;

                const custoCompra = produtoSelecionadoLucroCerto.valorCustoCompra;
                const custoFixoUnit = parseFloat(custoFixoUnitarioDisplayEl?.textContent.replace('R$ ', '').replace(',', '.')) || 0;
                const custoVarUnitTotal = parseFloat(custoVariavelUnitarioTotalDisplayEl?.textContent.replace('R$ ', '').replace(',', '.')) || 0;
                const custoFreteUnit = 0.80; 
                
                const custoTotalUnitarioProduto = custoCompra + custoFixoUnit + custoVarUnitTotal + custoFreteUnit;
                lucroCustoTotalDisplayEl.textContent = `R$ ${custoTotalUnitarioProduto.toFixed(2)}`;

                const margemDesejada = parseFloat(lucroMargemDesejadaInput.value) / 100; // Agora permite margens > 100%
                if (isNaN(margemDesejada) || margemDesejada < 0) { // Apenas verifica se √© negativo
                    if(lucroPrecoVendaSugeridoEl) lucroPrecoVendaSugeridoEl.textContent = 'Margem Inv√°lida';
                    if(lucroLiquidoUnidadeEl) lucroLiquidoUnidadeEl.textContent = 'R$ 0,00';
                    if(alertaMargemBaixaEl) alertaMargemBaixaEl.style.display = 'block';
                    if(alertaMargemBaixaEl) alertaMargemBaixaEl.textContent = 'Margem de lucro inv√°lida. Deve ser um valor positivo.';
                    if (lucroProdutoChartInstance) lucroProdutoChartInstance.destroy();
                    return;
                }

                const precoVenda = custoTotalUnitarioProduto * (1 + margemDesejada); // F√≥rmula corrigida
                lucroPrecoVendaSugeridoEl.textContent = `R$ ${precoVenda.toFixed(2)}`;

                const lucroLiquido = precoVenda - custoTotalUnitarioProduto;
                lucroLiquidoUnidadeEl.textContent = `R$ ${lucroLiquido.toFixed(2)}`;

                atualizarGraficoLucroProduto(custoFixoUnit, custoVarUnitTotal, custoFreteUnit, lucroLiquido, custoCompra);

                const margemCalculada = (lucroLiquido / precoVenda) * 100;
                if (precoVenda > 0 && margemCalculada < 30 && margemCalculada >= 0) {  // Garante que a margem n√£o √© negativa para o alerta
                    if(alertaMargemBaixaEl) {
                        alertaMargemBaixaEl.textContent = 'Aten√ß√£o! Sua margem de lucro est√° abaixo de 30%. Considere revisar seus custos ou pre√ßo de venda.';
                        alertaMargemBaixaEl.style.display = 'block';
                    }
                } else {
                    if(alertaMargemBaixaEl) alertaMargemBaixaEl.style.display = 'none';
                }
                
                calcularProjecaoLucroMensal();
                calcularMetaVendasLucro();
            }
            
            function atualizarGraficoLucroProduto(cf, cv, frete, lucro, custoCompra) {
                if (lucroProdutoChartInstance) {
                    lucroProdutoChartInstance.destroy();
                }
                if (!lucroProdutoChartCanvas || (cf === 0 && cv === 0 && frete === 0 && lucro <= 0 && custoCompra === 0) ) return; 

                const precoVenda = custoCompra + cf + cv + frete + lucro;
                if (precoVenda <= 0) return; 

                const data = {
                    labels: ['Custo Fixo Unit.', 'Custo Vari√°vel Unit.', 'Custo Frete Unit.', 'Lucro L√≠quido', 'Custo Compra'],
                    datasets: [{
                        label: 'Composi√ß√£o do Pre√ßo de Venda',
                        data: [
                            (cf / precoVenda * 100).toFixed(1), 
                            (cv / precoVenda * 100).toFixed(1),
                            (frete / precoVenda * 100).toFixed(1),
                            (lucro / precoVenda * 100).toFixed(1),
                            (custoCompra / precoVenda * 100).toFixed(1)
                        ],
                        backgroundColor: [
                            'rgba(255, 205, 86, 0.7)', 
                            'rgba(255, 159, 64, 0.7)', 
                            'rgba(201, 203, 207, 0.7)', 
                            'rgba(75, 192, 192, 0.7)', 
                            'rgba(236, 72, 153, 0.7)'  
                        ],
                        borderColor: [
                            'rgba(255, 205, 86, 1)',
                            'rgba(255, 159, 64, 1)',
                            'rgba(201, 203, 207, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(236, 72, 153, 1)'
                        ],
                        borderWidth: 1
                    }]
                };
                lucroProdutoChartInstance = new Chart(lucroProdutoChartCanvas, {
                    type: 'doughnut',
                    data: data,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { font: { size: 10 } }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.label || '';
                                        if (label) { label += ': '; }
                                        if (context.parsed !== null) { label += context.parsed + '%'; }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            }


            function calcularProjecaoLucroMensal() {
                if(!lucroQtdVenderMesInput || !lucroLiquidoUnidadeEl || !lucroMensalProjetadoEl) return;
                const qtd = parseInt(lucroQtdVenderMesInput.value) || 0;
                const lucroUnidade = parseFloat(lucroLiquidoUnidadeEl.textContent.replace('R$ ', '').replace(',', '.')) || 0;
                const lucroProjetado = qtd * lucroUnidade;
                lucroMensalProjetadoEl.textContent = `R$ ${lucroProjetado.toFixed(2)}`;
            }

            function calcularMetaVendasLucro() {
                if(!lucroDesejadoMensalInput || !lucroLiquidoUnidadeEl || !lucroMetaVendasUnidadesEl) return;
                const lucroDesejado = parseFloat(lucroDesejadoMensalInput.value) || 0;
                const lucroUnidade = parseFloat(lucroLiquidoUnidadeEl.textContent.replace('R$ ', '').replace(',', '.')) || 0;
                
                if (lucroUnidade > 0) {
                    const unidadesNecessarias = Math.ceil(lucroDesejado / lucroUnidade);
                    lucroMetaVendasUnidadesEl.textContent = `${unidadesNecessarias} unidades`;
                } else {
                    lucroMetaVendasUnidadesEl.textContent = `Defina lucro/unidade`;
                }
            }

            if(lucroProdutoSelect) {
                lucroProdutoSelect.addEventListener('change', function() {
                    const produtoId = this.value;
                    if (produtoId) {
                        produtoSelecionadoLucroCerto = produtosCadastrados.find(p => p.id === produtoId);
                        if (produtoSelecionadoLucroCerto) {
                            if(lucroCertoContentEl) lucroCertoContentEl.style.display = 'block';
                            if(lucroCertoSelecioneProdutoMsg) lucroCertoSelecioneProdutoMsg.style.display = 'none';
                            if(lucroNomeProdutoDisplayEl) lucroNomeProdutoDisplayEl.textContent = produtoSelecionadoLucroCerto.nome;
                            if(lucroMargemDesejadaInput) lucroMargemDesejadaInput.value = 50; 
                            calcularLucroProduto();
                        }
                    } else {
                         if(lucroCertoContentEl) lucroCertoContentEl.style.display = 'none';
                         if(lucroCertoSelecioneProdutoMsg) lucroCertoSelecioneProdutoMsg.style.display = 'block';
                         produtoSelecionadoLucroCerto = null;
                         if (lucroProdutoChartInstance) lucroProdutoChartInstance.destroy();
                    }
                });
            }

            if(lucroMargemDesejadaInput) lucroMargemDesejadaInput.addEventListener('input', calcularLucroProduto);
            if(lucroQtdVenderMesInput) lucroQtdVenderMesInput.addEventListener('input', calcularProjecaoLucroMensal);
            if(lucroDesejadoMensalInput) lucroDesejadoMensalInput.addEventListener('input', calcularMetaVendasLucro);

            // --- Fim L√≥gica da P√°gina Lucro Certo ---

            // --- L√≥gica da P√°gina Calculadoras (Hub e Individuais) ---
            const calculatorCards = document.querySelectorAll('.calculator-card');
            calculatorCards.forEach(card => {
                card.addEventListener('click', () => {
                    const targetCalculatorPageId = card.dataset.targetCalculator;
                    if (targetCalculatorPageId) {
                        setActivePage(targetCalculatorPageId);
                    }
                });
            });

            document.querySelectorAll('.btn-voltar-calculadoras').forEach(button => {
                button.addEventListener('click', () => {
                    setActivePage('calculadoras-page');
                });
            });

            function resetFormsCalculadoras(){ 
                // Reset Calc Lucro Ideal
                if(calcLucroIdealProdutoSelect) calcLucroIdealProdutoSelect.value = "";
                const calcLucroProdutoDetalhes = document.getElementById('calc-lucro-ideal-produto-detalhes');
                if(calcLucroProdutoDetalhes) calcLucroProdutoDetalhes.style.display = 'none';
                if(document.getElementById('calc-lucro-ideal-margem-desejada')) document.getElementById('calc-lucro-ideal-margem-desejada').value = "50";
                if(document.getElementById('calc-lucro-ideal-preco-ideal')) document.getElementById('calc-lucro-ideal-preco-ideal').textContent = 'R$ 0,00';
                if(document.getElementById('calc-lucro-ideal-liquido-unidade')) document.getElementById('calc-lucro-ideal-liquido-unidade').textContent = 'R$ 0,00';

                // Reset Calc Frete
                 if(document.getElementById('calc-frete-total')) document.getElementById('calc-frete-total').value = '';
                 if(document.getElementById('calc-frete-num-produtos')) document.getElementById('calc-frete-num-produtos').value = '';
                 if(document.getElementById('calc-frete-resultado')) document.getElementById('calc-frete-resultado').textContent = 'R$ 0,00';

                // Reset Calc Meta Vendas
                if(document.getElementById('calc-meta-lucro-desejado')) document.getElementById('calc-meta-lucro-desejado').value = '';
                if(calcMetaVendasProdutoSelect) calcMetaVendasProdutoSelect.value = '';
                if(document.getElementById('calc-meta-lucro-unidade-produto')) document.getElementById('calc-meta-lucro-unidade-produto').textContent = 'R$ 0,00';
                if(document.getElementById('calc-meta-unidades-vender')) document.getElementById('calc-meta-unidades-vender').textContent = '0 unidades';

                // Reset Calc Reinvestimento
                if(document.getElementById('calc-reinvest-lucro-disponivel')) document.getElementById('calc-reinvest-lucro-disponivel').value = '';
                if(document.getElementById('calc-reinvest-perc-negocio')) document.getElementById('calc-reinvest-perc-negocio').value = '50';
                if(document.getElementById('calc-reinvest-perc-reserva')) document.getElementById('calc-reinvest-perc-reserva').value = '30';
                if(document.getElementById('calc-reinvest-perc-dividas')) document.getElementById('calc-reinvest-perc-dividas').value = '20';
                if(document.getElementById('calc-reinvest-valor-negocio')) document.getElementById('calc-reinvest-valor-negocio').textContent = 'R$ 0,00';
                if(document.getElementById('calc-reinvest-valor-reserva')) document.getElementById('calc-reinvest-valor-reserva').textContent = 'R$ 0,00';
                if(document.getElementById('calc-reinvest-valor-dividas')) document.getElementById('calc-reinvest-valor-dividas').textContent = 'R$ 0,00';
                if(document.getElementById('calc-reinvest-soma-perc-aviso')) document.getElementById('calc-reinvest-soma-perc-aviso').style.display = 'none';

                // Reset Calc Precifica√ß√£o Manual
                if(document.getElementById('calc-manual-custo-produto')) document.getElementById('calc-manual-custo-produto').value = '';
                if(document.getElementById('calc-manual-custos-variaveis')) document.getElementById('calc-manual-custos-variaveis').value = '';
                if(document.getElementById('calc-manual-custos-fixos-rateio')) document.getElementById('calc-manual-custos-fixos-rateio').value = '';
                if(document.getElementById('calc-manual-margem-lucro')) document.getElementById('calc-manual-margem-lucro').value = '';
                if(document.getElementById('calc-manual-custo-total-display')) document.getElementById('calc-manual-custo-total-display').textContent = 'R$ 0,00';
                if(document.getElementById('calc-manual-preco-venda-display')) document.getElementById('calc-manual-preco-venda-display').textContent = 'R$ 0,00';
                if(document.getElementById('calc-manual-lucro-liquido-display')) document.getElementById('calc-manual-lucro-liquido-display').textContent = 'R$ 0,00';
            }
            
            // Fun√ß√µes para popular selects das calculadoras
            function popularProdutosSelectCalcLucroIdeal() {
                if (!calcLucroIdealProdutoSelect) return;
                calcLucroIdealProdutoSelect.innerHTML = '<option value="">-- Escolha um Produto --</option>';
                produtosCadastrados.forEach(produto => {
                    const option = document.createElement('option');
                    option.value = produto.id;
                    option.textContent = produto.nome;
                    option.dataset.custoCompra = produto.valorCustoCompra;
                    calcLucroIdealProdutoSelect.appendChild(option);
                });
                const detalhesEl = document.getElementById('calc-lucro-ideal-produto-detalhes');
                if(detalhesEl) detalhesEl.style.display = 'none'; 
            }
            function popularProdutosSelectCalcMetaVendas() {
                 if (!calcMetaVendasProdutoSelect) return;
                calcMetaVendasProdutoSelect.innerHTML = '<option value="">-- Escolha um Produto Chave --</option>';
                produtosCadastrados.forEach(produto => {
                    const option = document.createElement('option');
                    option.value = produto.id;
                    option.textContent = produto.nome;
                    const custoFixoUnitario = parseFloat(custoFixoUnitarioDisplayEl?.textContent.replace('R$ ', '').replace(',', '.')) || 0;
                    const custoVariavelUnitario = parseFloat(custoVariavelUnitarioTotalDisplayEl?.textContent.replace('R$ ', '').replace(',', '.')) || 0;
                    const custoFrete = 0.80; 
                    const custoTotalProduto = produto.valorCustoCompra + custoFixoUnitario + custoVariavelUnitario + custoFrete;
                    // Assumindo uma margem padr√£o de 50% para calcular o lucro unidade para o select
                    const precoVendaSimulado = custoTotalProduto * (1 + 0.50); // F√≥rmula corrigida para markup
                    option.dataset.lucroUnidade = (precoVendaSimulado - custoTotalProduto).toFixed(2);
                    calcMetaVendasProdutoSelect.appendChild(option);
                });
                if(document.getElementById('calc-meta-lucro-unidade-produto')) document.getElementById('calc-meta-lucro-unidade-produto').textContent = 'R$ 0,00';
                if(document.getElementById('calc-meta-unidades-vender')) document.getElementById('calc-meta-unidades-vender').textContent = '0 unidades';
            }

            // --- Event Listeners para Calculadoras Espec√≠ficas ---
            
            // Calculadora Lucro Ideal
            if(calcLucroIdealProdutoSelect) {
                calcLucroIdealProdutoSelect.addEventListener('change', function() {
                    const produtoId = this.value;
                    const detalhesEl = document.getElementById('calc-lucro-ideal-produto-detalhes');
                    if (produtoId && detalhesEl) {
                        const produto = produtosCadastrados.find(p => p.id === produtoId);
                        if (produto) {
                            document.getElementById('calc-lucro-ideal-custo-compra').textContent = `R$ ${parseFloat(produto.valorCustoCompra).toFixed(2)}`;
                            document.getElementById('calc-lucro-ideal-custo-fixo').textContent = custoFixoUnitarioDisplayEl?.textContent || 'R$ 0,00';
                            document.getElementById('calc-lucro-ideal-custo-variavel').textContent = custoVariavelUnitarioTotalDisplayEl?.textContent || 'R$ 0,00';
                            document.getElementById('calc-lucro-ideal-custo-frete').textContent = 'R$ 0.80'; // Simulado
                            detalhesEl.style.display = 'block';
                            const margemInput = document.getElementById('calc-lucro-ideal-margem-desejada');
                            if (margemInput) margemInput.value = 50; // Reset margem
                            const btnCalc = document.getElementById('btn-calcular-lucro-ideal');
                            if (btnCalc) btnCalc.click(); // Simula clique para calcular
                        }
                    } else if(detalhesEl) {
                        detalhesEl.style.display = 'none';
                    }
                });
            }
            const btnCalcularLucroIdeal = document.getElementById('btn-calcular-lucro-ideal');
            if(btnCalcularLucroIdeal) {
                btnCalcularLucroIdeal.addEventListener('click', () => {
                     const produtoId = document.getElementById('calc-lucro-ideal-produto-select').value;
                     if(!produtoId) {alert("Selecione um produto primeiro."); return;}
                    const produto = produtosCadastrados.find(p => p.id === produtoId);
                    if(!produto) return;

                    const custoCompra = produto.valorCustoCompra;
                    const custoFixoUnit = parseFloat(document.getElementById('calc-lucro-ideal-custo-fixo').textContent.replace('R$ ', '').replace(',', '.')) || 0;
                    const custoVarUnit = parseFloat(document.getElementById('calc-lucro-ideal-custo-variavel').textContent.replace('R$ ', '').replace(',', '.')) || 0;
                    const custoFreteUnit = parseFloat(document.getElementById('calc-lucro-ideal-custo-frete').textContent.replace('R$ ', '').replace(',', '.')) || 0;
                    const custoTotalProduto = custoCompra + custoFixoUnit + custoVarUnit + custoFreteUnit;
                    document.getElementById('calc-lucro-ideal-custo-total-produto').textContent = `R$ ${custoTotalProduto.toFixed(2)}`;

                    const margemEl = document.getElementById('calc-lucro-ideal-margem-desejada');
                    const margem = parseFloat(margemEl.value) / 100; // margem como decimal (ex: 50% -> 0.5)

                    if(isNaN(margem) || margem < 0) { 
                        document.getElementById('calc-lucro-ideal-preco-ideal').textContent = 'Margem Inv√°lida';
                        document.getElementById('calc-lucro-ideal-liquido-unidade').textContent = 'R$ 0,00';
                        return;
                    }
                    // Pre√ßo de Venda = Custo Total * (1 + Margem de Lucro)
                    const precoVenda = custoTotalProduto * (1 + margem);
                    const lucroUnidade = precoVenda - custoTotalProduto;
                    document.getElementById('calc-lucro-ideal-preco-ideal').textContent = `R$ ${precoVenda.toFixed(2)}`;
                    document.getElementById('calc-lucro-ideal-liquido-unidade').textContent = `R$ ${lucroUnidade.toFixed(2)}`;
                });
            }
            if(document.getElementById('btn-salvar-preco-produto-lucro-ideal')) {
                document.getElementById('btn-salvar-preco-produto-lucro-ideal').addEventListener('click', () => {
                    alert("Pre√ßo salvo no produto (Simula√ß√£o)!");
                });
            }

            // Calculadora Frete Unit√°rio
            const btnCalcularFreteUnitario = document.getElementById('btn-calcular-frete-unitario');
            if(btnCalcularFreteUnitario) {
                btnCalcularFreteUnitario.addEventListener('click', () => {
                    const totalFrete = parseFloat(document.getElementById('calc-frete-total').value) || 0;
                    const numProdutos = parseInt(document.getElementById('calc-frete-num-produtos').value) || 1;
                    const resultadoEl = document.getElementById('calc-frete-resultado');
                    if (numProdutos <= 0) {
                        resultadoEl.textContent = "N√∫mero de produtos inv√°lido.";
                        return;
                    }
                    const freteUnitario = totalFrete / numProdutos;
                    resultadoEl.textContent = `R$ ${freteUnitario.toFixed(2)}`;
                });
            }
            if(document.getElementById('btn-salvar-frete-custo-variavel')) {
                document.getElementById('btn-salvar-frete-custo-variavel').addEventListener('click', () => {
                     const freteUnitario = parseFloat(document.getElementById('calc-frete-resultado').textContent.replace('R$ ','').replace(',','.')) || 0;
                     if(freteUnitario > 0) {
                        custosVariaveis.push({nome: "Frete Unit√°rio (Pedido)", valorUnitario: freteUnitario});
                        if(document.getElementById('despesas-page').classList.contains('active')){
                            if(typeof exibirCustosVariaveis === "function") exibirCustosVariaveis();
                        }
                         alert("Frete unit√°rio adicionado como custo vari√°vel! (Simula√ß√£o)");
                     } else {
                         alert("Calcule o frete unit√°rio primeiro.");
                     }
                });
            }


            // Calculadora Meta de Vendas
            const btnCalcularMetaVendas = document.getElementById('btn-calcular-meta-vendas');
            if(btnCalcularMetaVendas && calcMetaVendasProdutoSelect) {
                 calcMetaVendasProdutoSelect.addEventListener('change', function(){ 
                    const selectedOption = this.options[this.selectedIndex];
                    if (selectedOption && selectedOption.value) { 
                        const lucroUnidade = parseFloat(selectedOption.dataset.lucroUnidade) || 0;
                        document.getElementById('calc-meta-lucro-unidade-produto').textContent = `R$ ${lucroUnidade.toFixed(2)}`;
                    } else {
                         document.getElementById('calc-meta-lucro-unidade-produto').textContent = `R$ 0,00`;
                    }
                    document.getElementById('calc-meta-unidades-vender').textContent = '0 unidades'; 
                 });

                btnCalcularMetaVendas.addEventListener('click', () => {
                    const lucroDesejado = parseFloat(document.getElementById('calc-meta-lucro-desejado').value) || 0;
                    const produtoSelecionadoOption = calcMetaVendasProdutoSelect.options[calcMetaVendasProdutoSelect.selectedIndex];
                    const lucroUnidadeProduto = parseFloat(produtoSelecionadoOption.dataset.lucroUnidade) || 0;
                    const resultadoEl = document.getElementById('calc-meta-unidades-vender');

                    if(!produtoSelecionadoOption.value){
                        alert("Por favor, selecione um produto chave.");
                        return;
                    }
                    document.getElementById('calc-meta-lucro-unidade-produto').textContent = `R$ ${lucroUnidadeProduto.toFixed(2)}`;

                    if (lucroDesejado <= 0) {
                        resultadoEl.textContent = "Defina uma meta de lucro v√°lida.";
                        return;
                    }
                    if (lucroUnidadeProduto <= 0) {
                        resultadoEl.textContent = "Lucro por unidade inv√°lido para c√°lculo.";
                        return;
                    }
                    const unidadesNecessarias = Math.ceil(lucroDesejado / lucroUnidadeProduto);
                    resultadoEl.textContent = `${unidadesNecessarias} unidades`;
                });
            }

            // Calculadora Reinvestimento Inteligente
            const btnCalcularReinvestimento = document.getElementById('btn-calcular-reinvestimento');
            if(btnCalcularReinvestimento){
                btnCalcularReinvestimento.addEventListener('click', () => {
                    const lucroDisponivel = parseFloat(document.getElementById('calc-reinvest-lucro-disponivel').value) || 0;
                    const percNegocio = parseFloat(document.getElementById('calc-reinvest-perc-negocio').value) || 0;
                    const percReserva = parseFloat(document.getElementById('calc-reinvest-perc-reserva').value) || 0;
                    const percDividas = parseFloat(document.getElementById('calc-reinvest-perc-dividas').value) || 0;
                    const avisoEl = document.getElementById('calc-reinvest-soma-perc-aviso');

                    if(percNegocio + percReserva + percDividas !== 100){
                        avisoEl.style.display = 'block';
                        return;
                    }
                    avisoEl.style.display = 'none';

                    document.getElementById('calc-reinvest-valor-negocio').textContent = `R$ ${(lucroDisponivel * (percNegocio / 100)).toFixed(2)}`;
                    document.getElementById('calc-reinvest-valor-reserva').textContent = `R$ ${(lucroDisponivel * (percReserva / 100)).toFixed(2)}`;
                    document.getElementById('calc-reinvest-valor-dividas').textContent = `R$ ${(lucroDisponivel * (percDividas / 100)).toFixed(2)}`;
                });
            }
            ['calc-reinvest-perc-negocio', 'calc-reinvest-perc-reserva', 'calc-reinvest-perc-dividas'].forEach(id => {
                const inputEl = document.getElementById(id);
                if(inputEl) inputEl.addEventListener('input', () => { 
                    document.getElementById('calc-reinvest-valor-negocio').textContent = 'R$ 0,00';
                    document.getElementById('calc-reinvest-valor-reserva').textContent = 'R$ 0,00';
                    document.getElementById('calc-reinvest-valor-dividas').textContent = 'R$ 0,00';
                    document.getElementById('calc-reinvest-soma-perc-aviso').style.display = 'none';
                });
            });


            // Calculadora Precifica√ß√£o Manual
            const btnCalcularPrecoManual = document.getElementById('btn-calcular-preco-manual');
            if(btnCalcularPrecoManual){
                btnCalcularPrecoManual.addEventListener('click', () => {
                    const custoProduto = parseFloat(document.getElementById('calc-manual-custo-produto').value) || 0;
                    const custosVariaveis = parseFloat(document.getElementById('calc-manual-custos-variaveis').value) || 0;
                    const custosFixosRateio = parseFloat(document.getElementById('calc-manual-custos-fixos-rateio').value) || 0;
                    const margemLucro = parseFloat(document.getElementById('calc-manual-margem-lucro').value) / 100 || 0; // Margem como decimal

                    const custoTotal = custoProduto + custosVariaveis + custosFixosRateio;
                    document.getElementById('calc-manual-custo-total-display').textContent = `R$ ${custoTotal.toFixed(2)}`;

                    if(isNaN(margemLucro) || margemLucro < 0) { 
                         document.getElementById('calc-manual-preco-venda-display').textContent = 'Margem Inv√°lida';
                         document.getElementById('calc-manual-lucro-liquido-display').textContent = 'R$ 0,00';
                        return;
                    }
                     // Pre√ßo de Venda = Custo Total * (1 + Margem de Lucro)
                    const precoVenda = custoTotal * (1 + margemLucro);
                    const lucroLiquido = precoVenda - custoTotal;

                    document.getElementById('calc-manual-preco-venda-display').textContent = `R$ ${precoVenda.toFixed(2)}`;
                    document.getElementById('calc-manual-lucro-liquido-display').textContent = `R$ ${lucroLiquido.toFixed(2)}`;
                });
            }

            // --- Fim L√≥gica da P√°gina Calculadoras (Hub e Individuais) ---


            // Define a p√°gina inicial (Dashboard) e recalcula custos se for a p√°gina de despesas
            const initialPage = 'dashboard-page'; 
            const activePage = document.querySelector('.page-content.active');
            if (!activePage && document.getElementById(initialPage)) {
                 setActivePage(initialPage);
            } else if (!activePage && pageContents.length > 0) {
                setActivePage(pageContents[0].id);
            } else if (activePage){ 
                if (activePage.id === 'despesas-page'){
                     if(typeof exibirCustosFixos === "function") exibirCustosFixos();
                     if(typeof exibirCustosVariaveis === "function") exibirCustosVariaveis();
                } else if (activePage.id === 'liberdade-financeira-page') {
                    if(typeof exibirDividas === "function") exibirDividas();
                } else if (activePage.id === 'produtos-page') {
                    if(typeof exibirProdutosEmCards === 'function') exibirProdutosEmCards();
                } else if (activePage.id === 'vendas-page') {
                    if(typeof exibirVendasEmCards === 'function') exibirVendasEmCards();
                    if(typeof popularProdutosSelectVenda === 'function') popularProdutosSelectVenda();
                } else if (activePage.id === 'lucro-certo-page') {
                    if(typeof popularProdutosSelectLucroCerto === "function") popularProdutosSelectLucroCerto();
                     if(lucroCertoContentEl) lucroCertoContentEl.style.display = 'none';
                     if(lucroCertoSelecioneProdutoMsg) lucroCertoSelecioneProdutoMsg.style.display = 'block';
                } else if (activePage.id.startsWith('calc-')) {
                    if(activePage.id === 'calc-lucro-ideal-page' && typeof popularProdutosSelectCalcLucroIdeal === "function") popularProdutosSelectCalcLucroIdeal();
                    if(activePage.id === 'calc-meta-vendas-page' && typeof popularProdutosSelectCalcMetaVendas === "function") popularProdutosSelectCalcMetaVendas();
                }
            }
        });
    </script>
</body>
</html>
