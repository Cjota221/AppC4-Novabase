<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C4 - Gestão para Empreendedoras</title>
    <!-- 
        Comentário: Favicon e meta tags adicionais podem ser inseridos aqui.
        Exemplo: <link rel="icon" href="favicon.ico" type="image/x-icon">
    -->

    <!-- 
        Comentário: Links para arquivos CSS Globais (base, layout)
        Futuramente, estes estilos inline serão movidos para arquivos CSS externos.
        Exemplo: <link rel="stylesheet" href="css/base.css">
        Exemplo: <link rel="stylesheet" href="css/layout.css">
    -->
    <style>
        /* Estilos básicos para visualização inicial e mobile-first */
        body { 
            font-family: 'Poppins', sans-serif; /* Tipografia sugerida */
            margin: 0; 
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: #fdf2f8; /* Um rosa bem clarinho para o fundo, derivado de #db1472 */
            position: relative;
            overflow-x: hidden;
        }

        /* Cabeçalho */
        .app-header { 
            background-color: #db1472; /* Rosa Principal da paleta */
            /* Mantendo o degradê, agora com o rosa principal */
            background-image: linear-gradient(to right, #db1472, #ec4899); /* Rosa principal para um tom similar */
            color: white; 
            padding: 0.8rem 1rem; 
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        }
        .app-header-title {
            margin: 0;
            font-size: 1.6rem; /* Um pouco maior */
            font-weight: 700; /* Fonte mais grossa */
        }
        .menu-toggle {
            background: none;
            border: none;
            color: white;
            font-size: 1.8rem; 
            cursor: pointer;
            padding: 0.5rem;
            display: flex; 
            align-items: center;
            justify-content: center;
        }
        .menu-toggle svg {
            width: 30px; /* Icone um pouco maior */
            height: 30px;
        }

        /* Navegação Lateral (Sidebar) */
        .sidebar-nav {
            height: 100%;
            width: 0; 
            position: fixed;
            z-index: 1001; 
            top: 0;
            left: 0;
            background-color: #db1472; /* Rosa Principal da paleta como base */
            /* Degradê sutil para a sidebar usando tons de rosa e talvez um toque de dourado no futuro */
            background-image: linear-gradient(to bottom, #db1472, #c01062); /* Rosa um pouco mais escuro */
            overflow-x: hidden;
            transition: 0.3s ease-in-out; 
            padding-top: 20px; /* Reduzido padding-top pois o header da sidebar agora tem seu próprio padding */
            box-shadow: 4px 0 8px rgba(0,0,0,0.25);
            display: flex;
            flex-direction: column;
        }
        .sidebar-nav.open {
            width: 260px; /* Um pouco mais larga */
        }
        .sidebar-nav-header { /* Para o título C4 e botão de fechar dentro da sidebar */
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px; /* Ajuste no padding */
            border-bottom: 1px solid #c01062; /* Linha separadora abaixo do header da sidebar */
            margin-bottom: 10px;
        }
        .sidebar-nav-header .sidebar-title {
            color: #ffffff;
            font-size: 1.8em;
            font-weight: 700;
            margin:0;
        }
        .sidebar-nav .close-btn { /* Movido para dentro do .sidebar-nav-header implicitamente */
            font-size: 2.2rem; 
            font-weight: 700;
            color: #fce7f3; 
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px; /* Adicionado padding para facilitar o clique */
        }
        .sidebar-nav .close-btn:hover {
            color: #f8b81f; 
        }
        .sidebar-nav-links {
            flex-grow: 1;
            overflow-y: auto; /* Permite scroll se muitos itens */
        }

        .sidebar-nav a {
            padding: 14px 18px 14px 25px; 
            text-decoration: none;
            font-size: 1.15rem; 
            font-weight: 500; 
            color: #fce7f3; 
            display: flex; /* Para alinhar ícone e texto */
            align-items: center; /* Alinha verticalmente ícone e texto */
            transition: 0.2s ease-in-out;
            border-bottom: 1px solid #c01062; 
        }
        .sidebar-nav a svg { /* Estilo para os ícones SVG no menu */
            margin-right: 12px; /* Espaçamento entre ícone e texto */
            width: 20px;
            height: 20px;
            vertical-align: middle; /* Embora flex alignItems deva cuidar disso */
            fill: none; /* Garante que o fill não sobreponha o stroke para alguns SVGs */
            stroke: currentColor; /* Cor do ícone herda a cor do link */
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        .sidebar-nav-links a:last-child { /* Aplicado ao container dos links */
            border-bottom: none; 
        }
        .sidebar-nav a:hover,
        .sidebar-nav a.active {
            color: #db1472; 
            background-color: #f8b81f; 
            font-weight: 600;
        }
        .sidebar-nav a:hover svg,
        .sidebar-nav a.active svg {
            stroke: #db1472; /* Cor do ícone no hover/active */
        }


        /* Conteúdo Principal */
        main { 
            flex-grow: 1; 
            padding: 1.8rem 1.2rem; 
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            box-sizing: border-box;
            transition: margin-left 0.3s ease-in-out; 
        }
        body.sidebar-open main {
             /* Mantém sem margin-left para sobreposição em mobile */
        }

        .page-content {
            /* Sem padding-bottom específico aqui */
        }
        .page-title {
            color: #db1472; 
            border-bottom: 4px solid #f8b81f; 
            padding-bottom: 0.8rem;
            margin-top: 0;
            margin-bottom: 1.8rem; 
            font-size: 2rem; 
            font-weight: 600; 
        }
        .sub-page-title { /* Para títulos dentro de uma página, como na de planejamento */
            color: #c01062; /* Rosa mais escuro */
            font-size: 1.6rem;
            font-weight: 600;
            margin-top: 0;
            margin-bottom: 1.2rem;
        }


        /* Rodapé */
        footer {
            background-color: #f8f0f4; 
            color: #575355; 
            text-align: center;
            padding: 1.5rem;
            font-size: 0.9rem;
            border-top: 1px solid #e7d8de; 
        }

        /* Estilos para esconder/mostrar páginas */
        .page-content:not(.active) {
            display: none;
        }

        /* Overlay */
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(50,10,30,0.5); 
            z-index: 1000; 
            transition: opacity 0.3s ease-in-out;
        }
        .overlay.active {
            display: block;
        }

        /* Estilos para Cards - Revertido para 80% de opacidade sem degradê extra */
        .cards-container { /* Usado no Dashboard */
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
            gap: 1.2rem; 
            margin-bottom: 2.5rem;
        }
        .card { /* Usado no Dashboard */
            background-color: rgba(219, 20, 114, 0.8); /* Cor principal com 80% de opacidade */
            border-radius: 10px; 
            padding: 1.8rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); 
            transition: transform 0.25s ease-in-out, box-shadow 0.25s ease-in-out, background-color 0.25s ease-in-out; /* Alterado para background-color */
            color: #ffffff; 
        }
        .card:hover {
            transform: translateY(-6px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15); 
            background-color: rgba(219, 20, 114, 0.9); /* Um pouco menos transparente no hover */
        }
        .card-title {
            font-size: 1.25rem; 
            font-weight: 600; 
            color: #fdf2f8; 
            margin-top: 0;
            margin-bottom: 0.75rem;
        }
        .card-value {
            font-size: 2rem; 
            font-weight: 700; 
            color: #ffffff; 
            margin-bottom: 1.2rem;
        }
        .card-description {
            font-size: 0.95rem;
            color: #fce7f3; 
        }
        .quick-actions {
            display: flex;
            gap: 0.9rem;
            margin-top: 1.8rem;
            flex-wrap: wrap; 
        }
        .btn, /* Classe genérica para botões */
        .btn-action {
            background-color: #f8b81f; 
            color: #5c3c00; 
            border: none;
            padding: 0.7rem 1.2rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem; 
            font-weight: 600; 
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-decoration: none; /* Para links estilizados como botões */
            display: inline-flex; /* Para alinhar ícones dentro se necessário */
            align-items: center;
            justify-content: center;
        }
        .btn:hover,
        .btn-action:hover {
            background-color: #faca50; 
            transform: translateY(-2px);
        }
        .btn:active,
        .btn-action:active {
            transform: translateY(0px);
        }
        .btn-primary { /* Botão com cor principal */
            background-color: #db1472;
            color: white;
        }
        .btn-primary:hover {
            background-color: #c01062;
        }
        .btn-secondary { /* Botão com cor secundária ou para cancelamento */
            background-color: #e2e8f0; /* Cinza claro */
            color: #475569; /* Cinza escuro */
        }
        .btn-secondary:hover {
            background-color: #cbd5e1; /* Cinza um pouco mais escuro */
        }
        .btn-danger { /* Botão para ações destrutivas como excluir */
            background-color: #ef4444; /* Vermelho */
            color: white;
        }
        .btn-danger:hover {
            background-color: #dc2626; /* Vermelho mais escuro */
        }
        .btn-sm { /* Botão pequeno para ações em tabelas */
            padding: 0.4rem 0.8rem;
            font-size: 0.85rem;
        }


        /* Placeholder para Gráfico */
        .chart-container {
            background-color: #ffffff;
            border-radius: 10px;
            padding: 1.8rem;
            box-shadow: 0 5px 15px rgba(219, 20, 114, 0.1); 
            min-height: 280px; 
            display: flex;
            align-items: center;
            justify-content: center;
            color: #9ca3af; 
        }
        .chart-container p {
            font-size: 1.1rem;
            font-weight: 500;
        }

        /* Estilos para Formulários (Genérico) */
        .form-group {
            margin-bottom: 1.2rem;
        }
        .form-group label {
            display: block;
            font-weight: 500;
            color: #4b5563; /* Cinza escuro para labels */
            margin-bottom: 0.4rem;
        }
        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group input[type="email"],
        .form-group input[type="password"],
        .form-group input[type="date"], 
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db; /* Cinza claro para borda */
            border-radius: 6px;
            box-sizing: border-box; /* Para o padding não aumentar a largura total */
            font-size: 1rem;
            color: #374151; /* Cinza bem escuro para texto do input */
        }
        .form-group input[type="file"] {
            padding: 0.5rem; /* Ajuste específico para file input */
        }
        .form-group input[type="checkbox"] { /* Estilo para checkbox */
            margin-right: 0.5rem;
            vertical-align: middle;
        }
        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        .form-group .readonly-field { 
            background-color: #f3f4f6; 
            color: #4b5563;
            border: 1px solid #e5e7eb;
            cursor: default;
        }
        .form-group .calculated-field { 
            font-weight: bold;
            color: #db1472; 
            padding-top: 0.5rem;
        }

        .form-actions {
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end; 
            margin-top: 1.5rem;
        }
        .image-preview {
            max-width: 150px; 
            max-height: 150px;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
            margin-top: 0.5rem;
            display: none; 
            object-fit: cover;
        }

        /* Estilos para Tabelas Genéricas (Produtos, Vendas, Despesas) */
        .data-table-container {
            overflow-x: auto; 
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            margin-top: 1.5rem;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        .data-table th,
        .data-table td {
            padding: 0.9rem 1rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0; 
            color: #374151;
            vertical-align: middle;
        }
        .data-table th {
            background-color: #f9fafb; 
            font-weight: 600;
            color: #4b5563;
            white-space: nowrap; 
        }
        .data-table .actions-cell button {
            margin-right: 0.5rem;
        }
        .data-table .actions-cell button:last-child {
            margin-right: 0;
        }
        .data-table .status-badge { 
            padding: 0.25rem 0.6rem;
            border-radius: 12px; 
            font-size: 0.8rem;
            font-weight: 500;
            text-transform: capitalize;
        }
        .status-pago { background-color: #dcfce7; color: #166534; } 
        .status-pendente { background-color: #ffedd5; color: #9a3412; } 
        .status-cancelado { background-color: #fee2e2; color: #991b1b; } 


        /* Estilo para o container do formulário */
        .form-container { 
            background-color: #ffffff;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-top: 1.5rem;
        }
         #product-details-container { 
            background-color: #ffffff;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-top: 1.5rem;
            display: none; 
        }
        .costs-display-section {
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: #fdf2f8; 
            border-radius: 6px;
            border: 1px solid #fbcfe8; 
        }
        .costs-display-section h4 {
            margin-top: 0;
            margin-bottom: 0.75rem;
            color: #9d174d; 
        }
        .costs-display-section p {
            margin-bottom: 0.5rem;
            color: #500724; 
        }
        .costs-display-section p strong {
            color: #c01062; 
        }

        /* Página de Vendas Específico */
        #form-nova-venda-container .sale-items-list {
            margin-top: 1rem;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            min-height: 50px; 
        }
        #form-nova-venda-container .sale-items-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e2e8f0;
        }
        #form-nova-venda-container .sale-items-list li:last-child {
            border-bottom: none;
        }
        #form-nova-venda-container .sale-item-details {
            flex-grow: 1;
        }
        #form-nova-venda-container .sale-item-details strong {
            color: #db1472;
        }
        #form-nova-venda-container .sale-item-actions button {
            background: none;
            border: none;
            color: #ef4444; 
            cursor: pointer;
            padding: 0.25rem;
        }
        #form-nova-venda-container .sale-item-actions button:hover {
            color: #b91c1c;
        }
        #sale-summary {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 2px dashed #fbcfe8;
        }
        #sale-summary p {
            display: flex;
            justify-content: space-between;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: #500724;
        }
        #sale-summary p.total {
            font-size: 1.4rem;
            font-weight: 700;
            color: #db1472;
        }
        .filters-container {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        .filters-container .form-group {
            margin-bottom: 0; 
            flex-grow: 1;
            min-width: 150px; 
        }
        .summary-section { 
            margin-top: 2rem;
            padding: 1.5rem;
            background-color: #fff1f2; 
            border-radius: 8px;
            border: 1px solid #ffe4e6;
        }
        .summary-section h4 {
            margin-top: 0;
            color: #9d174d;
        }

        /* Página de Despesas Específico */
        .despesas-cards-container {
            display: grid;
            grid-template-columns: 1fr; /* Uma coluna por padrão para mobile */
            gap: 1.5rem;
        }
        @media (min-width: 768px) { /* Duas colunas para tablets e maiores */
            .despesas-cards-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        .card-despesa {
            background-color: #fff1f2; /* Alterado para rosinha claro */
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.07);
        }
        .card-despesa-title {
            color: #db1472;
            font-size: 1.5rem;
            margin-top: 0;
            margin-bottom: 0.75rem;
            border-bottom: 2px solid #f8b81f;
            padding-bottom: 0.5rem;
        }
        .informativo {
            font-size: 0.9rem;
            color: #6b7280;
            margin-bottom: 1.5rem;
            background-color: #fdf2f8;
            padding: 0.75rem;
            border-radius: 4px;
            border-left: 3px solid #f8b81f;
        }
        .card-despesa .form-group { 
             margin-bottom: 1rem;
        }
        .card-despesa .form-actions {
             justify-content: flex-start; 
             margin-top: 1rem;
        }
        .custos-lista {
            list-style: none;
            padding: 0;
            margin-top: 1rem;
            max-height: 200px; 
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
        }
        .custos-lista li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.95rem;
        }
        .custos-lista li:last-child {
            border-bottom: none;
        }
        .custos-lista li .cost-details {
            flex-grow: 1;
        }
        .custos-lista li .cost-name {
            font-weight: 500;
            color: #374151;
        }
        .custos-lista li .cost-value {
            color: #166534; 
            font-weight: 500;
        }
        .custos-lista li .cost-date {
            font-size: 0.8rem;
            color: #6b7280;
            margin-left: 0.5rem;
        }
        .custos-lista li .remove-cost-btn {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            padding: 0.25rem;
            margin-left: 1rem;
        }
        .custos-lista li .remove-cost-btn:hover {
            color: #b91c1c;
        }
        .custo-unitario-display {
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: #f8f0f4; 
            border-radius: 6px;
            border-top: 2px solid #f8b81f;
        }
        .custo-unitario-display p {
            margin-bottom: 0.6rem;
            font-size: 1rem;
            color: #500724;
        }
        .custo-unitario-display p:last-child {
            margin-bottom: 0;
        }
        .custo-unitario-display strong {
            color: #db1472;
            font-size: 1.1rem;
        }
        #total-produtos-estoque-simulado { 
            padding: 0.3rem 0.5rem;
            font-size: 0.9rem;
            border-radius: 4px;
            border: 1px solid #fbcfe8;
        }

        /* --- NOVOS ESTILOS PARA PRODUTOS E VENDAS EM CARDS --- */
        .item-cards-container { /* Container genérico para cards de produto/venda */
            display: grid;
            grid-template-columns: 1fr; /* Uma coluna por padrão (mobile) */
            gap: 1.5rem; /* Espaçamento entre os cards */
            margin-top: 1.5rem;
        }
        @media (min-width: 768px) { /* Duas colunas para tablets e maiores */
            .item-cards-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .product-card, .sale-card { /* Estilo base para cards de produto e venda */
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            padding: 1.2rem;
            display: flex;
            flex-direction: column;
            border-left: 5px solid #f8b81f; /* Destaque dourado */
        }
        .product-card:hover, .sale-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .product-card-image {
            width: 100%;
            max-height: 180px;
            object-fit: cover;
            border-radius: 6px;
            margin-bottom: 1rem;
        }
        .product-card h4, .sale-card h4 {
            font-size: 1.2rem;
            color: #db1472;
            margin-top: 0;
            margin-bottom: 0.5rem;
        }
        .product-card p, .sale-card p {
            font-size: 0.9rem;
            color: #4b5563;
            margin-bottom: 0.3rem;
        }
        .product-card p strong, .sale-card p strong {
            color: #374151;
        }
        .product-card .actions-cell, .sale-card .actions-cell { /* Renomeado para card-actions */
            margin-top: auto; /* Empurra ações para baixo */
            padding-top: 0.75rem;
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }
         .sale-card .status-badge { /* Reutilizando badge de status */
            display: inline-block; /* Para poder aplicar margin se necessário */
            margin-top: 0.5rem;
        }
        /* FIM NOVOS ESTILOS */


        /* Página Liberdade Financeira */
        .dividas-list-container {
            margin-top: 1.5rem;
            display: grid;
            grid-template-columns: 1fr; /* Default para mobile */
            gap: 1rem;
        }
         @media (min-width: 768px) { /* Duas colunas para tablets e maiores */
            .dividas-list-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .divida-card {
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            color: #374151; 
        }
        .prioridade-baixa-bg { background-color: #d1fae5; border-left: 5px solid #10b981;} 
        .prioridade-media-bg { background-color: #fef9c3; border-left: 5px solid #f59e0b;} 
        .prioridade-alta-bg { background-color: #fee2e2; border-left: 5px solid #ef4444;}  

        .divida-card h4 {
            margin-top: 0;
            margin-bottom: 0.5rem;
            color: #db1472;
        }
        .divida-card p {
            margin-bottom: 0.4rem;
            font-size: 0.95rem;
        }
        .divida-card .divida-actions {
            margin-top: 1rem;
            text-align: right;
        }
        .frase-apoio {
            text-align: center;
            font-size: 1.1rem;
            font-weight: 500;
            color: #c01062;
            padding: 1.5rem;
            background-color: #fdf2f8;
            border-radius: 8px;
            margin-top: 2rem;
            border: 1px dashed #fbcfe8;
        }
        #planejamento-quitacao-divida-page .form-container,
        #planejamento-quitacao-divida-page .summary-section { 
            margin-bottom: 1.5rem;
        }
        @media (min-width: 992px) { 
            #planejamento-quitacao-divida-page .planejamento-layout-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 1.5rem;
                align-items: flex-start;
            }
        }
        .progress-bar-container {
            width: 100%;
            background-color: #e2e8f0;
            border-radius: 6px;
            height: 25px;
            margin: 1rem 0;
            overflow: hidden; 
        }
        .progress-bar-fill {
            width: 0%; 
            height: 100%;
            background-color: #f8b81f; 
            border-radius: 6px 0 0 6px; 
            transition: width 0.5s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #5c3c00;
            font-size: 0.85rem;
            font-weight: 600;
        }


    </style>
    <!-- 
        Comentário: Links para Google Fonts (Exemplo: Poppins)
    -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

</head>
<body>
    <div id="app-overlay" class="overlay"></div>

    <aside id="sidebar-nav" class="sidebar-nav">
        <div class="sidebar-nav-header">
            <h2 class="sidebar-title">C4</h2>
            <button class="close-btn" id="close-sidebar-btn" aria-label="Fechar menu">&times;</button>
        </div>
        <div class="sidebar-nav-links">
            <!-- Comentário: Itens de navegação da sidebar -->
            <a href="#dashboard" class="sidebar-nav-item active" data-page="dashboard-page">
                <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                Dashboard
            </a>
            <a href="#produtos" class="sidebar-nav-item" data-page="produtos-page">
                <svg viewBox="0 0 24 24"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>
                Produtos
            </a>
            <a href="#vendas" class="sidebar-nav-item" data-page="vendas-page">
                <svg viewBox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
                Vendas
            </a>
            <a href="#despesas" class="sidebar-nav-item" data-page="despesas-page">
                <svg viewBox="0 0 24 24"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg>
                Despesas
            </a>
            <a href="#liberdade-financeira" class="sidebar-nav-item" data-page="liberdade-financeira-page">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>
                Liberdade Financeira
            </a>
            <a href="#lucro-certo" class="sidebar-nav-item" data-page="lucro-certo-page">
                <svg viewBox="0 0 24 24"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path><path d="M22 12A10 10 0 0 0 12 2v10z"></path></svg>
                Lucro Certo
            </a>
            <a href="#calculadoras" class="sidebar-nav-item" data-page="calculadoras-page">
                <svg viewBox="0 0 24 24"><rect x="4" y="2" width="16" height="20" rx="2" ry="2"></rect><line x1="8" y1="6" x2="16" y2="6"></line><line x1="8" y1="10" x2="16" y2="10"></line><line x1="8" y1="14" x2="16" y2="14"></line><line x1="8" y1="18" x2="16" y2="18"></line></svg>
                Calculadoras
            </a>
            <a href="#metas" class="sidebar-nav-item" data-page="metas-page">
                <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>
                Metas
            </a>
            <a href="#relatorios" class="sidebar-nav-item" data-page="relatorios-page">
                <svg viewBox="0 0 24 24"><line x1="12" y1="20" x2="12" y2="10"></line><line x1="18" y1="20" x2="18" y2="4"></line><line x1="6" y1="20" x2="6" y2="16"></line></svg>
                Relatórios
            </a>
            <a href="#c4-ia" class="sidebar-nav-item" data-page="c4-ia-page">
                <svg viewBox="0 0 24 24"><path d="M12 2a10 10 0 0 0-10 10c0 6 8 10 10 10s10-4 10-10A10 10 0 0 0 12 2z"></path><path d="M12 10a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"></path><path d="M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"></path><path d="M12 18a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"></path></svg>
                C4 IA
            </a>
            <a href="#perfil" class="sidebar-nav-item" data-page="perfil-page"> 
                <svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                Perfil
            </a>
        </div>
    </aside>

    <header class="app-header header-gradient">
        <button class="menu-toggle" id="menu-toggle-btn" aria-label="Abrir menu">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path>
            </svg>
        </button>
        <h1 class="app-header-title">C4</h1> 
        <div><!-- Espaço para ícone de perfil/notificações no futuro --></div>
    </header>

    <main id="app-content">
        <!-- Etapa 2: Dashboard -->
        <section id="dashboard-page" class="page-content active">
            <h2 class="page-title">Dashboard</h2>
            
            <div class="cards-container" id="dashboard-cards-summary">
                <div class="card">
                    <h3 class="card-title">Resumo do Dia</h3>
                    <p class="card-value">R$ 1.250,75</p>
                    <p class="card-description">Total de vendas hoje</p>
                </div>
                <div class="card">
                    <h3 class="card-title">Meta Mensal</h3>
                    <p class="card-value">65%</p>
                    <p class="card-description">Progresso: R$ 6.500 / R$ 10.000</p>
                </div>
                <div class="card">
                    <h3 class="card-title">Lucro Líquido (Mês)</h3>
                    <p class="card-value">R$ 2.800,00</p>
                    <p class="card-description">Após todas as despesas</p>
                </div>
            </div>

            <div class="quick-actions" id="dashboard-quick-actions">
                <button class="btn-action" data-target-page="vendas-page">Nova Venda</button>
                <button class="btn-action" data-target-page="produtos-page">Novo Produto</button>
                <button class="btn-action" data-target-page="calculadoras-page">Calculadoras</button>
            </div>

            <h3 class="page-title" style="margin-top: 2.5rem; font-size: 1.6rem; border-bottom-color: #db1472;">Acompanhamento de Metas</h3>
            <div class="chart-container" id="dashboard-goals-chart">
                <p>Gráfico de Metas aparecerá aqui.</p>
            </div>
        </section>

        <!-- Etapa 3: Produtos -->
        <section id="produtos-page" class="page-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
                <h2 class="page-title" style="margin-bottom: 0;">Produtos</h2>
                <button class="btn btn-primary" id="btn-show-add-product-form">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                    Adicionar Produto
                </button>
            </div>

            <div id="form-cadastro-produto-container" class="form-container" style="display: none;">
                <h3 style="color: #db1472; font-weight: 600; margin-top:0; margin-bottom: 1.5rem;">Cadastrar Novo Produto</h3>
                <form id="form-cadastro-produto">
                    <div class="form-group">
                        <label for="produto-nome">Nome do Produto</label>
                        <input type="text" id="produto-nome" name="produto-nome" required>
                    </div>
                    <div class="form-group">
                        <label for="produto-categoria">Categoria</label>
                        <select id="produto-categoria" name="produto-categoria">
                            <option value="">Selecione uma categoria</option>
                            <option value="bolsas">Bolsas</option>
                            <option value="carteiras">Carteiras</option>
                            <option value="acessorios">Acessórios</option>
                            <option value="vestuario">Vestuário</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="produto-descricao">Descrição</label>
                        <textarea id="produto-descricao" name="produto-descricao"></textarea>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div class="form-group">
                            <label for="produto-valor-custo">Valor de Custo (Compra) (R$)</label>
                            <input type="number" id="produto-valor-custo" name="produto-valor-custo" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="produto-estoque">Quantidade em Estoque</label>
                            <input type="number" id="produto-estoque" name="produto-estoque" step="1" min="0" required>
                        </div>
                    </div>
                    <div class="costs-display-section">
                        <h4>Custos Detalhados por Unidade:</h4>
                        <p>Custo Fixo Unitário (Supabase): <strong id="display-custo-fixo">R$ 0.00</strong></p>
                        <p>Custo Variável Unitário (Supabase): <strong id="display-custo-variavel">R$ 0.00</strong></p>
                        <p>Custo de Frete por Unidade (Supabase): <strong id="display-custo-frete">R$ 0.00</strong></p>
                        <hr style="border: none; border-top: 1px dashed #fbcfe8; margin: 0.75rem 0;">
                        <p style="font-size: 1.1rem;">Custo Total por Unidade (Calculado): <strong id="display-custo-total-unidade" style="font-size: 1.2rem;">R$ 0.00</strong></p>
                    </div>
                    <div class="form-group" style="margin-top: 1.5rem;">
                        <label for="produto-imagem">Imagem do Produto</label>
                        <input type="file" id="produto-imagem" name="produto-imagem" accept="image/*">
                        <img id="produto-imagem-preview" class="image-preview" src="#" alt="Pré-visualização da imagem">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="btn-cancel-add-product">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar Produto</button>
                    </div>
                </form>
            </div>

            <h3 style="color: #db1472; font-weight: 500; margin-top: 2rem;">Lista de Produtos Cadastrados</h3>
            <!-- ATUALIZAÇÃO: Lista de Produtos em Cards -->
            <div class="item-cards-container" id="product-cards-list">
                <!-- Exemplo de Card de Produto 1 -->
                <div class="product-card">
                    <img src="https://placehold.co/300x180/f8b81f/db1472?text=Bolsa+C4" alt="Bolsa Elegance Rosa" class="product-card-image">
                    <h4>Bolsa Elegance Rosa</h4>
                    <p><strong>Categoria:</strong> Bolsas</p>
                    <p><strong>Custo (Compra):</strong> R$ 45,00</p>
                    <p><strong>Estoque:</strong> 15 unidades</p>
                    <p><strong>Custo Total Unit.:</strong> R$ 55,00</p>
                    <div class="actions-cell">
                        <button class="btn btn-sm btn-secondary" title="Editar"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg></button>
                        <button class="btn btn-sm btn-primary" title="Ver Detalhes"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg></button>
                    </div>
                </div>
                <!-- Exemplo de Card de Produto 2 -->
                <div class="product-card">
                    <img src="https://placehold.co/300x180/db1472/f8b81f?text=Carteira+C4" alt="Carteira Glamour Dourada" class="product-card-image">
                    <h4>Carteira Glamour Dourada</h4>
                    <p><strong>Categoria:</strong> Carteiras</p>
                    <p><strong>Custo (Compra):</strong> R$ 25,50</p>
                    <p><strong>Estoque:</strong> 22 unidades</p>
                    <p><strong>Custo Total Unit.:</strong> R$ 32,00</p>
                    <div class="actions-cell">
                        <button class="btn btn-sm btn-secondary" title="Editar"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg></button>
                        <button class="btn btn-sm btn-primary" title="Ver Detalhes"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg></button>
                    </div>
                </div>
                <!-- Comentário: Mais cards de produtos seriam adicionados aqui via JavaScript -->
            </div>
            <p id="no-products-message" style="text-align: center; color: #6b7280; padding: 1rem; display: none;">Nenhum produto cadastrado ainda.</p>
            
            <div id="product-details-container" class="form-container" style="display:none;">
                <h3 style="color: #db1472; font-weight: 600;">Detalhes do Produto</h3>
                <div id="product-details-content"><p>Selecione um produto para ver os detalhes.</p></div>
                 <div class="form-actions" style="justify-content: flex-start; margin-top:1rem;">
                    <button type="button" class="btn btn-secondary" id="btn-close-product-details">Fechar Detalhes</button>
                </div>
            </div>
        </section>

        <!-- Etapa 4: Vendas -->
        <section id="vendas-page" class="page-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
                <h2 class="page-title" style="margin-bottom: 0;">Vendas</h2>
                <button class="btn btn-primary" id="btn-show-nova-venda-form">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                    Nova Venda
                </button>
            </div>

            <div id="form-nova-venda-container" class="form-container" style="display: none;">
                <h3 style="color: #db1472; font-weight: 600; margin-top:0; margin-bottom: 1.5rem;">Registar Nova Venda</h3>
                <form id="form-nova-venda">
                    <div class="form-group">
                        <label for="venda-cliente">Cliente (Opcional)</label>
                        <input type="text" id="venda-cliente" name="venda-cliente" placeholder="Nome do cliente">
                    </div>
                    <fieldset style="border: 1px solid #e2e8f0; border-radius: 6px; padding: 1rem; margin-bottom: 1.5rem;">
                        <legend style="color: #4b5563; font-weight:500; padding: 0 0.5rem;">Adicionar Produtos</legend>
                        <div style="display: flex; gap: 1rem; align-items: flex-end; margin-bottom:1rem;">
                            <div class="form-group" style="flex-grow:3; margin-bottom:0;">
                                <label for="venda-produto-select">Produto</label>
                                <select id="venda-produto-select" name="venda-produto-select">
                                    <option value="">Selecione um produto</option>
                                    <option value="prod1" data-price="129.90" data-stock="15">Bolsa Elegance Rosa (Est: 15)</option>
                                    <option value="prod2" data-price="89.00" data-stock="22">Carteira Glamour Dourada (Est: 22)</option>
                                    <option value="prod3" data-price="49.50" data-stock="10">Cinto Fivela Dourada (Est: 10)</option>
                                </select>
                            </div>
                            <div class="form-group" style="flex-grow:1; margin-bottom:0;">
                                <label for="venda-produto-qtd">Qtd.</label>
                                <input type="number" id="venda-produto-qtd" name="venda-produto-qtd" min="1" value="1" style="width: 70px;">
                            </div>
                            <button type="button" class="btn btn-secondary" id="btn-add-produto-venda" style="padding: 0.7rem;">Adicionar</button>
                        </div>
                        <h4 style="color:#500724; font-weight:500; margin-top:1.5rem; margin-bottom:0.5rem;">Itens da Venda:</h4>
                        <ul id="venda-itens-lista" class="sale-items-list" style="list-style: none; padding:0;">
                             <p id="venda-sem-itens" style="text-align: center; color: #6b7280; padding: 1rem 0;">Nenhum item adicionado à venda.</p>
                        </ul>
                    </fieldset>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div class="form-group">
                            <label for="venda-desconto">Desconto (%)</label>
                            <input type="number" id="venda-desconto" name="venda-desconto" min="0" max="100" value="0">
                        </div>
                        <div class="form-group">
                            <label for="venda-forma-pagamento">Forma de Pagamento</label>
                            <select id="venda-forma-pagamento" name="venda-forma-pagamento" required>
                                <option value="dinheiro">Dinheiro</option><option value="cartao_debito">Cartão de Débito</option>
                                <option value="cartao_credito">Cartão de Crédito</option><option value="pix">PIX</option>
                                <option value="boleto">Boleto</option>
                            </select>
                        </div>
                    </div>
                    <div id="sale-summary">
                        <p>Subtotal: <span id="venda-subtotal">R$ 0,00</span></p>
                        <p>Desconto (<span id="venda-desconto-perc">0</span>%): <span id="venda-valor-desconto">R$ 0,00</span></p>
                        <p class="total">Total a Pagar: <span id="venda-total-pagar">R$ 0,00</span></p>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="btn-cancel-nova-venda">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Finalizar Venda</button>
                    </div>
                </form>
            </div>

            <h3 style="color: #db1472; font-weight: 500; margin-top: 2rem;">Histórico de Vendas</h3>
            <div class="filters-container">
                 <div class="form-group">
                    <label for="filtro-venda-data">Data</label>
                    <input type="date" id="filtro-venda-data" name="filtro-venda-data">
                </div>
                <div class="form-group">
                    <label for="filtro-venda-cliente">Cliente</label>
                    <input type="text" id="filtro-venda-cliente" name="filtro-venda-cliente" placeholder="Nome do cliente">
                </div>
                <div class="form-group">
                    <label for="filtro-venda-status">Status</label>
                     <select id="filtro-venda-status" name="filtro-venda-status">
                        <option value="">Todos</option><option value="pago">Pago</option>
                        <option value="pendente">Pendente</option><option value="cancelado">Cancelado</option>
                    </select>
                </div>
                <button type="button" class="btn btn-secondary" id="btn-aplicar-filtros-venda" style="align-self: flex-end; padding: 0.7rem;">Aplicar Filtros</button>
            </div>
            <!-- ATUALIZAÇÃO: Histórico de Vendas em Cards -->
            <div class="item-cards-container" id="sales-history-cards-list">
                <!-- Exemplo de Card de Venda 1 -->
                <div class="sale-card">
                    <h4>Venda ID: VEN-001</h4>
                    <p><strong>Data:</strong> 04/06/2025</p>
                    <p><strong>Cliente:</strong> Maria Silva</p>
                    <p><strong>Itens:</strong> 2</p>
                    <p><strong>Total:</strong> R$ 218,90</p>
                    <p><strong>Status:</strong> <span class="status-badge status-pago">Pago</span></p>
                    <div class="actions-cell">
                        <button class="btn btn-sm btn-secondary" title="Ver Detalhes"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg></button>
                    </div>
                </div>
                <!-- Exemplo de Card de Venda 2 -->
                <div class="sale-card">
                    <h4>Venda ID: VEN-002</h4>
                    <p><strong>Data:</strong> 03/06/2025</p>
                    <p><strong>Cliente:</strong> Joana Santos</p>
                    <p><strong>Itens:</strong> 1</p>
                    <p><strong>Total:</strong> R$ 49,50</p>
                    <p><strong>Status:</strong> <span class="status-badge status-pendente">Pendente</span></p>
                    <div class="actions-cell">
                         <button class="btn btn-sm btn-secondary" title="Ver Detalhes"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg></button>
                    </div>
                </div>
                <!-- Comentário: Mais cards de vendas seriam adicionados aqui via JavaScript -->
            </div>
             <p id="no-vendas-message" style="text-align: center; color: #6b7280; padding: 1rem; display: none;">Nenhuma venda registada ainda.</p>
        </section>
        
        <!-- Etapa 5: Despesas -->
        <section id="despesas-page" class="page-content">
            <h2 class="page-title">Despesas</h2>
            <div class="despesas-cards-container">
                <div class="card-despesa" id="card-custos-fixos">
                    <h3 class="card-despesa-title">🧾 Custos Fixos</h3>
                    <p class="informativo">Custos fixos são aqueles que você paga todos os meses, independentemente de vender ou não. Ex: aluguel, contador, internet, etc.</p>
                    <form id="form-add-custo-fixo">
                        <div class="form-group">
                            <label for="custo-fixo-nome">Nome do Custo Fixo</label>
                            <input type="text" id="custo-fixo-nome" placeholder="Ex: Aluguel do Ateliê" required>
                        </div>
                        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label for="custo-fixo-valor">Valor Mensal (R$)</label>
                                <input type="number" id="custo-fixo-valor" step="0.01" min="0" placeholder="Ex: 800,00" required>
                            </div>
                            <div class="form-group">
                                <label for="custo-fixo-vencimento">Vencimento</label>
                                <input type="date" id="custo-fixo-vencimento">
                            </div>
                        </div>
                        <div class="form-actions" style="justify-content: flex-start;">
                            <button type="submit" class="btn btn-primary btn-sm">Adicionar Custo Fixo</button>
                        </div>
                    </form>
                    <h4 style="margin-top:1.5rem; color:#500724;">Custos Fixos Cadastrados:</h4>
                    <ul id="lista-custos-fixos" class="custos-lista">
                        <p id="sem-custos-fixos" style="text-align:center; padding:1rem; color:#6b7280;">Nenhum custo fixo adicionado.</p>
                    </ul>
                    <div class="custo-unitario-display">
                        <p>Total Custos Fixos Mensais: <strong id="total-custos-fixos-mensais">R$ 0,00</strong></p>
                        <div class="form-group" style="margin-bottom:0.5rem;">
                            <label for="total-produtos-estoque-simulado" style="font-size:0.9rem; display:inline-block; margin-right:0.5rem;">Total Produtos em Estoque (Simulado):</label>
                            <input type="number" id="total-produtos-estoque-simulado" value="1" min="1" style="width: 80px;">
                        </div>
                        <p><strong>Custo Fixo Unitário:</strong> <strong id="custo-fixo-unitario-display">R$ 0,00</strong></p>
                    </div>
                </div>
                <div class="card-despesa" id="card-custos-variaveis">
                    <h3 class="card-despesa-title">⚙️ Custos Variáveis</h3>
                    <p class="informativo">Custos variáveis são aqueles que você só tem quando realiza uma venda. Ex: embalagem, comissão, taxas, etc.</p>
                     <form id="form-add-custo-variavel">
                        <div class="form-group">
                            <label for="custo-variavel-nome">Nome do Custo Variável</label>
                            <input type="text" id="custo-variavel-nome" placeholder="Ex: Embalagem por produto" required>
                        </div>
                        <div class="form-group">
                            <label for="custo-variavel-valor-unitario">Valor Unitário (R$)</label>
                            <input type="number" id="custo-variavel-valor-unitario" step="0.01" min="0" placeholder="Ex: 2,50" required>
                        </div>
                        <div class="form-actions" style="justify-content: flex-start;">
                            <button type="submit" class="btn btn-primary btn-sm">Adicionar Custo Variável</button>
                        </div>
                    </form>
                    <h4 style="margin-top:1.5rem; color:#500724;">Custos Variáveis Cadastrados:</h4>
                    <ul id="lista-custos-variaveis" class="custos-lista">
                         <p id="sem-custos-variaveis" style="text-align:center; padding:1rem; color:#6b7280;">Nenhum custo variável adicionado.</p>
                    </ul>
                    <div class="custo-unitario-display">
                        <p><strong>Custo Variável Unitário Total:</strong> <strong id="custo-variavel-unitario-total-display">R$ 0,00</strong></p>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- MÓDULO LIBERDADE FINANCEIRA -->
        <section id="liberdade-financeira-page" class="page-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
                <h2 class="page-title" style="margin-bottom: 0;">Liberdade Financeira</h2>
                <button class="btn btn-primary" id="btn-show-add-divida-form">
                     <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                    Adicionar Dívida
                </button>
            </div>

            <!-- Container do Formulário de Nova Dívida (inicialmente oculto) -->
            <div id="form-add-divida-container" class="form-container" style="display: none;">
                <h3 style="color: #db1472; font-weight: 600; margin-top:0; margin-bottom: 1.5rem;">Cadastrar Nova Dívida</h3>
                <form id="form-add-divida">
                    <div class="form-group">
                        <label for="divida-nome">Nome da Dívida</label>
                        <input type="text" id="divida-nome" name="divida-nome" placeholder="Ex: Cartão de Crédito Loja X" required>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div class="form-group">
                            <label for="divida-valor-total">Valor Total da Dívida (R$)</label>
                            <input type="number" id="divida-valor-total" name="divida-valor-total" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="divida-tipo">Tipo de Dívida</label>
                            <select id="divida-tipo" name="divida-tipo" required>
                                <option value="">Selecione o tipo</option>
                                <option value="emprestimo">Empréstimo Pessoal</option>
                                <option value="cartao">Cartão de Crédito</option>
                                <option value="boleto">Boleto/Carnê</option>
                                <option value="financiamento_veiculo">Financiamento de Veículo</option>
                                <option value="financiamento_imovel">Financiamento de Imóvel</option>
                                <option value="outros">Outros</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <input type="checkbox" id="divida-e-parcelada" name="divida-e-parcelada" style="margin-right: 5px;">
                        <label for="divida-e-parcelada" style="font-weight:normal; display:inline;">Esta dívida é parcelada?</label>
                    </div>
                    <div id="divida-parcelas-detalhes" style="display: none; background-color: #fdf2f8; padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
                         <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                            <div class="form-group">
                                <label for="divida-num-parcelas">Número de Parcelas</label>
                                <input type="number" id="divida-num-parcelas" name="divida-num-parcelas" min="1">
                            </div>
                            <div class="form-group">
                                <label for="divida-valor-parcela">Valor de Cada Parcela (R$)</label>
                                <input type="number" id="divida-valor-parcela" name="divida-valor-parcela" step="0.01" min="0">
                            </div>
                        </div>
                    </div>
                     <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div class="form-group">
                            <label for="divida-data-vencimento">Data de Vencimento (Próxima/Única)</label>
                            <input type="date" id="divida-data-vencimento" name="divida-data-vencimento" required>
                        </div>
                        <div class="form-group">
                            <label for="divida-prioridade">Grau de Prioridade</label>
                            <select id="divida-prioridade" name="divida-prioridade" required>
                                <option value="baixa">Baixa</option>
                                <option value="media" selected>Média</option>
                                <option value="alta">Alta</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="divida-observacoes">Observações</label>
                        <textarea id="divida-observacoes" name="divida-observacoes" placeholder="Ex: Juros altos, tentar renegociar..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="btn-cancel-add-divida">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar Dívida</button>
                    </div>
                </form>
            </div>

            <!-- Lista de Dívidas -->
            <h3 style="color: #db1472; font-weight: 500; margin-top: 2rem;">Minhas Dívidas</h3>
            <div class="filters-container" style="margin-bottom: 1rem;">
                <label for="ordenar-dividas" style="align-self:center; margin-right:0.5rem; font-weight:500; color:#4b5563;">Ordenar por:</label>
                <select id="ordenar-dividas" class="form-group" style="padding:0.5rem; min-width: 180px;">
                    <option value="prioridade">Prioridade (Alta > Baixa)</option>
                    <option value="vencimento">Data de Vencimento (Mais próxima)</option>
                    <option value="valor_restante_desc">Valor Restante (Maior > Menor)</option>
                    <option value="valor_restante_asc">Valor Restante (Menor > Maior)</option>
                </select>
            </div>
            <div id="lista-dividas-container" class="dividas-list-container">
                <!-- Dívidas serão listadas aqui via JS -->
                 <p id="sem-dividas-message" style="text-align: center; color: #6b7280; padding: 1rem;">Nenhuma dívida cadastrada ainda. Respire fundo, você está no caminho certo!</p>
            </div>
            
            <div class="frase-apoio" style="margin-top:2rem;">
                <p id="frase-apoio-liberdade">Você está a <strong id="passos-liberdade">X</strong> passos da sua liberdade financeira!</p>
            </div>
        </section>

        <!-- Nova Página/Secção: Planejamento de Quitação de Dívida -->
        <section id="planejamento-quitacao-divida-page" class="page-content">
            <button class="btn btn-secondary" id="btn-voltar-para-dividas" style="margin-bottom: 1.5rem;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                Voltar para Minhas Dívidas
            </button>
            <h2 class="page-title" id="titulo-planejamento-divida">Planejar Quitação: <span style="color:#c01062;">Nome da Dívida</span></h2>

            <div class="planejamento-layout-grid">
                <div class="form-container">
                    <h3 class="sub-page-title">💰 Defina sua Estratégia</h3>
                    <p>Dívida Selecionada: <strong id="planejamento-nome-divida-display">N/A</strong></p>
                    <p>Valor Total: <strong id="planejamento-valor-total-display">R$ 0,00</strong></p>
                    <div class="form-group">
                        <label for="planejamento-poupanca">Quanto você pode poupar?</label>
                        <input type="number" id="planejamento-poupanca" step="0.01" min="0.01" value="50">
                    </div>
                    <div class="form-group">
                        <label for="planejamento-periodo">Com qual frequência?</label>
                        <select id="planejamento-periodo">
                            <option value="dia">por Dia</option>
                            <option value="semana">por Semana</option>
                            <option value="quinzena" selected>por Quinzena</option>
                            <option value="mes">por Mês</option>
                        </select>
                    </div>
                     <div class="form-group">
                        <label for="planejamento-valor-ja-pago">Valor já pago/disponível para esta dívida (R$):</label>
                        <input type="number" id="planejamento-valor-ja-pago" step="0.01" min="0" value="0">
                    </div>
                    <div class="form-actions" style="justify-content: flex-start;">
                        <button class="btn btn-primary" id="btn-calcular-quitacao">Calcular Tempo de Quitação</button>
                    </div>
                    <p id="resultado-calculo-quitacao" style="font-weight:600; color:#166534; margin-top:1rem;"></p>
                </div>

                <div class="form-container" style="background-color: #fdf2f8;">
                    <h3 class="sub-page-title">🎯 Sua Meta de Quitação</h3>
                    <p>Dívida: <strong id="meta-nome-divida-display">N/A</strong></p>
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill" id="quitacao-progress-bar" style="width: 0%;">0%</div>
                    </div>
                    <p>Total da Dívida: <strong id="meta-total-divida-display">R$ 0,00</strong></p>
                    <p>Valor Já Pago/Guardado: <strong id="meta-valor-pago-display">R$ 0,00</strong></p>
                    <p>Falta para Quitar: <strong id="meta-falta-quitar-display">R$ 0,00</strong></p>
                    <div class="form-actions" style="justify-content: center;">
                         <button class="btn btn-primary" id="btn-criar-meta-quitacao-real">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:8px;"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg>
                            Criar Meta no App
                        </button>
                    </div>
                </div>
            </div>

             <div class="planejamento-layout-grid" style="margin-top:1.5rem;">
                 <div class="summary-section" id="sugestoes-vendas-quitacao">
                    <h3 class="sub-page-title">💡 Ideias para Acelerar</h3>
                    <p>Você precisaria vender aproximadamente:</p>
                    <ul id="lista-sugestoes-vendas-quitacao" style="list-style-type: disclosure-closed; padding-left: 20px;">
                        <li><em>(Sugestões de vendas aparecerão aqui)</em></li>
                    </ul>
                </div>
                <div class="summary-section" id="sugestoes-economia-quitacao">
                    <h3 class="sub-page-title">💰 Dica de Economia</h3>
                     <p id="dica-economia-quitacao"><em>(Dica de economia aparecerá aqui)</em></p>
                </div>
            </div>
        </section>


        <section id="lucro-certo-page" class="page-content">
            <h2 class="page-title">Lucro Certo</h2>
            <p>Análise, projeções, alertas e recomendações.</p>
        </section>
        <section id="calculadoras-page" class="page-content">
            <h2 class="page-title">Calculadoras</h2>
            <p>Frete, margem, preço de venda, custo por unidade, metas.</p>
        </section>
        <section id="metas-page" class="page-content">
            <h2 class="page-title">Metas</h2>
            <p>Definição, acompanhamento, histórico.</p>
        </section>
        <section id="relatorios-page" class="page-content">
            <h2 class="page-title">Relatórios</h2>
            <p>Vendas, lucratividade, despesas.</p>
        </section>
        <section id="c4-ia-page" class="page-content">
            <h2 class="page-title">C4 IA</h2>
            <p>Assistente virtual para dúvidas, sugestões e alertas.</p>
        </section>
        <section id="perfil-page" class="page-content"> 
            <h2 class="page-title">Perfil</h2>
            <p>Dados do usuário, preferências, configurações e dados da empresa.</p>
        </section>
    </main>

    <footer class="app-footer">
        <p>&copy; <span id="current-year"></span> C4. Todos os direitos reservados.</p>
    </footer>

    <script defer>
        document.addEventListener('DOMContentLoaded', () => {
            const menuToggleBtn = document.getElementById('menu-toggle-btn');
            const closeSidebarBtn = document.getElementById('close-sidebar-btn');
            const sidebarNav = document.getElementById('sidebar-nav');
            const appOverlay = document.getElementById('app-overlay');
            const body = document.body;

            const sidebarNavItems = document.querySelectorAll('.sidebar-nav-item');
            const pageContents = document.querySelectorAll('.page-content');
            const currentYearSpan = document.getElementById('current-year');

            // --- Seletores Globais de Formulários (para reset ao mudar de página) ---
            const formCadastroProdutoContainer = document.getElementById('form-cadastro-produto-container');
            const formCadastroProduto = document.getElementById('form-cadastro-produto');
            const produtoImagemPreview = document.getElementById('produto-imagem-preview');
            const productDetailsContainer = document.getElementById('product-details-container');
            const btnShowAddProductForm = document.getElementById('btn-show-add-product-form');
            
            const formNovaVendaContainer = document.getElementById('form-nova-venda-container');
            const formNovaVenda = document.getElementById('form-nova-venda');
            const vendaItensLista = document.getElementById('venda-itens-lista');
            const btnShowNovaVendaForm = document.getElementById('btn-show-nova-venda-form');
            let itensVenda = []; 

            const formAddCustoFixo = document.getElementById('form-add-custo-fixo');
            const listaCustosFixosEl = document.getElementById('lista-custos-fixos');
            const totalCustosFixosMensaisEl = document.getElementById('total-custos-fixos-mensais');
            const totalProdutosEstoqueSimuladoInput = document.getElementById('total-produtos-estoque-simulado');
            const custoFixoUnitarioDisplayEl = document.getElementById('custo-fixo-unitario-display');
            let custosFixos = [];

            const formAddCustoVariavel = document.getElementById('form-add-custo-variavel');
            const listaCustosVariaveisEl = document.getElementById('lista-custos-variaveis');
            const custoVariavelUnitarioTotalDisplayEl = document.getElementById('custo-variavel-unitario-total-display');
            let custosVariaveis = [];

            // Seletores da Página Liberdade Financeira
            const btnShowAddDividaForm = document.getElementById('btn-show-add-divida-form');
            const formAddDividaContainer = document.getElementById('form-add-divida-container');
            const formAddDivida = document.getElementById('form-add-divida');
            const dividaEParceladaCheckbox = document.getElementById('divida-e-parcelada');
            const dividaParcelasDetalhesDiv = document.getElementById('divida-parcelas-detalhes');
            const listaDividasContainerEl = document.getElementById('lista-dividas-container');
            let dividasCadastradas = []; 
            const planejamentoQuitacaoDividaPage = document.getElementById('planejamento-quitacao-divida-page');
            const btnVoltarParaDividas = document.getElementById('btn-voltar-para-dividas');
            let dividaAtualParaPlanejamento = null; // Guarda a dívida selecionada

            const btnCriarMetaQuitacaoReal = document.getElementById('btn-criar-meta-quitacao-real');


            if (currentYearSpan) {
                currentYearSpan.textContent = new Date().getFullYear();
            }

            function openSidebar() {
                sidebarNav.classList.add('open');
                appOverlay.classList.add('active');
                body.classList.add('sidebar-open');
            }

            function closeSidebar() {
                sidebarNav.classList.remove('open');
                appOverlay.classList.remove('active');
                body.classList.remove('sidebar-open');
            }

            if (menuToggleBtn) menuToggleBtn.addEventListener('click', openSidebar);
            if (closeSidebarBtn) closeSidebarBtn.addEventListener('click', closeSidebar);
            if (appOverlay) appOverlay.addEventListener('click', closeSidebar); 
            
            function setActivePage(pageId, data) { 
                pageContents.forEach(page => page.classList.remove('active'));
                sidebarNavItems.forEach(nav => nav.classList.remove('active'));

                const targetPage = document.getElementById(pageId);
                const targetNavItem = document.querySelector(`.sidebar-nav-item[data-page="${pageId}"]`);

                if (targetPage) {
                    targetPage.classList.add('active');
                    if (pageId === 'planejamento-quitacao-divida-page' && data) {
                        preencherPaginaPlanejamentoQuitacao(data);
                    }
                } else {
                    console.warn(`Página com id '${pageId}' não encontrada. Redirecionando para Dashboard.`);
                    const dashboardPage = document.getElementById('dashboard-page');
                    const dashboardNavItem = document.querySelector(`.sidebar-nav-item[data-page="dashboard-page"]`);
                    if (dashboardPage) dashboardPage.classList.add('active');
                    if (dashboardNavItem) dashboardNavItem.classList.add('active');
                }
                if (targetNavItem) targetNavItem.classList.add('active');
                
                if (pageId !== 'produtos-page') {
                    if (formCadastroProdutoContainer) formCadastroProdutoContainer.style.display = 'none';
                    if (formCadastroProduto) formCadastroProduto.reset();
                    if (produtoImagemPreview) produtoImagemPreview.style.display = 'none';
                    if (btnShowAddProductForm) btnShowAddProductForm.style.display = 'inline-flex';
                    if (productDetailsContainer) productDetailsContainer.style.display = 'none';
                }
                if (pageId !== 'vendas-page') {
                    if (formNovaVendaContainer) formNovaVendaContainer.style.display = 'none';
                    if (formNovaVenda) formNovaVenda.reset();
                    if (vendaItensLista) vendaItensLista.innerHTML = '<p id="venda-sem-itens" style="text-align: center; color: #6b7280; padding: 1rem 0;">Nenhum item adicionado à venda.</p>';
                    itensVenda = [];
                    if (typeof atualizarResumoVenda === "function") atualizarResumoVenda();
                    if (btnShowNovaVendaForm) btnShowNovaVendaForm.style.display = 'inline-flex';
                }
                if (pageId !== 'despesas-page') { 
                    if(formAddCustoFixo) formAddCustoFixo.reset();
                    if(formAddCustoVariavel) formAddCustoVariavel.reset();
                } else { 
                     if(typeof exibirCustosFixos === "function") exibirCustosFixos();
                     if(typeof exibirCustosVariaveis === "function") exibirCustosVariaveis();
                }
                 if (pageId !== 'liberdade-financeira-page' && pageId !== 'planejamento-quitacao-divida-page') {
                    if(formAddDividaContainer) formAddDividaContainer.style.display = 'none';
                    if(formAddDivida) formAddDivida.reset();
                    if(dividaParcelasDetalhesDiv) dividaParcelasDetalhesDiv.style.display = 'none';
                    if(btnShowAddDividaForm) btnShowAddDividaForm.style.display = 'inline-flex';
                }
                 if (pageId === 'liberdade-financeira-page') { 
                    if(planejamentoQuitacaoDividaPage) planejamentoQuitacaoDividaPage.classList.remove('active'); 
                    if(typeof exibirDividas === "function") exibirDividas();
                }
            }

            sidebarNavItems.forEach(item => {
                item.addEventListener('click', () => {
                    setActivePage(item.dataset.page);
                    closeSidebar(); 
                });
            });
            
            const quickActionButtons = document.querySelectorAll('.btn-action[data-target-page]');
            quickActionButtons.forEach(button => {
                button.addEventListener('click', () => setActivePage(button.dataset.targetPage));
            });
            
            // --- Lógica da Página de Produtos ---
            const btnCancelAddProduct = document.getElementById('btn-cancel-add-product');
            const produtoImagemInput = document.getElementById('produto-imagem');
            const btnCloseProductDetails = document.getElementById('btn-close-product-details');
            const produtoValorCustoInput = document.getElementById('produto-valor-custo');
            const displayCustoFixo = document.getElementById('display-custo-fixo');
            const displayCustoVariavel = document.getElementById('display-custo-variavel');
            const displayCustoFrete = document.getElementById('display-custo-frete');
            const displayCustoTotalUnidade = document.getElementById('display-custo-total-unidade');

            function simularCalculoCustoTotal() {
                if (!produtoValorCustoInput && !displayCustoTotalUnidade) return; 
                const valorCustoCompra = parseFloat(produtoValorCustoInput?.value) || 0;
                const custoFixoSimulado = parseFloat(custoFixoUnitarioDisplayEl?.textContent.replace('R$ ', '').replace(',', '.')) || 0; 
                const custoVariavelSimulado = parseFloat(custoVariavelUnitarioTotalDisplayEl?.textContent.replace('R$ ', '').replace(',', '.')) || 0; 
                const custoFreteSimulado = 0.80; 
                
                if(displayCustoFixo) displayCustoFixo.textContent = `R$ ${custoFixoSimulado.toFixed(2)}`; 
                if(displayCustoVariavel) displayCustoVariavel.textContent = `R$ ${custoVariavelSimulado.toFixed(2)}`; 
                if(displayCustoFrete) displayCustoFrete.textContent = `R$ ${custoFreteSimulado.toFixed(2)}`;
                
                const custoTotal = valorCustoCompra + custoFixoSimulado + custoVariavelSimulado + custoFreteSimulado;
                if(displayCustoTotalUnidade) displayCustoTotalUnidade.textContent = `R$ ${custoTotal.toFixed(2)}`;
            }
            if(produtoValorCustoInput) produtoValorCustoInput.addEventListener('input', simularCalculoCustoTotal);
            if (btnShowAddProductForm && formCadastroProdutoContainer) {
                btnShowAddProductForm.addEventListener('click', () => {
                    formCadastroProdutoContainer.style.display = 'block';
                    btnShowAddProductForm.style.display = 'none'; 
                    if(productDetailsContainer) productDetailsContainer.style.display = 'none'; 
                    if(formCadastroProduto) formCadastroProduto.reset(); 
                    if(produtoImagemPreview) produtoImagemPreview.style.display = 'none';
                    simularCalculoCustoTotal(); 
                });
            }
            if (btnCancelAddProduct && formCadastroProdutoContainer && btnShowAddProductForm) {
                btnCancelAddProduct.addEventListener('click', () => {
                    formCadastroProdutoContainer.style.display = 'none';
                    if(formCadastroProduto) formCadastroProduto.reset(); 
                    if(produtoImagemPreview) produtoImagemPreview.style.display = 'none'; 
                    btnShowAddProductForm.style.display = 'inline-flex'; 
                });
            }
            if (formCadastroProduto) {
                formCadastroProduto.addEventListener('submit', event => {
                    event.preventDefault();
                    const nomeProdutoEl = document.getElementById('produto-nome');
                    alert(`Produto "${nomeProdutoEl ? nomeProdutoEl.value : ''}" salvo! (Simulação)`); 
                    formCadastroProduto.reset();
                    if(produtoImagemPreview) produtoImagemPreview.style.display = 'none';
                    formCadastroProdutoContainer.style.display = 'none';
                    if(btnShowAddProductForm) btnShowAddProductForm.style.display = 'inline-flex';
                });
            }
            if (produtoImagemInput && produtoImagemPreview) {
                produtoImagemInput.addEventListener('change', function() {
                    if (this.files && this.files[0]) {
                        const reader = new FileReader();
                        reader.onload = e => {
                            produtoImagemPreview.src = e.target.result;
                            produtoImagemPreview.style.display = 'block';
                        }
                        reader.readAsDataURL(this.files[0]);
                    } else {
                        produtoImagemPreview.style.display = 'none';
                        produtoImagemPreview.src = '#';
                    }
                });
            }
            document.querySelectorAll('#table-produtos .btn-primary[title="Ver Detalhes"], #product-cards-list .btn-primary[title="Ver Detalhes"]').forEach(button => {
                 button.addEventListener('click', () => {
                    if (productDetailsContainer) {
                        // Lógica para obter dados do card ou da linha da tabela clicada
                        let productName, productCategory, productCost, productStock, productTotalCost, productImageSrc;
                        const card = button.closest('.product-card');
                        if (card) {
                            productName = card.querySelector('h4').textContent;
                            productCategory = card.querySelector('p:nth-of-type(1) strong').nextSibling.textContent.trim();
                            productCost = card.querySelector('p:nth-of-type(2) strong').nextSibling.textContent.trim();
                            productStock = card.querySelector('p:nth-of-type(3) strong').nextSibling.textContent.trim();
                            productTotalCost = card.querySelector('p:nth-of-type(4) strong').nextSibling.textContent.trim();
                            productImageSrc = card.querySelector('.product-card-image').src;
                        } else { // Fallback para tabela se ainda existir (embora a ideia seja remover)
                            const row = button.closest('tr');
                            productName = row.querySelector('td:nth-child(2)').textContent;
                            // ... buscar outros dados da linha da tabela
                        }

                        const productDetailsContentEl = document.getElementById('product-details-content');
                        if(productDetailsContentEl) {
                             productDetailsContentEl.innerHTML = `
                                <div style="display:flex; gap: 1.5rem; flex-wrap:wrap;">
                                    <img src="${productImageSrc || 'https://placehold.co/120x120/f8b81f/db1472?text=C4'}" alt="${productName}" style="width:120px; height:120px; border-radius:8px; object-fit:cover;">
                                    <div>
                                        <p><strong>Nome:</strong> ${productName}</p>
                                        <p><strong>Categoria:</strong> ${productCategory}</p>
                                        <p><strong>Valor de Custo (Compra):</strong> ${productCost}</p>
                                        <p><strong>Estoque:</strong> ${productStock}</p>
                                        <p><strong>Custo Total Unitário:</strong> ${productTotalCost}</p>
                                    </div>
                                </div>
                                <hr style="margin: 1rem 0;">
                                <p><em>Seção de Histórico e outras informações do produto apareceriam aqui.</em></p>
                            `;
                        }
                        productDetailsContainer.style.display = 'block';
                        if (formCadastroProdutoContainer) formCadastroProdutoContainer.style.display = 'none';
                        if (btnShowAddProductForm) btnShowAddProductForm.style.display = 'inline-flex';
                    }
                });
            });
            if(btnCloseProductDetails && productDetailsContainer) {
                btnCloseProductDetails.addEventListener('click', () => productDetailsContainer.style.display = 'none');
            }
            
            // --- Lógica da Página de Vendas ---
            const btnCancelNovaVenda = document.getElementById('btn-cancel-nova-venda');
            const vendaProdutoSelect = document.getElementById('venda-produto-select');
            const vendaProdutoQtdInput = document.getElementById('venda-produto-qtd');
            const btnAddProdutoVenda = document.getElementById('btn-add-produto-venda');
            const vendaDescontoInput = document.getElementById('venda-desconto');
            const vendaSubtotalEl = document.getElementById('venda-subtotal');
            const vendaDescontoPercEl = document.getElementById('venda-desconto-perc');
            const vendaValorDescontoEl = document.getElementById('venda-valor-desconto');
            const vendaTotalPagarEl = document.getElementById('venda-total-pagar');

            function exibirItensVenda() { 
                if(!vendaItensLista) return;
                vendaItensLista.innerHTML = ''; 
                if (itensVenda.length === 0) {
                    vendaItensLista.innerHTML = '<p id="venda-sem-itens" style="text-align: center; color: #6b7280; padding: 1rem 0;">Nenhum item adicionado à venda.</p>';
                } else {
                    itensVenda.forEach((item, index) => {
                        const li = document.createElement('li');
                        li.innerHTML = `
                            <div class="sale-item-details">
                                <strong>${item.nome}</strong> (${item.qtd} x R$ ${item.preco.toFixed(2)})
                            </div>
                            <span>R$ ${item.subtotal.toFixed(2)}</span>
                            <button type="button" class="sale-item-remove" data-index="${index}" title="Remover item">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                            </button>
                        `;
                        vendaItensLista.appendChild(li);
                    });
                }
                atualizarResumoVenda();
            }
            function atualizarResumoVenda() { 
                if(!vendaDescontoInput || !vendaSubtotalEl || !vendaDescontoPercEl || !vendaValorDescontoEl || !vendaTotalPagarEl) return;
                let subtotal = 0;
                itensVenda.forEach(item => subtotal += item.subtotal);
                const descontoPerc = parseFloat(vendaDescontoInput.value) || 0;
                const valorDesconto = (subtotal * descontoPerc) / 100;
                const totalPagar = subtotal - valorDesconto;
                vendaSubtotalEl.textContent = `R$ ${subtotal.toFixed(2)}`;
                vendaDescontoPercEl.textContent = descontoPerc;
                vendaValorDescontoEl.textContent = `R$ ${valorDesconto.toFixed(2)}`;
                vendaTotalPagarEl.textContent = `R$ ${totalPagar.toFixed(2)}`;
            }
            if (btnShowNovaVendaForm && formNovaVendaContainer) {
                btnShowNovaVendaForm.addEventListener('click', () => {
                    formNovaVendaContainer.style.display = 'block';
                    btnShowNovaVendaForm.style.display = 'none';
                    if(formNovaVenda) formNovaVenda.reset(); 
                    itensVenda = []; 
                    exibirItensVenda(); 
                    atualizarResumoVenda(); 
                });
            }
            if (btnCancelNovaVenda && formNovaVendaContainer && btnShowNovaVendaForm) {
                btnCancelNovaVenda.addEventListener('click', () => {
                    formNovaVendaContainer.style.display = 'none';
                    if(formNovaVenda) formNovaVenda.reset();
                    itensVenda = [];
                    exibirItensVenda();
                    btnShowNovaVendaForm.style.display = 'inline-flex';
                });
            }
            if (btnAddProdutoVenda && vendaProdutoSelect && vendaProdutoQtdInput) {
                btnAddProdutoVenda.addEventListener('click', () => { 
                    const selectedOption = vendaProdutoSelect.options[vendaProdutoSelect.selectedIndex];
                    const produtoId = selectedOption.value;
                    if (!produtoId) { alert('Selecione um produto.'); return; }
                    const produtoNome = selectedOption.text.split(' (Est:')[0]; 
                    const produtoPreco = parseFloat(selectedOption.dataset.price);
                    const quantidade = parseInt(vendaProdutoQtdInput.value);
                    if (isNaN(quantidade) || quantidade <= 0) { alert('Insira uma quantidade válida.'); return; }
                    
                    const itemExistente = itensVenda.find(item => item.id === produtoId);
                    if (itemExistente) {
                        itemExistente.qtd += quantidade;
                        itemExistente.subtotal = itemExistente.qtd * itemExistente.preco;
                    } else {
                        itensVenda.push({ id: produtoId, nome: produtoNome, qtd: quantidade, preco: produtoPreco, subtotal: quantidade * produtoPreco });
                    }
                    exibirItensVenda();
                    vendaProdutoQtdInput.value = 1; 
                    vendaProdutoSelect.value = ""; 
                });
            }
            if(vendaItensLista) {
                vendaItensLista.addEventListener('click', event => { 
                    if (event.target.closest('.sale-item-remove')) {
                        const itemIndex = parseInt(event.target.closest('.sale-item-remove').dataset.index);
                        itensVenda.splice(itemIndex, 1); 
                        exibirItensVenda(); 
                    }
                });
            }
            if (vendaDescontoInput) vendaDescontoInput.addEventListener('input', atualizarResumoVenda);
            if (formNovaVenda) {
                formNovaVenda.addEventListener('submit', event => { 
                    event.preventDefault();
                    if (itensVenda.length === 0) { alert('Adicione produtos à venda.'); return; }
                    const clienteEl = document.getElementById('venda-cliente');
                    alert(`Venda para ${clienteEl ? clienteEl.value || 'Não informado' : 'Não informado'} finalizada! Total: ${vendaTotalPagarEl ? vendaTotalPagarEl.textContent : 'R$0,00'}. (Simulação)`);
                    formNovaVenda.reset();
                    itensVenda = [];
                    exibirItensVenda();
                    if(formNovaVendaContainer) formNovaVendaContainer.style.display = 'none';
                    if(btnShowNovaVendaForm) btnShowNovaVendaForm.style.display = 'inline-flex';
                });
            }

            // --- Lógica Específica da Página de Despesas (Nova Estrutura) ---
            function calcularCustosFixos() {
                if(!totalCustosFixosMensaisEl || !totalProdutosEstoqueSimuladoInput || !custoFixoUnitarioDisplayEl) return;
                let totalFixos = 0;
                custosFixos.forEach(custo => totalFixos += custo.valor);
                totalCustosFixosMensaisEl.textContent = `R$ ${totalFixos.toFixed(2)}`;

                const totalProdutosEstoque = parseInt(totalProdutosEstoqueSimuladoInput.value) || 1; 
                const custoUnitarioFixo = totalProdutosEstoque > 0 ? totalFixos / totalProdutosEstoque : 0;
                custoFixoUnitarioDisplayEl.textContent = `R$ ${custoUnitarioFixo.toFixed(2)}`;
                if(typeof simularCalculoCustoTotal === "function") simularCalculoCustoTotal(); 
            }

            function exibirCustosFixos() {
                if (!listaCustosFixosEl) return;
                listaCustosFixosEl.innerHTML = '';
                const semCustosFixosMsg = document.getElementById('sem-custos-fixos');

                if (custosFixos.length === 0) {
                    if(semCustosFixosMsg) semCustosFixosMsg.style.display = 'block';
                } else {
                    if(semCustosFixosMsg) semCustosFixosMsg.style.display = 'none';
                    custosFixos.forEach((custo, index) => {
                        const li = document.createElement('li');
                        li.innerHTML = `
                            <div class="cost-details">
                                <span class="cost-name">${custo.nome}</span> - 
                                <span class="cost-value">R$ ${custo.valor.toFixed(2)}</span>
                                ${custo.vencimento ? `<span class="cost-date">(Vence: ${new Date(custo.vencimento + 'T00:00:00').toLocaleDateString('pt-BR')})</span>` : ''}
                            </div>
                            <button type="button" class="remove-cost-btn" data-index="${index}" data-type="fixo" title="Remover Custo Fixo">&times;</button>
                        `;
                        listaCustosFixosEl.appendChild(li);
                    });
                }
                calcularCustosFixos();
            }

            if (formAddCustoFixo) {
                formAddCustoFixo.addEventListener('submit', (event) => {
                    event.preventDefault();
                    const nomeInput = document.getElementById('custo-fixo-nome');
                    const valorInput = document.getElementById('custo-fixo-valor');
                    const vencimentoInput = document.getElementById('custo-fixo-vencimento');

                    const nome = nomeInput.value.trim();
                    const valor = parseFloat(valorInput.value);
                    const vencimento = vencimentoInput.value;

                    if (nome && !isNaN(valor) && valor > 0) {
                        custosFixos.push({ nome, valor, vencimento });
                        exibirCustosFixos();
                        formAddCustoFixo.reset();
                    } else {
                        alert('Por favor, preencha o nome e um valor válido para o custo fixo.');
                    }
                });
            }
            
            if(totalProdutosEstoqueSimuladoInput) {
                totalProdutosEstoqueSimuladoInput.addEventListener('input', calcularCustosFixos);
            }


            function calcularCustosVariaveis() {
                 if(!custoVariavelUnitarioTotalDisplayEl) return;
                let totalVariaveisUnitario = 0;
                custosVariaveis.forEach(custo => totalVariaveisUnitario += custo.valorUnitario);
                custoVariavelUnitarioTotalDisplayEl.textContent = `R$ ${totalVariaveisUnitario.toFixed(2)}`;
                if(typeof simularCalculoCustoTotal === "function") simularCalculoCustoTotal(); 
            }

            function exibirCustosVariaveis() {
                if (!listaCustosVariaveisEl) return;
                listaCustosVariaveisEl.innerHTML = '';
                 const semCustosVariaveisMsg = document.getElementById('sem-custos-variaveis');

                if (custosVariaveis.length === 0) {
                    if(semCustosVariaveisMsg) semCustosVariaveisMsg.style.display = 'block';
                } else {
                    if(semCustosVariaveisMsg) semCustosVariaveisMsg.style.display = 'none';
                    custosVariaveis.forEach((custo, index) => {
                        const li = document.createElement('li');
                        li.innerHTML = `
                            <div class="cost-details">
                                <span class="cost-name">${custo.nome}</span> - 
                                <span class="cost-value">R$ ${custo.valorUnitario.toFixed(2)}</span>
                            </div>
                            <button type="button" class="remove-cost-btn" data-index="${index}" data-type="variavel" title="Remover Custo Variável">&times;</button>
                        `;
                        listaCustosVariaveisEl.appendChild(li);
                    });
                }
                calcularCustosVariaveis();
            }

            if (formAddCustoVariavel) {
                formAddCustoVariavel.addEventListener('submit', (event) => {
                    event.preventDefault();
                    const nomeInput = document.getElementById('custo-variavel-nome');
                    const valorUnitarioInput = document.getElementById('custo-variavel-valor-unitario');
                    
                    const nome = nomeInput.value.trim();
                    const valorUnitario = parseFloat(valorUnitarioInput.value);

                    if (nome && !isNaN(valorUnitario) && valorUnitario > 0) {
                        custosVariaveis.push({ nome, valorUnitario });
                        exibirCustosVariaveis();
                        formAddCustoVariavel.reset();
                    } else {
                        alert('Por favor, preencha o nome e um valor unitário válido para o custo variável.');
                    }
                });
            }

            const despesasPageEl = document.getElementById('despesas-page');
            if(despesasPageEl){
                despesasPageEl.addEventListener('click', (event) => {
                    const target = event.target.closest('.remove-cost-btn');
                    if (target) {
                        const index = parseInt(target.dataset.index);
                        const type = target.dataset.type;
                        if (type === 'fixo' && index >= 0 && index < custosFixos.length) {
                            custosFixos.splice(index, 1);
                            exibirCustosFixos();
                        } else if (type === 'variavel' && index >= 0 && index < custosVariaveis.length) {
                            custosVariaveis.splice(index, 1);
                            exibirCustosVariaveis();
                        }
                    }
                });
            }

            // --- Início Lógica da Página Liberdade Financeira ---
            if(btnShowAddDividaForm && formAddDividaContainer){
                btnShowAddDividaForm.addEventListener('click', () => {
                    formAddDividaContainer.style.display = 'block';
                    btnShowAddDividaForm.style.display = 'none';
                    if(formAddDivida) formAddDivida.reset();
                    if(dividaParcelasDetalhesDiv) dividaParcelasDetalhesDiv.style.display = 'none';
                    if(planejamentoQuitacaoDividaPage) planejamentoQuitacaoDividaPage.classList.remove('active'); // Esconde a página de planejamento
                });
            }

            const btnCancelAddDivida = document.getElementById('btn-cancel-add-divida');
            if(btnCancelAddDivida && formAddDividaContainer && btnShowAddDividaForm){
                btnCancelAddDivida.addEventListener('click', () => {
                    formAddDividaContainer.style.display = 'none';
                    if(formAddDivida) formAddDivida.reset();
                    if(dividaParcelasDetalhesDiv) dividaParcelasDetalhesDiv.style.display = 'none';
                    btnShowAddDividaForm.style.display = 'inline-flex';
                });
            }

            if(dividaEParceladaCheckbox && dividaParcelasDetalhesDiv){
                dividaEParceladaCheckbox.addEventListener('change', function() {
                    dividaParcelasDetalhesDiv.style.display = this.checked ? 'block' : 'none';
                });
            }
            
            function exibirDividas() {
                if (!listaDividasContainerEl) return;
                listaDividasContainerEl.innerHTML = ''; 
                const semDividasMsg = document.getElementById('sem-dividas-message');

                let dividasParaExibir = [...dividasCadastradas]; // Copia para não modificar o original se for ordenar

                // Adiciona exemplos se não houver dívidas cadastradas
                if (dividasParaExibir.length === 0) {
                     if(semDividasMsg) semDividasMsg.style.display = 'none'; 
                    dividasParaExibir = [ 
                        { id: 'exemplo1', nome: 'Cartão Loja X', valorTotal: 1200, tipo: 'cartao', eParcelada: true, numParcelas: 8, valorParcela: 150, dataVencimento: '2025-07-10', prioridade: 'alta', observacoes: 'Juros altos, focar nesta!', parcelasRestantes: 5 },
                        { id: 'exemplo2', nome: 'Empréstimo Banco Y', valorTotal: 5000, tipo: 'emprestimo', eParcelada: true, numParcelas: 24, valorParcela: 280, dataVencimento: '2025-07-20', prioridade: 'media', observacoes: '', parcelasRestantes: 10 }
                    ];
                } else {
                     if(semDividasMsg) semDividasMsg.style.display = 'none';
                }
                 if (dividasParaExibir.length === 0 && semDividasMsg){ 
                    semDividasMsg.style.display = 'block';
                    return;
                }


                dividasParaExibir.forEach((divida, index) => {
                    const divCard = document.createElement('div');
                    if (divida.prioridade === 'baixa') divCard.classList.add('prioridade-baixa-bg');
                    else if (divida.prioridade === 'media') divCard.classList.add('prioridade-media-bg');
                    else if (divida.prioridade === 'alta') divCard.classList.add('prioridade-alta-bg');
                    divCard.classList.add('divida-card'); 
                    
                    let statusDivida = divida.eParcelada ? 'Parcelada' : 'Única';
                    let valorExibido = `R$ ${parseFloat(divida.valorTotal).toFixed(2)}`;
                     if (divida.eParcelada && divida.parcelasRestantes && divida.valorParcela) { // Ajustado para mostrar info de parcela
                         valorExibido = `R$ ${parseFloat(divida.valorParcela).toFixed(2)} (Restam ${divida.parcelasRestantes}/${divida.numParcelas})`;
                    } else if (divida.eParcelada && divida.valorParcela) {
                         valorExibido = `Parcela: R$ ${parseFloat(divida.valorParcela).toFixed(2)} (Total: R$ ${parseFloat(divida.valorTotal).toFixed(2)})`;
                    }


                    divCard.innerHTML = `
                        <h4>${divida.nome}</h4>
                        <p><strong>Valor:</strong> ${valorExibido}</p>
                        <p><strong>Status:</strong> ${statusDivida}</p>
                        <p><strong>Prioridade:</strong> <span style="text-transform:capitalize;">${divida.prioridade}</span></p>
                        <div class="divida-actions">
                            <button class="btn btn-sm btn-secondary btn-edit-divida" data-id="${divida.id}">Editar</button>
                            <button class="btn btn-sm btn-primary btn-planejar-quitacao" data-id="${divida.id}">Planejar Quitação</button>
                        </div>
                    `;
                    listaDividasContainerEl.appendChild(divCard);
                });
            }


            if(formAddDivida){
                formAddDivida.addEventListener('submit', (event) => {
                    event.preventDefault();
                    const novaDivida = {
                        id: `divida-${Date.now()}`, 
                        nome: document.getElementById('divida-nome').value,
                        valorTotal: parseFloat(document.getElementById('divida-valor-total').value),
                        tipo: document.getElementById('divida-tipo').value,
                        eParcelada: dividaEParceladaCheckbox.checked,
                        numParcelas: dividaEParceladaCheckbox.checked ? parseInt(document.getElementById('divida-num-parcelas').value) : null,
                        valorParcela: dividaEParceladaCheckbox.checked ? parseFloat(document.getElementById('divida-valor-parcela').value) : null,
                        dataVencimento: document.getElementById('divida-data-vencimento').value,
                        prioridade: document.getElementById('divida-prioridade').value,
                        observacoes: document.getElementById('divida-observacoes').value,
                        parcelasRestantes: dividaEParceladaCheckbox.checked ? parseInt(document.getElementById('divida-num-parcelas').value) : 1 // Simulação
                    };
                    dividasCadastradas.push(novaDivida);
                    exibirDividas(); 
                    alert(`Dívida "${novaDivida.nome}" salva com sucesso!`);
                    formAddDivida.reset();
                    if(dividaParcelasDetalhesDiv) dividaParcelasDetalhesDiv.style.display = 'none';
                    if(formAddDividaContainer) formAddDividaContainer.style.display = 'none';
                    if(btnShowAddDividaForm) btnShowAddDividaForm.style.display = 'inline-flex';
                });
            }
            
            if(listaDividasContainerEl) {
                listaDividasContainerEl.addEventListener('click', (event) => {
                    if (event.target.classList.contains('btn-planejar-quitacao')) {
                        const dividaId = event.target.dataset.id;
                        let dividaSelecionada = dividasCadastradas.find(d => d.id === dividaId);
                        
                        if(!dividaSelecionada) { // Tenta buscar nos exemplos se não achar nas cadastradas
                             if(dividaId === 'exemplo1') {
                                dividaSelecionada = { id: 'exemplo1', nome: 'Cartão Loja X', valorTotal: 1200, eParcelada: true, numParcelas: 8, valorParcela: 150, parcelasRestantes: 5 };
                            } else if (dividaId === 'exemplo2') {
                                dividaSelecionada = { id: 'exemplo2', nome: 'Empréstimo Banco Y', valorTotal: 5000, eParcelada: true, numParcelas: 24, valorParcela: 280, parcelasRestantes: 10 };
                            }
                        }
                        
                        if (dividaSelecionada) {
                            dividaAtualParaPlanejamento = dividaSelecionada; 
                            setActivePage('planejamento-quitacao-divida-page', dividaSelecionada);
                        }
                    }
                });
            }
            
            function preencherPaginaPlanejamentoQuitacao(divida) {
                if (!planejamentoQuitacaoDividaPage) return;
                document.getElementById('titulo-planejamento-divida').querySelector('span').textContent = divida.nome;
                document.getElementById('planejamento-nome-divida-display').textContent = divida.nome;
                document.getElementById('planejamento-valor-total-display').textContent = `R$ ${parseFloat(divida.valorTotal).toFixed(2)}`;
                
                document.getElementById('meta-nome-divida-display').textContent = divida.nome;
                document.getElementById('meta-total-divida-display').textContent = `R$ ${parseFloat(divida.valorTotal).toFixed(2)}`;

                document.getElementById('planejamento-poupanca').value = 50;
                document.getElementById('planejamento-periodo').value = 'quinzena';
                document.getElementById('planejamento-valor-ja-pago').value = 0;
                document.getElementById('resultado-calculo-quitacao').textContent = '';
                
                const progressBar = document.getElementById('quitacao-progress-bar');
                progressBar.style.width = '0%';
                progressBar.textContent = '0%';
                document.getElementById('meta-valor-pago-display').textContent = `R$ 0,00`;
                document.getElementById('meta-falta-quitar-display').textContent = `R$ ${parseFloat(divida.valorTotal).toFixed(2)}`;

                const sugestoesVendasUl = document.getElementById('lista-sugestoes-vendas-quitacao');
                if (sugestoesVendasUl) {
                    sugestoesVendasUl.innerHTML = `<li>Vender ${Math.ceil(divida.valorTotal / 25)} unidades do Produto "Exemplo" (Lucro Estimado: R$ 25,00)</li>`; // Exemplo mais dinâmico
                }
                const dicaEconomiaEl = document.getElementById('dica-economia-quitacao');
                if(dicaEconomiaEl) dicaEconomiaEl.textContent = "Avalie pequenas despesas diárias. Um café a menos por dia pode somar uma boa economia no final do mês!";
            }

            const btnCalcularQuitacao = document.getElementById('btn-calcular-quitacao');
            if(btnCalcularQuitacao){
                btnCalcularQuitacao.addEventListener('click', () => {
                    if(!dividaAtualParaPlanejamento) return;

                    const valorPoupanca = parseFloat(document.getElementById('planejamento-poupanca').value) || 0;
                    const periodo = document.getElementById('planejamento-periodo').value;
                    const valorJaPago = parseFloat(document.getElementById('planejamento-valor-ja-pago').value) || 0;
                    const valorRestante = dividaAtualParaPlanejamento.valorTotal - valorJaPago;
                    const resultadoEl = document.getElementById('resultado-calculo-quitacao');
                    const progressBar = document.getElementById('quitacao-progress-bar');
                    
                    document.getElementById('meta-valor-pago-display').textContent = `R$ ${valorJaPago.toFixed(2)}`;
                    document.getElementById('meta-falta-quitar-display').textContent = `R$ ${valorRestante.toFixed(2)}`;

                    let progresso = 0;
                    if (dividaAtualParaPlanejamento.valorTotal > 0) {
                        progresso = (valorJaPago / dividaAtualParaPlanejamento.valorTotal) * 100;
                    }
                    progressBar.style.width = `${Math.min(progresso, 100)}%`;
                    progressBar.textContent = `${Math.min(progresso, 100).toFixed(0)}%`;


                    if (valorPoupanca <= 0) {
                        resultadoEl.textContent = "Por favor, insira um valor válido para poupança.";
                        resultadoEl.style.color = "#ef4444"; 
                        return;
                    }
                    if (valorRestante <= 0) {
                        resultadoEl.textContent = "🎉 Parabéns! Esta dívida já está quitada ou não há valor restante!";
                        resultadoEl.style.color = "#16a34a"; 
                        return;
                    }

                    let periodosNecessarios;
                    let unidadeTempo = "";

                    switch(periodo) {
                        case 'dia':
                            periodosNecessarios = Math.ceil(valorRestante / valorPoupanca);
                            unidadeTempo = periodosNecessarios === 1 ? "dia" : "dias";
                            break;
                        case 'semana':
                            periodosNecessarios = Math.ceil(valorRestante / valorPoupanca);
                            unidadeTempo = periodosNecessarios === 1 ? "semana" : "semanas";
                            break;
                        case 'quinzena':
                            periodosNecessarios = Math.ceil(valorRestante / valorPoupanca);
                            unidadeTempo = periodosNecessarios === 1 ? "quinzena" : "quinzenas";
                            break;
                        case 'mes':
                            periodosNecessarios = Math.ceil(valorRestante / valorPoupanca);
                            unidadeTempo = periodosNecessarios === 1 ? "mês" : "meses";
                            break;
                    }
                    resultadoEl.textContent = `Com R$ ${valorPoupanca.toFixed(2)} por ${periodo.replace('a', '')}, você quitará em ${periodosNecessarios} ${unidadeTempo}.`;
                    resultadoEl.style.color = "#166534"; 
                });
            }
            
            const valorJaPagoInput = document.getElementById('planejamento-valor-ja-pago');
            if(valorJaPagoInput) {
                valorJaPagoInput.addEventListener('input', () => {
                     if(!dividaAtualParaPlanejamento) return;
                    const valorJaPago = parseFloat(valorJaPagoInput.value) || 0;
                    const valorRestante = dividaAtualParaPlanejamento.valorTotal - valorJaPago;
                    const progressBar = document.getElementById('quitacao-progress-bar');

                    document.getElementById('meta-valor-pago-display').textContent = `R$ ${valorJaPago.toFixed(2)}`;
                    document.getElementById('meta-falta-quitar-display').textContent = `R$ ${valorRestante.toFixed(2)}`;
                    
                    let progresso = 0;
                    if (dividaAtualParaPlanejamento.valorTotal > 0) {
                        progresso = (valorJaPago / dividaAtualParaPlanejamento.valorTotal) * 100;
                    }
                    progressBar.style.width = `${Math.min(progresso, 100)}%`;
                    progressBar.textContent = `${Math.min(progresso, 100).toFixed(0)}%`;

                    const resultadoEl = document.getElementById('resultado-calculo-quitacao');
                    if(resultadoEl) resultadoEl.textContent = '';
                });
            }


            if(btnCriarMetaQuitacaoReal) {
                btnCriarMetaQuitacaoReal.addEventListener('click', () => {
                    if(!dividaAtualParaPlanejamento) {
                        alert("Nenhuma dívida selecionada para criar meta.");
                        return;
                    }
                    const nomeDivida = dividaAtualParaPlanejamento.nome;
                    const valorPoupanca = document.getElementById('planejamento-poupanca').value;
                    const periodo = document.getElementById('planejamento-periodo').value;
                    const resultado = document.getElementById('resultado-calculo-quitacao').textContent;
                    
                    alert(`Meta de quitação para "${nomeDivida}" com R$${valorPoupanca} por ${periodo.replace('a','')} criada!\n${resultado}\n(Funcionalidade de integração com Metas e Dashboard a ser implementada)`);
                    console.log("Criar Meta de Quitação:", {
                        divida: nomeDivida,
                        valorPoupanca: valorPoupanca,
                        periodo: periodo,
                        simulacao: resultado
                    });
                });
            }

            if(btnVoltarParaDividas) {
                btnVoltarParaDividas.addEventListener('click', () => {
                    setActivePage('liberdade-financeira-page');
                });
            }


            // --- Fim Lógica da Página Liberdade Financeira ---


            // Define a página inicial (Dashboard) e recalcula custos se for a página de despesas
            const initialPage = 'dashboard-page'; 
            const activePage = document.querySelector('.page-content.active');
            if (!activePage && document.getElementById(initialPage)) {
                 setActivePage(initialPage);
            } else if (!activePage && pageContents.length > 0) {
                setActivePage(pageContents[0].id);
            } else if (activePage){ 
                if (activePage.id === 'despesas-page'){
                     if(typeof exibirCustosFixos === "function") exibirCustosFixos();
                     if(typeof exibirCustosVariaveis === "function") exibirCustosVariaveis();
                } else if (activePage.id === 'liberdade-financeira-page') {
                    if(typeof exibirDividas === "function") exibirDividas();
                }
            }
        });
    </script>
</body>
</html>
